function cov_1t4cakk3g4(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/task/getSystemStatsService.js";var hash="3875af649dadd0b557ee12c989d461705a4ab654";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/task/getSystemStatsService.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:41}},"1":{start:{line:2,column:22},end:{line:2,column:42}},"2":{start:{line:3,column:19},end:{line:3,column:36}},"3":{start:{line:4,column:37},end:{line:4,column:71}},"4":{start:{line:5,column:37},end:{line:5,column:84}},"5":{start:{line:8,column:18},end:{line:8,column:66}},"6":{start:{line:8,column:38},end:{line:8,column:65}},"7":{start:{line:9,column:2},end:{line:11,column:5}},"8":{start:{line:10,column:4},end:{line:10,column:28}},"9":{start:{line:15,column:2},end:{line:18,column:4}},"10":{start:{line:16,column:15},end:{line:16,column:72}},"11":{start:{line:21,column:0},end:{line:137,column:2}},"12":{start:{line:28,column:2},end:{line:136,column:3}},"13":{start:{line:29,column:20},end:{line:31,column:5}},"14":{start:{line:33,column:23},end:{line:33,column:63}},"15":{start:{line:33,column:52},end:{line:33,column:62}},"16":{start:{line:34,column:28},end:{line:34,column:73}},"17":{start:{line:36,column:27},end:{line:42,column:5}},"18":{start:{line:43,column:20},end:{line:103,column:6}},"19":{start:{line:104,column:33},end:{line:104,column:80}},"20":{start:{line:105,column:16},end:{line:114,column:6}},"21":{start:{line:106,column:29},end:{line:106,column:84}},"22":{start:{line:107,column:30},end:{line:107,column:73}},"23":{start:{line:108,column:6},end:{line:113,column:8}},"24":{start:{line:115,column:4},end:{line:133,column:5}},"25":{start:{line:117,column:25},end:{line:117,column:80}},"26":{start:{line:118,column:6},end:{line:126,column:7}},"27":{start:{line:119,column:8},end:{line:119,column:73}},"28":{start:{line:121,column:8},end:{line:125,column:10}},"29":{start:{line:128,column:6},end:{line:132,column:8}},"30":{start:{line:135,column:4},end:{line:135,column:47}}},fnMap:{"0":{name:"getSystemsWithoutDuplicate",decl:{start:{line:7,column:9},end:{line:7,column:35}},loc:{start:{line:7,column:43},end:{line:12,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:28},end:{line:8,column:29}},loc:{start:{line:8,column:38},end:{line:8,column:65}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:9,column:35},end:{line:9,column:36}},loc:{start:{line:9,column:45},end:{line:11,column:3}},line:9},"3":{name:"calculateSystemOccurence",decl:{start:{line:14,column:9},end:{line:14,column:33}},loc:{start:{line:14,column:49},end:{line:19,column:1}},line:14},"4":{name:"(anonymous_4)",decl:{start:{line:16,column:4},end:{line:16,column:5}},loc:{start:{line:16,column:15},end:{line:16,column:72}},line:16},"5":{name:"(anonymous_5)",decl:{start:{line:21,column:17},end:{line:21,column:18}},loc:{start:{line:27,column:5},end:{line:137,column:1}},line:27},"6":{name:"(anonymous_6)",decl:{start:{line:33,column:40},end:{line:33,column:41}},loc:{start:{line:33,column:52},end:{line:33,column:62}},line:33},"7":{name:"(anonymous_7)",decl:{start:{line:105,column:41},end:{line:105,column:42}},loc:{start:{line:105,column:51},end:{line:114,column:5}},line:105}},branchMap:{"0":{loc:{start:{line:16,column:15},end:{line:16,column:72}},type:"cond-expr",locations:[{start:{line:16,column:63},end:{line:16,column:68}},{start:{line:16,column:71},end:{line:16,column:72}}],line:16},"1":{loc:{start:{line:30,column:6},end:{line:30,column:53}},type:"cond-expr",locations:[{start:{line:30,column:25},end:{line:30,column:41}},{start:{line:30,column:44},end:{line:30,column:53}}],line:30},"2":{loc:{start:{line:115,column:4},end:{line:133,column:5}},type:"if",locations:[{start:{line:115,column:4},end:{line:133,column:5}},{start:{line:115,column:4},end:{line:133,column:5}}],line:115},"3":{loc:{start:{line:118,column:6},end:{line:126,column:7}},type:"if",locations:[{start:{line:118,column:6},end:{line:126,column:7}},{start:{line:118,column:6},end:{line:126,column:7}}],line:118}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3875af649dadd0b557ee12c989d461705a4ab654"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1t4cakk3g4=function(){return actualCoverage;};}return actualCoverage;}cov_1t4cakk3g4();const Task=(cov_1t4cakk3g4().s[0]++,require("../../models/Task"));const systemService=(cov_1t4cakk3g4().s[1]++,require("../system"));const mapService=(cov_1t4cakk3g4().s[2]++,require("../map"));const virtualTasksGeneratorService=(cov_1t4cakk3g4().s[3]++,require("./virtualTasksGenerator"));const TaskStatisticsHistoryService=(cov_1t4cakk3g4().s[4]++,require("../../services/TaskStatisticsHistory"));function getSystemsWithoutDuplicate(array){cov_1t4cakk3g4().f[0]++;const systems=(cov_1t4cakk3g4().s[5]++,array.map(item=>{cov_1t4cakk3g4().f[1]++;cov_1t4cakk3g4().s[6]++;return JSON.stringify(item.system);}));cov_1t4cakk3g4().s[7]++;return[...new Set(systems)].map(item=>{cov_1t4cakk3g4().f[2]++;cov_1t4cakk3g4().s[8]++;return JSON.parse(item);});}function calculateSystemOccurence(array,system){cov_1t4cakk3g4().f[3]++;cov_1t4cakk3g4().s[9]++;return array.reduce((a,v)=>{cov_1t4cakk3g4().f[4]++;cov_1t4cakk3g4().s[10]++;return v.system._id.toString()===system.toString()?(cov_1t4cakk3g4().b[0][0]++,a+1):(cov_1t4cakk3g4().b[0][1]++,a);},0);}cov_1t4cakk3g4().s[11]++;module.exports=async(startDate,endDate,timeZone,userId,customerIDFilter)=>{cov_1t4cakk3g4().f[5]++;cov_1t4cakk3g4().s[12]++;try{const systems=(cov_1t4cakk3g4().s[13]++,await systemService.getSystemsForMapsService(customerIDFilter?(cov_1t4cakk3g4().b[1][0]++,customerIDFilter):(cov_1t4cakk3g4().b[1][1]++,undefined)));// array of system IDs
const systemsIDs=(cov_1t4cakk3g4().s[14]++,systems.data.map(system=>{cov_1t4cakk3g4().f[6]++;cov_1t4cakk3g4().s[15]++;return system._id;}));const mapsFromSystems=(cov_1t4cakk3g4().s[16]++,await mapService.getMapsBySystems(systemsIDs));//  generatedTasks == total tasks
const generatedTasks=(cov_1t4cakk3g4().s[17]++,virtualTasksGeneratorService(mapsFromSystems.data,startDate,endDate,userId,timeZone));const dbTasks=(cov_1t4cakk3g4().s[18]++,await Task.aggregate([{$match:{$and:[{estimatedStart:{$lt:new Date(endDate)}},{estimatedStart:{$gt:new Date(startDate)}}]}},{$project:{_id:1,system:1}},{$lookup:{from:"systems",localField:"system",foreignField:"_id",as:"system"}},{$unwind:{path:"$system"}},{$lookup:{from:"customers",localField:"system.customer",foreignField:"_id",as:"customer"}},{$unwind:{path:"$customer"}},{$set:{customer:"$customer.label",taskId:"$_id"}},{$project:{_id:0}}]));const uniqueGeneratedTasks=(cov_1t4cakk3g4().s[19]++,getSystemsWithoutDuplicate(generatedTasks.data));let total=(cov_1t4cakk3g4().s[20]++,uniqueGeneratedTasks.map(item=>{cov_1t4cakk3g4().f[7]++;let virtualOccurence=(cov_1t4cakk3g4().s[21]++,calculateSystemOccurence(generatedTasks.data,item._id));let databaseOccurence=(cov_1t4cakk3g4().s[22]++,calculateSystemOccurence(dbTasks,item._id));cov_1t4cakk3g4().s[23]++;return{systemName:item.name,customerName:item.customer.label,targetTasks:virtualOccurence,createdTasks:databaseOccurence};}));cov_1t4cakk3g4().s[24]++;if(total.length>0){cov_1t4cakk3g4().b[2][0]++;// saving the result in the database
const saveResult=(cov_1t4cakk3g4().s[25]++,await TaskStatisticsHistoryService.saveTaskStats(total));cov_1t4cakk3g4().s[26]++;if(saveResult.status==="success"){cov_1t4cakk3g4().b[3][0]++;cov_1t4cakk3g4().s[27]++;return{data:total,status:"success",code:saveResult.code};}else{cov_1t4cakk3g4().b[3][1]++;cov_1t4cakk3g4().s[28]++;return{err:{message:"Failed to save the data"},status:"error",code:saveResult.code};}}else{cov_1t4cakk3g4().b[2][1]++;cov_1t4cakk3g4().s[29]++;return{err:{message:"No data can be found."},code:404,status:"error"};}}catch(err){cov_1t4cakk3g4().s[30]++;return{err,status:"error",code:400};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFN5c3RlbVN0YXRzU2VydmljZS5qcyJdLCJuYW1lcyI6WyJUYXNrIiwicmVxdWlyZSIsInN5c3RlbVNlcnZpY2UiLCJtYXBTZXJ2aWNlIiwidmlydHVhbFRhc2tzR2VuZXJhdG9yU2VydmljZSIsIlRhc2tTdGF0aXN0aWNzSGlzdG9yeVNlcnZpY2UiLCJnZXRTeXN0ZW1zV2l0aG91dER1cGxpY2F0ZSIsImFycmF5Iiwic3lzdGVtcyIsIm1hcCIsIml0ZW0iLCJKU09OIiwic3RyaW5naWZ5Iiwic3lzdGVtIiwiU2V0IiwicGFyc2UiLCJjYWxjdWxhdGVTeXN0ZW1PY2N1cmVuY2UiLCJyZWR1Y2UiLCJhIiwidiIsIl9pZCIsInRvU3RyaW5nIiwibW9kdWxlIiwiZXhwb3J0cyIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ0aW1lWm9uZSIsInVzZXJJZCIsImN1c3RvbWVySURGaWx0ZXIiLCJnZXRTeXN0ZW1zRm9yTWFwc1NlcnZpY2UiLCJ1bmRlZmluZWQiLCJzeXN0ZW1zSURzIiwiZGF0YSIsIm1hcHNGcm9tU3lzdGVtcyIsImdldE1hcHNCeVN5c3RlbXMiLCJnZW5lcmF0ZWRUYXNrcyIsImRiVGFza3MiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkYW5kIiwiZXN0aW1hdGVkU3RhcnQiLCIkbHQiLCJEYXRlIiwiJGd0IiwiJHByb2plY3QiLCIkbG9va3VwIiwiZnJvbSIsImxvY2FsRmllbGQiLCJmb3JlaWduRmllbGQiLCJhcyIsIiR1bndpbmQiLCJwYXRoIiwiJHNldCIsImN1c3RvbWVyIiwidGFza0lkIiwidW5pcXVlR2VuZXJhdGVkVGFza3MiLCJ0b3RhbCIsInZpcnR1YWxPY2N1cmVuY2UiLCJkYXRhYmFzZU9jY3VyZW5jZSIsInN5c3RlbU5hbWUiLCJuYW1lIiwiY3VzdG9tZXJOYW1lIiwibGFiZWwiLCJ0YXJnZXRUYXNrcyIsImNyZWF0ZWRUYXNrcyIsImxlbmd0aCIsInNhdmVSZXN1bHQiLCJzYXZlVGFza1N0YXRzIiwic3RhdHVzIiwiY29kZSIs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RzdDLE1BQU8sQ0FDTHVDLFVBQVUsQ0FBRWpELElBQUksQ0FBQ2tELElBRFosQ0FFTEMsWUFBWSxDQUFFbkQsSUFBSSxDQUFDMkMsUUFBTCxDQUFjUyxLQUZ2QixDQUdMQyxXQUFXLENBQUVOLGdCQUhSLENBSUxPLFlBQVksQ0FBRU4saUJBSlQsQ0FBUCxDQU1ELENBVFcsQ0FBSCxDQUFULENBN0VFLHlCQXVGRixHQUFJRixLQUFLLENBQUNTLE1BQU4sQ0FBZSxDQUFuQixDQUFzQiw0QkFDcEI7QUFDQSxLQUFNQyxDQUFBQSxVQUFVLDJCQUFHLEtBQU03RCxDQUFBQSw0QkFBNEIsQ0FBQzhELGFBQTdCLENBQTJDWCxLQUEzQyxDQUFULENBQWhCLENBRm9CLHlCQUdwQixHQUFJVSxVQUFVLENBQUNFLE1BQVgsR0FBc0IsU0FBMUIsQ0FBcUMscURBQ25DLE1BQU8sQ0FBRXBDLElBQUksQ0FBRXdCLEtBQVIsQ0FBZVksTUFBTSxDQUFFLFNBQXZCLENBQWtDQyxJQUFJLENBQUVILFVBQVUsQ0FBQ0csSUFBbkQsQ0FBUCxDQUNELENBRkQsSUFFTyxxREFDTCxNQUFPLENBQ0xDLEdBQUcsQ0FBRSxDQUFFQyxPQUFPLENBQUUseUJBQVgsQ0FEQSxDQUVMSCxNQUFNLENBQUUsT0FGSCxDQUdMQyxJQUFJLENBQUVILFVBQVUsQ0FBQ0csSUFIWixDQUFQLENBS0QsQ0FDRixDQVpELElBWU8scURBQ0wsTUFBTyxDQUNMQyxHQUFHLENBQUUsQ0FBRUMsT0FBTyxDQUFFLHVCQUFYLENBREEsQ0FFTEYsSUFBSSxDQUFFLEdBRkQsQ0FHTEQsTUFBTSxDQUFFLE9BSEgsQ0FBUCxDQUtELENBQ0YsQ0FBQyxNQUFPRSxHQUFQLENBQVksMEJBQ1osTUFBTyxDQUFFQSxHQUFGLENBQU9GLE1BQU0sQ0FBRSxPQUFmLENBQXdCQyxJQUFJLENBQUUsR0FBOUIsQ0FBUCxDQUNELENBQ0YsQ0FwSEQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBUYXNrID0gcmVxdWlyZShcIi4uLy4uL21vZGVscy9UYXNrXCIpO1xuY29uc3Qgc3lzdGVtU2VydmljZSA9IHJlcXVpcmUoXCIuLi9zeXN0ZW1cIik7XG5jb25zdCBtYXBTZXJ2aWNlID0gcmVxdWlyZShcIi4uL21hcFwiKTtcbmNvbnN0IHZpcnR1YWxUYXNrc0dlbmVyYXRvclNlcnZpY2UgPSByZXF1aXJlKFwiLi92aXJ0dWFsVGFza3NHZW5lcmF0b3JcIik7XG5jb25zdCBUYXNrU3RhdGlzdGljc0hpc3RvcnlTZXJ2aWNlID0gcmVxdWlyZShcIi4uLy4uL3NlcnZpY2VzL1Rhc2tTdGF0aXN0aWNzSGlzdG9yeVwiKTtcblxuZnVuY3Rpb24gZ2V0U3lzdGVtc1dpdGhvdXREdXBsaWNhdGUoYXJyYXkpIHtcbiAgY29uc3Qgc3lzdGVtcyA9IGFycmF5Lm1hcCgoaXRlbSkgPT4gSlNPTi5zdHJpbmdpZnkoaXRlbS5zeXN0ZW0pKTtcbiAgcmV0dXJuIFsuLi5uZXcgU2V0KHN5c3RlbXMpXS5tYXAoKGl0ZW0pID0+IHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShpdGVtKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVN5c3RlbU9jY3VyZW5jZShhcnJheSwgc3lzdGVtKSB7XG4gIHJldHVybiBhcnJheS5yZWR1Y2UoXG4gICAgKGEsIHYpID0+ICh2LnN5c3RlbS5faWQudG9TdHJpbmcoKSA9PT0gc3lzdGVtLnRvU3RyaW5nKCkgPyBhICsgMSA6IGEpLFxuICAgIDBcbiAgKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoXG4gIHN0YXJ0RGF0ZSxcbiAgZW5kRGF0ZSxcbiAgdGltZVpvbmUsXG4gIHVzZXJJZCxcbiAgY3VzdG9tZXJJREZpbHRlclxuKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3lzdGVtcyA9IGF3YWl0IHN5c3RlbVNlcnZpY2UuZ2V0U3lzdGVtc0Zvck1hcHNTZXJ2aWNlKFxuICAgICAgY3VzdG9tZXJJREZpbHRlciA/IGN1c3RvbWVySURGaWx0ZXIgOiB1bmRlZmluZWRcbiAgICApO1xuICAgIC8vIGFycmF5IG9mIHN5c3RlbSBJRHNcbiAgICBjb25zdCBzeXN0ZW1zSURzID0gc3lzdGVtcy5kYXRhLm1hcCgoc3lzdGVtKSA9PiBzeXN0ZW0uX2lkKTtcbiAgICBjb25zdCBtYXBzRnJvbVN5c3RlbXMgPSBhd2FpdCBtYXBTZXJ2aWNlLmdldE1hcHNCeVN5c3RlbXMoc3lzdGVtc0lEcyk7XG4gICAgLy8gIGdlbmVyYXRlZFRhc2tzID09IHRvdGFsIHRhc2tzXG4gICAgY29uc3QgZ2VuZXJhdGVkVGFza3MgPSB2aXJ0dWFsVGFza3NHZW5lcmF0b3JTZXJ2aWNlKFxuICAgICAgbWFwc0Zyb21TeXN0ZW1zLmRhdGEsXG4gICAgICBzdGFydERhdGUsXG4gICAgICBlbmREYXRlLFxuICAgICAgdXNlcklkLFxuICAgICAgdGltZVpvbmVcbiAgICApO1xuICAgIGNvbnN0IGRiVGFza3MgPSBhd2FpdCBUYXNrLmFnZ3JlZ2F0ZShbXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgICRhbmQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXN0aW1hdGVkU3RhcnQ6IHtcbiAgICAgICAgICAgICAgICAkbHQ6IG5ldyBEYXRlKGVuZERhdGUpLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXN0aW1hdGVkU3RhcnQ6IHtcbiAgICAgICAgICAgICAgICAkZ3Q6IG5ldyBEYXRlKHN0YXJ0RGF0ZSksXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkcHJvamVjdDoge1xuICAgICAgICAgIF9pZDogMSxcbiAgICAgICAgICBzeXN0ZW06IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgZnJvbTogXCJzeXN0ZW1zXCIsXG4gICAgICAgICAgbG9jYWxGaWVsZDogXCJzeXN0ZW1cIixcbiAgICAgICAgICBmb3JlaWduRmllbGQ6IFwiX2lkXCIsXG4gICAgICAgICAgYXM6IFwic3lzdGVtXCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkdW53aW5kOiB7XG4gICAgICAgICAgcGF0aDogXCIkc3lzdGVtXCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgZnJvbTogXCJjdXN0b21lcnNcIixcbiAgICAgICAgICBsb2NhbEZpZWxkOiBcInN5c3RlbS5jdXN0b21lclwiLFxuICAgICAgICAgIGZvcmVpZ25GaWVsZDogXCJfaWRcIixcbiAgICAgICAgICBhczogXCJjdXN0b21lclwiLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJHVud2luZDoge1xuICAgICAgICAgIHBhdGg6IFwiJGN1c3RvbWVyXCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkc2V0OiB7XG4gICAgICAgICAgY3VzdG9tZXI6IFwiJGN1c3RvbWVyLmxhYmVsXCIsXG4gICAgICAgICAgdGFza0lkOiBcIiRfaWRcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRwcm9qZWN0OiB7XG4gICAgICAgICAgX2lkOiAwLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICBdKTtcbiAgICBjb25zdCB1bmlxdWVHZW5lcmF0ZWRUYXNrcyA9IGdldFN5c3RlbXNXaXRob3V0RHVwbGljYXRlKGdlbmVyYXRlZFRhc2tzLmRhdGEpO1xuICAgIGxldCB0b3RhbCA9IHVuaXF1ZUdlbmVyYXRlZFRhc2tzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgbGV0IHZpcnR1YWxPY2N1cmVuY2UgPSBjYWxjdWxhdGVTeXN0ZW1PY2N1cmVuY2UoZ2VuZXJhdGVkVGFza3MuZGF0YSwgaXRlbS5faWQpO1xuICAgICAgbGV0IGRhdGFiYXNlT2NjdXJlbmNlID0gY2FsY3VsYXRlU3lzdGVtT2NjdXJlbmNlKGRiVGFza3MsIGl0ZW0uX2lkKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN5c3RlbU5hbWU6IGl0ZW0ubmFtZSxcbiAgICAgICAgY3VzdG9tZXJOYW1lOiBpdGVtLmN1c3RvbWVyLmxhYmVsLFxuICAgICAgICB0YXJnZXRUYXNrczogdmlydHVhbE9jY3VyZW5jZSxcbiAgICAgICAgY3JlYXRlZFRhc2tzOiBkYXRhYmFzZU9jY3VyZW5jZSxcbiAgICAgIH07XG4gICAgfSk7XG4gICAgaWYgKHRvdGFsLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIHNhdmluZyB0aGUgcmVzdWx0IGluIHRoZSBkYXRhYmFzZVxuICAgICAgY29uc3Qgc2F2ZVJlc3VsdCA9IGF3YWl0IFRhc2tTdGF0aXN0aWNzSGlzdG9yeVNlcnZpY2Uuc2F2ZVRhc2tTdGF0cyh0b3RhbCk7XG4gICAgICBpZiAoc2F2ZVJlc3VsdC5zdGF0dXMgPT09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgIHJldHVybiB7IGRhdGE6IHRvdGFsLCBzdGF0dXM6IFwic3VjY2Vzc1wiLCBjb2RlOiBzYXZlUmVzdWx0LmNvZGUgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZXJyOiB7IG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHNhdmUgdGhlIGRhdGFcIiB9LFxuICAgICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICAgIGNvZGU6IHNhdmVSZXN1bHQuY29kZSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyOiB7IG1lc3NhZ2U6IFwiTm8gZGF0YSBjYW4gYmUgZm91bmQuXCIgfSxcbiAgICAgICAgY29kZTogNDA0LFxuICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICByZXR1cm4geyBlcnIsIHN0YXR1czogXCJlcnJvclwiLCBjb2RlOiA0MDAgfTtcbiAgfVxufTtcbiJdfQ==