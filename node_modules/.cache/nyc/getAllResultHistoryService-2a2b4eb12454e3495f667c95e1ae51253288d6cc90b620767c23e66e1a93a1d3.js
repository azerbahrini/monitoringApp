function cov_1o2nlusdct(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/statistics/getAllResultHistoryService.js";var hash="538e4a618e6a33d62e79660b5fef7b8cb18e70b8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/statistics/getAllResultHistoryService.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:45}},"1":{start:{line:2,column:17},end:{line:2,column:44}},"2":{start:{line:3,column:15},end:{line:3,column:41}},"3":{start:{line:5,column:0},end:{line:85,column:2}},"4":{start:{line:7,column:2},end:{line:84,column:3}},"5":{start:{line:8,column:31},end:{line:8,column:97}},"6":{start:{line:9,column:29},end:{line:9,column:93}},"7":{start:{line:11,column:18},end:{line:69,column:6}},"8":{start:{line:70,column:4},end:{line:72,column:6}},"9":{start:{line:71,column:6},end:{line:71,column:73}},"10":{start:{line:74,column:4},end:{line:80,column:5}},"11":{start:{line:75,column:6},end:{line:79,column:8}},"12":{start:{line:81,column:4},end:{line:81,column:63}},"13":{start:{line:83,column:4},end:{line:83,column:53}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:86},end:{line:85,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:70,column:15},end:{line:70,column:16}},loc:{start:{line:70,column:27},end:{line:72,column:5}},line:70}},branchMap:{"0":{loc:{start:{line:74,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:74,column:4},end:{line:80,column:5}},{start:{line:74,column:4},end:{line:80,column:5}}],line:74}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},f:{"0":0,"1":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"538e4a618e6a33d62e79660b5fef7b8cb18e70b8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1o2nlusdct=function(){return actualCoverage;};}return actualCoverage;}cov_1o2nlusdct();const Result=(cov_1o2nlusdct().s[0]++,require('../../models/Result'));const ObjectId=(cov_1o2nlusdct().s[1]++,require('mongodb').ObjectId);const moment=(cov_1o2nlusdct().s[2]++,require('moment-timezone'));cov_1o2nlusdct().s[3]++;module.exports=async(customerId,systemId,mapId,startDate,endDate,timeZone)=>{cov_1o2nlusdct().f[0]++;cov_1o2nlusdct().s[4]++;try{const convertedStartDate=(cov_1o2nlusdct().s[5]++,new Date(toUtc(moment(startDate).tz(timeZone).format(),timeZone)));const convertedEndDate=(cov_1o2nlusdct().s[6]++,new Date(toUtc(moment(endDate).tz(timeZone).format(),timeZone)));const stats=(cov_1o2nlusdct().s[7]++,await Result.aggregate([{'$lookup':{'from':'tasks','localField':'task','foreignField':'_id','as':'populatedTask'}},{'$unwind':{'path':'$populatedTask'}},{'$lookup':{'from':'systems','localField':'populatedTask.system','foreignField':'_id','as':'populatedSystem'}},{'$set':{'customerId':{'$arrayElemAt':['$populatedSystem.customer',0]},'systemId':'$populatedTask.system','mapId':'$populatedTask.map','state':'$populatedTask.state','result':'$dataSet'}},{$match:{'customerId':new ObjectId(customerId),'mapId':new ObjectId(mapId),'systemId':new ObjectId(systemId)}},{$match:{$and:[{createdAt:{$gte:convertedStartDate}},{createdAt:{$lte:convertedEndDate}}]}},{'$project':{'state':1,'createdAt':1,'gStatus':1,'result':1}}]));cov_1o2nlusdct().s[8]++;stats?.map(result=>{cov_1o2nlusdct().f[1]++;cov_1o2nlusdct().s[9]++;result.createdAt=moment(result?.createdAt).tz(timeZone).format();});cov_1o2nlusdct().s[10]++;if(stats.length===0){cov_1o2nlusdct().b[0][0]++;cov_1o2nlusdct().s[11]++;return{status:'success',statusCode:204,err:{message:'No data can be found'}};}else{cov_1o2nlusdct().b[0][1]++;}cov_1o2nlusdct().s[12]++;return{data:stats,status:'success',statusCode:200};}catch(err){cov_1o2nlusdct().s[13]++;return{err,status:'error',statusCode:400};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldEFsbFJlc3VsdEhpc3RvcnlTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlJlc3VsdCIsInJlcXVpcmUiLCJPYmplY3RJZCIsIm1vbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjdXN0b21lcklkIiwic3lzdGVtSWQiLCJtYXBJZCIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ0aW1lWm9uZSIsImNvbnZlcnRlZFN0YXJ0RGF0ZSIsIkRhdGUiLCJ0b1V0YyIsInR6IiwiZm9ybWF0IiwiY29udmVydGVkRW5kRGF0ZSIsInN0YXRzIiwiYWdncmVnYXRlIiwiJG1hdGNoIiwiJGFuZCIsImNyZWF0ZWRBdCIsIiRndGUiLCIkbHRlIiwibWFwIiwicmVzdWx0IiwibGVuZ3RoIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImVyciIsIm1lc3NhZ2UiLCJkYXRhIl0sIm1hcHBpbmdzIjoiOCtEQWVZOzJGQWZaLEtBQU1BLENBQUFBLE1BQU0sMEJBQUdDLE9BQU8sQ0FBQyxxQkFBRCxDQUFWLENBQVosQ0FDQSxLQUFNQyxDQUFBQSxRQUFRLDBCQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFQLENBQW1CQyxRQUF0QixDQUFkLENBQ0EsS0FBTUMsQ0FBQUEsTUFBTSwwQkFBR0YsT0FBTyxDQUFDLGlCQUFELENBQVYsQ0FBWixDLHdCQUVBRyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsTUFBT0MsVUFBUCxDQUFtQkMsUUFBbkIsQ0FBNkJDLEtBQTdCLENBQW9DQyxTQUFwQyxDQUErQ0MsT0FBL0MsQ0FBd0RDLFFBQXhELEdBQXFFLGlEQUVwRixHQUFJLENBQ0YsS0FBTUMsQ0FBQUEsa0JBQWtCLDBCQUFHLEdBQUlDLENBQUFBLElBQUosQ0FBU0MsS0FBSyxDQUFDWCxNQUFNLENBQUNNLFNBQUQsQ0FBTixDQUFrQk0sRUFBbEIsQ0FBcUJKLFFBQXJCLEVBQStCSyxNQUEvQixFQUFELENBQTBDTCxRQUExQyxDQUFkLENBQUgsQ0FBeEIsQ0FDQSxLQUFNTSxDQUFBQSxnQkFBZ0IsMEJBQUcsR0FBSUosQ0FBQUEsSUFBSixDQUFTQyxLQUFLLENBQUNYLE1BQU0sQ0FBQ08sT0FBRCxDQUFOLENBQWdCSyxFQUFoQixDQUFtQkosUUFBbkIsRUFBNkJLLE1BQTdCLEVBQUQsQ0FBd0NMLFFBQXhDLENBQWQsQ0FBSCxDQUF0QixDQUVBLEtBQU1PLENBQUFBLEtBQUssMEJBQUcsS0FBTWxCLENBQUFBLE1BQU0sQ0FBQ21CLFNBQVAsQ0FBaUIsQ0FFakMsQ0FDRSxVQUFXLENBQ1QsT0FBUSxPQURDLENBRVQsYUFBYyxNQUZMLENBR1QsZUFBZ0IsS0FIUCxDQUlULEtBQU0sZUFKRyxDQURiLENBRmlDLENBUzlCLENBQ0QsVUFBVyxDQUNULE9BQVEsZ0JBREMsQ0FEVixDQVQ4QixDQWE5QixDQUNELFVBQVcsQ0FDVCxPQUFRLFNBREMsQ0FFVCxhQUFjLHNCQUZMLENBR1QsZUFBZ0IsS0FIUCxDQUlULEtBQU0saUJBSkcsQ0FEVixDQWI4QixDQW9COUIsQ0FDRCxPQUFRLENBQ04sYUFBYyxDQUNaLGVBQWdCLENBQUMsMkJBQUQsQ0FBOEIsQ0FBOUIsQ0FESixDQURSLENBSU4sV0FBWSx1QkFKTixDQUtOLFFBQVMsb0JBTEgsQ0FNTixRQUFTLHNCQU5ILENBT04sU0FBVSxVQVBKLENBRFAsQ0FwQjhCLENBK0JuQyxDQUNFQyxNQUFNLENBQUUsQ0FDSCxhQUFjLEdBQUlsQixDQUFBQSxRQUFKLENBQWFJLFVBQWIsQ0FEWCxDQUVILFFBQVMsR0FBSUosQ0FBQUEsUUFBSixDQUFhTSxLQUFiLENBRk4sQ0FHSCxXQUFZLEdBQUlOLENBQUFBLFFBQUosQ0FBYUssUUFBYixDQUhULENBRFYsQ0EvQm1DLENBc0NuQyxDQUNFYSxNQUFNLENBQUUsQ0FDTkMsSUFBSSxDQUFFLENBQ0osQ0FDRUMsU0FBUyxDQUFFLENBQUNDLElBQUksQ0FBRVgsa0JBQVAsQ0FEYixDQURJLENBSUosQ0FDSVUsU0FBUyxDQUFFLENBQUNFLElBQUksQ0FBRVAsZ0JBQVAsQ0FEZixDQUpJLENBREEsQ0FEVixDQXRDbUMsQ0FrRG5DLENBQ0UsV0FBWSxDQUNWLFFBQVMsQ0FEQyxDQUVWLFlBQWEsQ0FGSCxDQUdYLFVBQVcsQ0FIQSxDQUlWLFNBQVUsQ0FKQSxDQURkLENBbERtQyxDQUFqQixDQUFULENBQVgsQ0FKRSx3QkErREZDLEtBQUssRUFBRU8sR0FBUCxDQUFZQyxNQUFELEVBQVksaURBQ3JCQSxNQUFNLENBQUNKLFNBQVAsQ0FBbUJuQixNQUFNLENBQUN1QixNQUFNLEVBQUVKLFNBQVQsQ0FBTixDQUEwQlAsRUFBMUIsQ0FBNkJKLFFBQTdCLEVBQXVDSyxNQUF2QyxFQUFuQixDQUNELENBRkQsRUEvREUseUJBbUVGLEdBQUlFLEtBQUssQ0FBQ1MsTUFBTixHQUFpQixDQUFyQixDQUF3QixxREFDdEIsTUFBTyxDQUNMQyxNQUFNLENBQUUsU0FESCxDQUVMQyxVQUFVLENBQUUsR0FGUCxDQUdMQyxHQUFHLENBQUUsQ0FBRUMsT0FBTyxDQUFFLHNCQUFYLENBSEEsQ0FBUCxDQUtELENBTkQsaUNBbkVFLHlCQTBFRixNQUFPLENBQUVDLElBQUksQ0FBRWQsS0FBUixDQUFlVSxNQUFNLENBQUUsU0FBdkIsQ0FBa0NDLFVBQVUsQ0FBRSxHQUE5QyxDQUFQLENBQ0QsQ0FBQyxNQUFPQyxHQUFQLENBQVksMEJBQ1osTUFBTyxDQUFFQSxHQUFGLENBQU9GLE1BQU0sQ0FBRSxPQUFmLENBQXdCQyxVQUFVLENBQUUsR0FBcEMsQ0FBUCxDQUNELENBQ0YsQ0FoRkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSZXN1bHQgPSByZXF1aXJlKCcuLi8uLi9tb2RlbHMvUmVzdWx0Jyk7XG5jb25zdCBPYmplY3RJZCA9IHJlcXVpcmUoJ21vbmdvZGInKS5PYmplY3RJZDtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGN1c3RvbWVySWQsIHN5c3RlbUlkLCBtYXBJZCwgc3RhcnREYXRlLCBlbmREYXRlLCB0aW1lWm9uZSkgPT4ge1xuXG4gIHRyeSB7XG4gICAgY29uc3QgY29udmVydGVkU3RhcnREYXRlID0gbmV3IERhdGUodG9VdGMobW9tZW50KHN0YXJ0RGF0ZSkudHoodGltZVpvbmUpLmZvcm1hdCgpLCB0aW1lWm9uZSkpO1xuICAgIGNvbnN0IGNvbnZlcnRlZEVuZERhdGUgPSBuZXcgRGF0ZSh0b1V0Yyhtb21lbnQoZW5kRGF0ZSkudHoodGltZVpvbmUpLmZvcm1hdCgpLCB0aW1lWm9uZSkpO1xuXG4gICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBSZXN1bHQuYWdncmVnYXRlKFtcblxuICAgICAgICB7XG4gICAgICAgICAgJyRsb29rdXAnOiB7XG4gICAgICAgICAgICAnZnJvbSc6ICd0YXNrcycsXG4gICAgICAgICAgICAnbG9jYWxGaWVsZCc6ICd0YXNrJyxcbiAgICAgICAgICAgICdmb3JlaWduRmllbGQnOiAnX2lkJyxcbiAgICAgICAgICAgICdhcyc6ICdwb3B1bGF0ZWRUYXNrJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICckdW53aW5kJzoge1xuICAgICAgICAgICAgJ3BhdGgnOiAnJHBvcHVsYXRlZFRhc2snXG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgJyRsb29rdXAnOiB7XG4gICAgICAgICAgICAnZnJvbSc6ICdzeXN0ZW1zJyxcbiAgICAgICAgICAgICdsb2NhbEZpZWxkJzogJ3BvcHVsYXRlZFRhc2suc3lzdGVtJyxcbiAgICAgICAgICAgICdmb3JlaWduRmllbGQnOiAnX2lkJyxcbiAgICAgICAgICAgICdhcyc6ICdwb3B1bGF0ZWRTeXN0ZW0nXG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgJyRzZXQnOiB7XG4gICAgICAgICAgICAnY3VzdG9tZXJJZCc6IHtcbiAgICAgICAgICAgICAgJyRhcnJheUVsZW1BdCc6IFsnJHBvcHVsYXRlZFN5c3RlbS5jdXN0b21lcicsIDBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ3N5c3RlbUlkJzogJyRwb3B1bGF0ZWRUYXNrLnN5c3RlbScsXG4gICAgICAgICAgICAnbWFwSWQnOiAnJHBvcHVsYXRlZFRhc2subWFwJyxcbiAgICAgICAgICAgICdzdGF0ZSc6ICckcG9wdWxhdGVkVGFzay5zdGF0ZScsXG4gICAgICAgICAgICAncmVzdWx0JzogJyRkYXRhU2V0J1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgICAgJ2N1c3RvbWVySWQnOiBuZXcgT2JqZWN0SWQoY3VzdG9tZXJJZCksXG4gICAgICAgICAgICAgJ21hcElkJzogbmV3IE9iamVjdElkKG1hcElkKSxcbiAgICAgICAgICAgICAnc3lzdGVtSWQnOiBuZXcgT2JqZWN0SWQoc3lzdGVtSWQpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgICRhbmQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7JGd0ZTogY29udmVydGVkU3RhcnREYXRlfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHskbHRlOiBjb252ZXJ0ZWRFbmREYXRlfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJyRwcm9qZWN0Jzoge1xuICAgICAgICAgICdzdGF0ZSc6IDEsXG4gICAgICAgICAgJ2NyZWF0ZWRBdCc6IDEsXG4gICAgICAgICAnZ1N0YXR1cyc6IDEsXG4gICAgICAgICAgJ3Jlc3VsdCc6IDFcbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuICAgIHN0YXRzPy5tYXAoKHJlc3VsdCkgPT4ge1xuICAgICAgcmVzdWx0LmNyZWF0ZWRBdCA9IG1vbWVudChyZXN1bHQ/LmNyZWF0ZWRBdCkudHoodGltZVpvbmUpLmZvcm1hdCgpO1xuICAgIH0pXG5cbiAgICBpZiAoc3RhdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgc3RhdHVzQ29kZTogMjA0LFxuICAgICAgICBlcnI6IHsgbWVzc2FnZTogJ05vIGRhdGEgY2FuIGJlIGZvdW5kJyB9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4geyBkYXRhOiBzdGF0cywgc3RhdHVzOiAnc3VjY2VzcycsIHN0YXR1c0NvZGU6IDIwMCB9O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICByZXR1cm4geyBlcnIsIHN0YXR1czogJ2Vycm9yJywgc3RhdHVzQ29kZTogNDAwIH07XG4gIH1cbn07Il19