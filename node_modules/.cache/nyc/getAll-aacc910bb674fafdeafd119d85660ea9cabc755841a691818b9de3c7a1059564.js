function cov_1u9kfzrbz9(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/getAll.js";var hash="84f0d057cf28ba56a98090568cdc113d3a63d68a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/getAll.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:43}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:17},end:{line:3,column:43}},"3":{start:{line:6,column:0},end:{line:102,column:2}},"4":{start:{line:7,column:2},end:{line:101,column:3}},"5":{start:{line:8,column:18},end:{line:8,column:64}},"6":{start:{line:9,column:16},end:{line:9,column:60}},"7":{start:{line:10,column:18},end:{line:19,column:7}},"8":{start:{line:20,column:20},end:{line:20,column:22}},"9":{start:{line:21,column:22},end:{line:38,column:6}},"10":{start:{line:40,column:31},end:{line:40,column:158}},"11":{start:{line:41,column:22},end:{line:41,column:23}},"12":{start:{line:42,column:4},end:{line:85,column:6}},"13":{start:{line:43,column:23},end:{line:43,column:27}},"14":{start:{line:44,column:6},end:{line:46,column:7}},"15":{start:{line:45,column:8},end:{line:45,column:40}},"16":{start:{line:48,column:21},end:{line:60,column:7}},"17":{start:{line:62,column:18},end:{line:62,column:23}},"18":{start:{line:63,column:6},end:{line:80,column:8}},"19":{start:{line:64,column:8},end:{line:79,column:9}},"20":{start:{line:65,column:10},end:{line:65,column:23}},"21":{start:{line:66,column:10},end:{line:68,column:11}},"22":{start:{line:67,column:12},end:{line:67,column:92}},"23":{start:{line:69,column:10},end:{line:71,column:11}},"24":{start:{line:70,column:12},end:{line:70,column:88}},"25":{start:{line:72,column:10},end:{line:78,column:11}},"26":{start:{line:73,column:24},end:{line:73,column:37}},"27":{start:{line:74,column:12},end:{line:74,column:43}},"28":{start:{line:75,column:12},end:{line:75,column:113}},"29":{start:{line:75,column:46},end:{line:75,column:50}},"30":{start:{line:75,column:83},end:{line:75,column:112}},"31":{start:{line:77,column:12},end:{line:77,column:42}},"32":{start:{line:81,column:6},end:{line:83,column:7}},"33":{start:{line:82,column:8},end:{line:82,column:33}},"34":{start:{line:84,column:6},end:{line:84,column:20}},"35":{start:{line:86,column:24},end:{line:86,column:26}},"36":{start:{line:87,column:4},end:{line:98,column:5}},"37":{start:{line:88,column:6},end:{line:94,column:8}},"38":{start:{line:89,column:8},end:{line:93,column:10}},"39":{start:{line:90,column:10},end:{line:92,column:11}},"40":{start:{line:91,column:12},end:{line:91,column:39}},"41":{start:{line:95,column:6},end:{line:95,column:58}},"42":{start:{line:97,column:6},end:{line:97,column:52}},"43":{start:{line:100,column:4},end:{line:100,column:36}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:84},end:{line:102,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:42,column:31},end:{line:42,column:32}},loc:{start:{line:42,column:42},end:{line:85,column:5}},line:42},"2":{name:"(anonymous_2)",decl:{start:{line:63,column:24},end:{line:63,column:25}},loc:{start:{line:63,column:33},end:{line:80,column:7}},line:63},"3":{name:"(anonymous_3)",decl:{start:{line:75,column:38},end:{line:75,column:39}},loc:{start:{line:75,column:46},end:{line:75,column:50}},line:75},"4":{name:"(anonymous_4)",decl:{start:{line:75,column:59},end:{line:75,column:60}},loc:{start:{line:75,column:83},end:{line:75,column:112}},line:75},"5":{name:"(anonymous_5)",decl:{start:{line:88,column:24},end:{line:88,column:25}},loc:{start:{line:88,column:30},end:{line:94,column:7}},line:88},"6":{name:"(anonymous_6)",decl:{start:{line:89,column:29},end:{line:89,column:30}},loc:{start:{line:89,column:37},end:{line:93,column:9}},line:89}},branchMap:{"0":{loc:{start:{line:10,column:18},end:{line:19,column:7}},type:"cond-expr",locations:[{start:{line:11,column:6},end:{line:15,column:7}},{start:{line:16,column:6},end:{line:19,column:7}}],line:10},"1":{loc:{start:{line:10,column:18},end:{line:10,column:31}},type:"binary-expr",locations:[{start:{line:10,column:18},end:{line:10,column:23}},{start:{line:10,column:27},end:{line:10,column:31}}],line:10},"2":{loc:{start:{line:44,column:6},end:{line:46,column:7}},type:"if",locations:[{start:{line:44,column:6},end:{line:46,column:7}},{start:{line:44,column:6},end:{line:46,column:7}}],line:44},"3":{loc:{start:{line:64,column:8},end:{line:79,column:9}},type:"if",locations:[{start:{line:64,column:8},end:{line:79,column:9}},{start:{line:64,column:8},end:{line:79,column:9}}],line:64},"4":{loc:{start:{line:64,column:12},end:{line:64,column:166}},type:"binary-expr",locations:[{start:{line:64,column:12},end:{line:64,column:51}},{start:{line:64,column:55},end:{line:64,column:166}}],line:64},"5":{loc:{start:{line:66,column:10},end:{line:68,column:11}},type:"if",locations:[{start:{line:66,column:10},end:{line:68,column:11}},{start:{line:66,column:10},end:{line:68,column:11}}],line:66},"6":{loc:{start:{line:69,column:10},end:{line:71,column:11}},type:"if",locations:[{start:{line:69,column:10},end:{line:71,column:11}},{start:{line:69,column:10},end:{line:71,column:11}}],line:69},"7":{loc:{start:{line:72,column:10},end:{line:78,column:11}},type:"if",locations:[{start:{line:72,column:10},end:{line:78,column:11}},{start:{line:72,column:10},end:{line:78,column:11}}],line:72},"8":{loc:{start:{line:81,column:6},end:{line:83,column:7}},type:"if",locations:[{start:{line:81,column:6},end:{line:83,column:7}},{start:{line:81,column:6},end:{line:83,column:7}}],line:81},"9":{loc:{start:{line:87,column:4},end:{line:98,column:5}},type:"if",locations:[{start:{line:87,column:4},end:{line:98,column:5}},{start:{line:87,column:4},end:{line:98,column:5}}],line:87},"10":{loc:{start:{line:87,column:7},end:{line:87,column:20}},type:"binary-expr",locations:[{start:{line:87,column:7},end:{line:87,column:11}},{start:{line:87,column:15},end:{line:87,column:20}}],line:87},"11":{loc:{start:{line:90,column:10},end:{line:92,column:11}},type:"if",locations:[{start:{line:90,column:10},end:{line:92,column:11}},{start:{line:90,column:10},end:{line:92,column:11}}],line:90}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"84f0d057cf28ba56a98090568cdc113d3a63d68a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1u9kfzrbz9=function(){return actualCoverage;};}return actualCoverage;}cov_1u9kfzrbz9();const Shift=(cov_1u9kfzrbz9().s[0]++,require("../../models/Shift"));const moment=(cov_1u9kfzrbz9().s[1]++,require('moment'));const momentTz=(cov_1u9kfzrbz9().s[2]++,require('moment-timezone'));cov_1u9kfzrbz9().s[3]++;module.exports=async(teamLeaderId,startDate,endDate,timeZone,shift,user)=>{cov_1u9kfzrbz9().f[0]++;cov_1u9kfzrbz9().s[4]++;try{const start=(cov_1u9kfzrbz9().s[5]++,new Date(moment(startDate+"T00:00:00.000Z")));const end=(cov_1u9kfzrbz9().s[6]++,new Date(moment(endDate+"T23:59:59.000Z")));const match=(cov_1u9kfzrbz9().s[7]++,(cov_1u9kfzrbz9().b[1][0]++,shift)&&(cov_1u9kfzrbz9().b[1][1]++,user)?(cov_1u9kfzrbz9().b[0][0]++,{startDate:{$gte:start,$lt:end},type:"shift",name:shift}):(cov_1u9kfzrbz9().b[0][1]++,{startDate:{$gte:start,$lt:end},type:"shift"}));let allShifts=(cov_1u9kfzrbz9().s[8]++,[]);const shiftDocs=(cov_1u9kfzrbz9().s[9]++,await Shift.aggregate([{$match:match},{$group:{_id:{name:"$name",startDate:"$startDate",endDate:"$endDate",role:"$role"},records:{$push:"$$ROOT"}}},{$project:{shift:'$_id',members:'$records.user',color:'$records.color',theme:'$records.theme',typeId:'$records.typeId',_id:0}}]));const shiftDocsPopulated=(cov_1u9kfzrbz9().s[10]++,await Shift.populate(shiftDocs,{path:"members",model:"user",select:["firstName","lastName"],match:{status:true}}));let generatedId=(cov_1u9kfzrbz9().s[11]++,1);cov_1u9kfzrbz9().s[12]++;shiftDocsPopulated.forEach(element=>{cov_1u9kfzrbz9().f[1]++;let teamLeader=(cov_1u9kfzrbz9().s[13]++,null);cov_1u9kfzrbz9().s[14]++;if(element.shift.role.toString()===teamLeaderId.toString()){cov_1u9kfzrbz9().b[2][0]++;cov_1u9kfzrbz9().s[15]++;teamLeader=element.members[0];}else{cov_1u9kfzrbz9().b[2][1]++;}let newShift=(cov_1u9kfzrbz9().s[16]++,{shift:{_id:"shift_00"+generatedId.toString(),name:element.shift.name,startDate:momentTz(element.shift.startDate).tz(timeZone).format(),endDate:momentTz(element.shift.endDate).tz(timeZone).format(),theme:element.theme[0],color:element.color[0],typeId:element.typeId[0]},members:element.members,teamLeader:teamLeader});let exist=(cov_1u9kfzrbz9().s[17]++,false);cov_1u9kfzrbz9().s[18]++;allShifts.forEach(shift=>{cov_1u9kfzrbz9().f[2]++;cov_1u9kfzrbz9().s[19]++;if((cov_1u9kfzrbz9().b[4][0]++,element.shift.name===shift.shift.name)&&(cov_1u9kfzrbz9().b[4][1]++,moment(element.shift.startDate).utc().startOf('day').isSame(moment(shift.shift.startDate).utc().startOf('day')))){cov_1u9kfzrbz9().b[3][0]++;cov_1u9kfzrbz9().s[20]++;exist=true;cov_1u9kfzrbz9().s[21]++;if(moment(element.shift.startDate).format("HH:mm")<moment(shift.shift.startDate).utc().format("HH:mm")){cov_1u9kfzrbz9().b[5][0]++;cov_1u9kfzrbz9().s[22]++;shift.shift.startDate=momentTz(element.shift.startDate).tz(timeZone).format();}else{cov_1u9kfzrbz9().b[5][1]++;}cov_1u9kfzrbz9().s[23]++;if(moment(element.shift.endDate).format("HH:mm")>moment(shift.shift.endDate).utc().format("HH:mm")){cov_1u9kfzrbz9().b[6][0]++;cov_1u9kfzrbz9().s[24]++;shift.shift.endDate=momentTz(element.shift.endDate).tz(timeZone).format();}else{cov_1u9kfzrbz9().b[6][1]++;}cov_1u9kfzrbz9().s[25]++;if(element.shift.role.toString()!==teamLeaderId.toString()){cov_1u9kfzrbz9().b[7][0]++;let array=(cov_1u9kfzrbz9().s[26]++,shift.members);cov_1u9kfzrbz9().s[27]++;array.push(...element.members);cov_1u9kfzrbz9().s[28]++;shift.members=array.map(item=>{cov_1u9kfzrbz9().f[3]++;cov_1u9kfzrbz9().s[29]++;return item;}).filter((value,index,self)=>{cov_1u9kfzrbz9().f[4]++;cov_1u9kfzrbz9().s[30]++;return self.indexOf(value)===index;});}else{cov_1u9kfzrbz9().b[7][1]++;cov_1u9kfzrbz9().s[31]++;shift.teamLeader=teamLeader;}}else{cov_1u9kfzrbz9().b[3][1]++;}});cov_1u9kfzrbz9().s[32]++;if(!exist){cov_1u9kfzrbz9().b[8][0]++;cov_1u9kfzrbz9().s[33]++;allShifts.push(newShift);}else{cov_1u9kfzrbz9().b[8][1]++;}cov_1u9kfzrbz9().s[34]++;generatedId++;});let allShiftsByUser=(cov_1u9kfzrbz9().s[35]++,[]);cov_1u9kfzrbz9().s[36]++;if((cov_1u9kfzrbz9().b[10][0]++,user)&&(cov_1u9kfzrbz9().b[10][1]++,shift)){cov_1u9kfzrbz9().b[9][0]++;cov_1u9kfzrbz9().s[37]++;allShifts.forEach(item=>{cov_1u9kfzrbz9().f[5]++;cov_1u9kfzrbz9().s[38]++;item.members.forEach(member=>{cov_1u9kfzrbz9().f[6]++;cov_1u9kfzrbz9().s[39]++;if(member._id.toString()===user.toString()){cov_1u9kfzrbz9().b[11][0]++;cov_1u9kfzrbz9().s[40]++;allShiftsByUser.push(item);}else{cov_1u9kfzrbz9().b[11][1]++;}});});cov_1u9kfzrbz9().s[41]++;return{data:allShiftsByUser,status:"success"};}else{cov_1u9kfzrbz9().b[9][1]++;cov_1u9kfzrbz9().s[42]++;return{data:allShifts,status:"success"};}}catch(err){cov_1u9kfzrbz9().s[43]++;return{err,status:"error"};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldEFsbC5qcyJdLCJuYW1lcyI6WyJTaGlmdCIsInJlcXVpcmUiLCJtb21lbnQiLCJtb21lbnRUeiIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0ZWFtTGVhZGVySWQiLCJzdGFydERhdGUiLCJlbmREYXRlIiwidGltZVpvbmUiLCJzaGlmdCIsInVzZXIiLCJzdGFydCIsIkRhdGUiLCJlbmQiLCJtYXRjaCIsIiRndGUiLCIkbHQiLCJ0eXBlIiwibmFtZSIsImFsbFNoaWZ0cyIsInNoaWZ0RG9jcyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIiRncm91cCIsIl9pZCIsInJvbGUiLCJyZWNvcmRzIiwiJHB1c2giLCIkcHJvamVjdCIsIm1lbWJlcnMiLCJjb2xvciIsInRoZW1lIiwidHlwZUlkIiwic2hpZnREb2NzUG9wdWxhdGVkIiwicG9wdWxhdGUiLCJwYXRoIiwibW9kZWwiLCJzZWxlY3QiLCJzdGF0dXMiLCJnZW5lcmF0ZWRJZCIsImZvckVhY2giLCJlbGVtZW50IiwidGVhbUxlYWRlciIsInRvU3RyaW5nIiwibmV3U2hpZnQiLCJ0eiIsImZvcm1hdCIsImV4aXN0IiwidXRjIiwic3RhcnRPZiIsImlzU2FtZSIsImFycmF5IiwicHVzaCIsIm1hcCIsIml0ZW0iLCJmaWx0ZXIiLCJ2YWx1ZSIsImluZGV4Iiwic2VsZiIsImluZGV4T2YiLCJhbGxTaGlmdHNCeVVzZXIiLCJtZW1iZXIiLCJkYXRhIiwiZXJyIl0sIm1hcHBpbmdzIjoiK3hOQWVZOzJGQWZaLEtBQU1BLENBQUFBLEtBQUssMEJBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFWLENBQVgsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxRQUFRLDBCQUFHRixPQUFPLENBQUMsaUJBQUQsQ0FBVixDQUFkLEMsd0JBR0FHLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxZQUFQLENBQXFCQyxTQUFyQixDQUFnQ0MsT0FBaEMsQ0FB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bnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuY29uc3QgbW9tZW50VHogPSByZXF1aXJlKCdtb21lbnQtdGltZXpvbmUnKTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jICh0ZWFtTGVhZGVySWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgdGltZVpvbmUsIHNoaWZ0LCB1c2VyKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShtb21lbnQoc3RhcnREYXRlICsgXCJUMDA6MDA6MDAuMDAwWlwiKSk7XG4gICAgY29uc3QgZW5kID0gbmV3IERhdGUobW9tZW50KGVuZERhdGUgKyBcIlQyMzo1OTo1OS4wMDBaXCIpKTtcbiAgICBjb25zdCBtYXRjaCA9IHNoaWZ0ICYmIHVzZXIgP1xuICAgICAge1xuICAgICAgICBzdGFydERhdGU6IHsgJGd0ZTogc3RhcnQsICRsdDogZW5kIH0sXG4gICAgICAgIHR5cGU6IFwic2hpZnRcIixcbiAgICAgICAgbmFtZTogc2hpZnRcbiAgICAgIH0gOlxuICAgICAge1xuICAgICAgICBzdGFydERhdGU6IHsgJGd0ZTogc3RhcnQsICRsdDogZW5kIH0sXG4gICAgICAgIHR5cGU6IFwic2hpZnRcIlxuICAgICAgfTtcbiAgICBsZXQgYWxsU2hpZnRzID0gW107XG4gICAgY29uc3Qgc2hpZnREb2NzID0gYXdhaXQgU2hpZnQuYWdncmVnYXRlKFtcbiAgICAgIHtcbiAgICAgICAgJG1hdGNoOiBtYXRjaFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiB7IG5hbWU6IFwiJG5hbWVcIiwgc3RhcnREYXRlOiBcIiRzdGFydERhdGVcIiwgZW5kRGF0ZTogXCIkZW5kRGF0ZVwiLCByb2xlOiBcIiRyb2xlXCIgfVxuICAgICAgICAgICwgcmVjb3JkczogeyAkcHVzaDogXCIkJFJPT1RcIiB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICRwcm9qZWN0OiB7XG4gICAgICAgICAgc2hpZnQ6ICckX2lkJywgbWVtYmVyczogJyRyZWNvcmRzLnVzZXInLFxuICAgICAgICAgIGNvbG9yOiAnJHJlY29yZHMuY29sb3InLCB0aGVtZTogJyRyZWNvcmRzLnRoZW1lJyxcbiAgICAgICAgICB0eXBlSWQ6ICckcmVjb3Jkcy50eXBlSWQnLCBfaWQ6IDBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgY29uc3Qgc2hpZnREb2NzUG9wdWxhdGVkID0gYXdhaXQgU2hpZnQucG9wdWxhdGUoc2hpZnREb2NzLCB7IHBhdGg6IFwibWVtYmVyc1wiLCBtb2RlbDogXCJ1c2VyXCIsIHNlbGVjdDogW1wiZmlyc3ROYW1lXCIsIFwibGFzdE5hbWVcIl0sIG1hdGNoOiB7IHN0YXR1czogdHJ1ZSB9IH0pO1xuICAgIGxldCBnZW5lcmF0ZWRJZCA9IDE7XG4gICAgc2hpZnREb2NzUG9wdWxhdGVkLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICBsZXQgdGVhbUxlYWRlciA9IG51bGw7XG4gICAgICBpZiAoZWxlbWVudC5zaGlmdC5yb2xlLnRvU3RyaW5nKCkgPT09IHRlYW1MZWFkZXJJZC50b1N0cmluZygpKSB7XG4gICAgICAgIHRlYW1MZWFkZXIgPSBlbGVtZW50Lm1lbWJlcnNbMF07XG4gICAgICB9XG5cbiAgICAgIGxldCBuZXdTaGlmdCA9IHtcbiAgICAgICAgc2hpZnQ6IHtcbiAgICAgICAgICBfaWQ6IFwic2hpZnRfMDBcIiArIGdlbmVyYXRlZElkLnRvU3RyaW5nKCksXG4gICAgICAgICAgbmFtZTogZWxlbWVudC5zaGlmdC5uYW1lLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbW9tZW50VHooZWxlbWVudC5zaGlmdC5zdGFydERhdGUpLnR6KHRpbWVab25lKS5mb3JtYXQoKSxcbiAgICAgICAgICBlbmREYXRlOiBtb21lbnRUeihlbGVtZW50LnNoaWZ0LmVuZERhdGUpLnR6KHRpbWVab25lKS5mb3JtYXQoKSxcbiAgICAgICAgICB0aGVtZTogZWxlbWVudC50aGVtZVswXSxcbiAgICAgICAgICBjb2xvcjogZWxlbWVudC5jb2xvclswXSxcbiAgICAgICAgICB0eXBlSWQ6IGVsZW1lbnQudHlwZUlkWzBdXG4gICAgICAgIH0sXG4gICAgICAgIG1lbWJlcnM6IGVsZW1lbnQubWVtYmVycyxcbiAgICAgICAgdGVhbUxlYWRlcjogdGVhbUxlYWRlclxuICAgICAgfTtcblxuICAgICAgbGV0IGV4aXN0ID0gZmFsc2U7XG4gICAgICBhbGxTaGlmdHMuZm9yRWFjaChzaGlmdCA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50LnNoaWZ0Lm5hbWUgPT09IHNoaWZ0LnNoaWZ0Lm5hbWUgJiYgbW9tZW50KGVsZW1lbnQuc2hpZnQuc3RhcnREYXRlKS51dGMoKS5zdGFydE9mKCdkYXknKS5pc1NhbWUobW9tZW50KHNoaWZ0LnNoaWZ0LnN0YXJ0RGF0ZSkudXRjKCkuc3RhcnRPZignZGF5JykpKSB7XG4gICAgICAgICAgZXhpc3QgPSB0cnVlO1xuICAgICAgICAgIGlmIChtb21lbnQoZWxlbWVudC5zaGlmdC5zdGFydERhdGUpLmZvcm1hdChcIkhIOm1tXCIpIDwgbW9tZW50KHNoaWZ0LnNoaWZ0LnN0YXJ0RGF0ZSkudXRjKCkuZm9ybWF0KFwiSEg6bW1cIikpIHtcbiAgICAgICAgICAgIHNoaWZ0LnNoaWZ0LnN0YXJ0RGF0ZSA9IG1vbWVudFR6KGVsZW1lbnQuc2hpZnQuc3RhcnREYXRlKS50eih0aW1lWm9uZSkuZm9ybWF0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb21lbnQoZWxlbWVudC5zaGlmdC5lbmREYXRlKS5mb3JtYXQoXCJISDptbVwiKSA+IG1vbWVudChzaGlmdC5zaGlmdC5lbmREYXRlKS51dGMoKS5mb3JtYXQoXCJISDptbVwiKSkge1xuICAgICAgICAgICAgc2hpZnQuc2hpZnQuZW5kRGF0ZSA9IG1vbWVudFR6KGVsZW1lbnQuc2hpZnQuZW5kRGF0ZSkudHoodGltZVpvbmUpLmZvcm1hdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZWxlbWVudC5zaGlmdC5yb2xlLnRvU3RyaW5nKCkgIT09IHRlYW1MZWFkZXJJZC50b1N0cmluZygpKSB7XG4gICAgICAgICAgICBsZXQgYXJyYXkgPSBzaGlmdC5tZW1iZXJzO1xuICAgICAgICAgICAgYXJyYXkucHVzaCguLi5lbGVtZW50Lm1lbWJlcnMpO1xuICAgICAgICAgICAgc2hpZnQubWVtYmVycyA9IGFycmF5Lm1hcChpdGVtID0+IGl0ZW0pLmZpbHRlcigodmFsdWUsIGluZGV4LCBzZWxmKSA9PiBzZWxmLmluZGV4T2YodmFsdWUpID09PSBpbmRleClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2hpZnQudGVhbUxlYWRlciA9IHRlYW1MZWFkZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgaWYgKCFleGlzdCkge1xuICAgICAgICBhbGxTaGlmdHMucHVzaChuZXdTaGlmdCk7XG4gICAgICB9XG4gICAgICBnZW5lcmF0ZWRJZCsrO1xuICAgIH0pXG4gICAgbGV0IGFsbFNoaWZ0c0J5VXNlcj1bXTtcbiAgICBpZih1c2VyICYmIHNoaWZ0KXtcbiAgICAgIGFsbFNoaWZ0cy5mb3JFYWNoKGl0ZW09PntcbiAgICAgICAgaXRlbS5tZW1iZXJzLmZvckVhY2gobWVtYmVyPT57XG4gICAgICAgICAgaWYobWVtYmVyLl9pZC50b1N0cmluZygpPT09dXNlci50b1N0cmluZygpKXtcbiAgICAgICAgICAgIGFsbFNoaWZ0c0J5VXNlci5wdXNoKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICByZXR1cm4geyBkYXRhOiBhbGxTaGlmdHNCeVVzZXIsIHN0YXR1czogXCJzdWNjZXNzXCIgfTtcbiAgICB9ZWxzZXtcbiAgICAgIHJldHVybiB7IGRhdGE6IGFsbFNoaWZ0cywgc3RhdHVzOiBcInN1Y2Nlc3NcIiB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHsgZXJyLCBzdGF0dXM6IFwiZXJyb3JcIiB9O1xuICB9XG59O1xuIl19