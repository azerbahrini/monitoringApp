function cov_1i2p213l4l(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/licence/getLatestCustomerLicence.js";var hash="5ad3baedddcc6177a96aa1e00fea0f0a1ab07eee";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/licence/getLatestCustomerLicence.js",statementMap:{"0":{start:{line:3,column:16},end:{line:3,column:47}},"1":{start:{line:4,column:15},end:{line:4,column:45}},"2":{start:{line:5,column:15},end:{line:5,column:32}},"3":{start:{line:6,column:0},end:{line:43,column:2}},"4":{start:{line:7,column:2},end:{line:42,column:3}},"5":{start:{line:8,column:14},end:{line:8,column:46}},"6":{start:{line:9,column:20},end:{line:20,column:5}},"7":{start:{line:22,column:4},end:{line:31,column:5}},"8":{start:{line:23,column:6},end:{line:30,column:8}},"9":{start:{line:35,column:4},end:{line:38,column:6}},"10":{start:{line:40,column:4},end:{line:40,column:76}},"11":{start:{line:41,column:4},end:{line:41,column:36}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:40},end:{line:43,column:1}},line:6}},branchMap:{"0":{loc:{start:{line:22,column:4},end:{line:31,column:5}},type:"if",locations:[{start:{line:22,column:4},end:{line:31,column:5}},{start:{line:22,column:4},end:{line:31,column:5}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},f:{"0":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5ad3baedddcc6177a96aa1e00fea0f0a1ab07eee"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1i2p213l4l=function(){return actualCoverage;};}return actualCoverage;}cov_1i2p213l4l();//Get The Latest Customer Licence By Expiration Date
const Licence=(cov_1i2p213l4l().s[0]++,require("../../models/Licence"));const logger=(cov_1i2p213l4l().s[1]++,require("../../config/logger"));const moment=(cov_1i2p213l4l().s[2]++,require("moment"));cov_1i2p213l4l().s[3]++;module.exports=async customer_Id=>{cov_1i2p213l4l().f[0]++;cov_1i2p213l4l().s[4]++;try{let now=(cov_1i2p213l4l().s[5]++,new Date(moment()).toISOString());const licence=(cov_1i2p213l4l().s[6]++,await Licence.findOne({$and:[{endDate:{$gte:now}},{startDate:{$lte:now}},{customer:customer_Id},{isActive:true}]},'startDate endDate'));cov_1i2p213l4l().s[7]++;if(!licence){cov_1i2p213l4l().b[0][0]++;cov_1i2p213l4l().s[8]++;return{err:{message:"No Licence Exist with this Customer Id:",customer_Id},status:"error",statusCode:404};}else{cov_1i2p213l4l().b[0][1]++;}cov_1i2p213l4l().s[9]++;return{data:licence,status:"success"};}catch(err){cov_1i2p213l4l().s[10]++;logger.error("Error occur while Getting Licence By Customer Id :",err);cov_1i2p213l4l().s[11]++;return{err,status:"error"};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldExhdGVzdEN1c3RvbWVyTGljZW5jZS5qcyJdLCJuYW1lcyI6WyJMaWNlbmNlIiwicmVxdWlyZSIsImxvZ2dlciIsIm1vbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjdXN0b21lcl9JZCIsIm5vdyIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImxpY2VuY2UiLCJmaW5kT25lIiwiJGFuZCIsImVuZERhdGUiLCIkZ3RlIiwic3RhcnREYXRlIiwiJGx0ZSIsImN1c3RvbWVyIiwiaXNBY3RpdmUiLCJlcnIiLCJtZXNzYWdlIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImRhdGEiLCJlcnJvciJdLCJtYXBwaW5ncyI6IjZzREFlWTsyRkFmWjtBQUVBLEtBQU1BLENBQUFBLE9BQU8sMEJBQUdDLE9BQU8sQ0FBQyxzQkFBRCxDQUFWLENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUUsQ0FBQUEsTUFBTSwwQkFBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLEMsd0JBQ0FHLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixLQUFPQyxDQUFBQSxXQUFQLEVBQXVCLGlEQUN0QyxHQUFJLENBQ0YsR0FBSUMsQ0FBQUEsR0FBRywwQkFBRyxHQUFJQyxDQUFBQSxJQUFKLENBQVNMLE1BQU0sRUFBZixFQUFtQk0sV0FBbkIsRUFBSCxDQUFQLENBQ0EsS0FBTUMsQ0FBQUEsT0FBTywwQkFBRyxLQUFNVixDQUFBQSxPQUFPLENBQUNXLE9BQVIsQ0FBZ0IsQ0FDcENDLElBQUksQ0FBRSxDQUNKLENBQUVDLE9BQU8sQ0FBRSxDQUFFQyxJQUFJLENBQUVQLEdBQVIsQ0FBWCxDQURJLENBRUosQ0FBRVEsU0FBUyxDQUFFLENBQUVDLElBQUksQ0FBRVQsR0FBUixDQUFiLENBRkksQ0FHSixDQUNFVSxRQUFRLENBQUVYLFdBRFosQ0FISSxDQU1KLENBQUVZLFFBQVEsQ0FBRSxJQUFaLENBTkksQ0FEOEIsQ0FBaEIsQ0FVdEIsbUJBVnNCLENBQVQsQ0FBYixDQUZFLHdCQWVGLEdBQUksQ0FBQ1IsT0FBTCxDQUFjLG9EQUNaLE1BQU8sQ0FDTFMsR0FBRyxDQUFFLENBQ0hDLE9BQU8sQ0FBRSx5Q0FETixDQUVIZCxXQUZHLENBREEsQ0FLTGUsTUFBTSxDQUFFLE9BTEgsQ0FNTEMsVUFBVSxDQUFFLEdBTlAsQ0FBUCxDQVFELENBVEQsaUNBZkUsd0JBNEJGLE1BQU8sQ0FDTEMsSUFBSSxDQUFFYixPQURELENBRUxXLE1BQU0sQ0FBRSxTQUZILENBQVAsQ0FJRCxDQUFDLE1BQU9GLEdBQVAsQ0FBWSwwQkFDWmpCLE1BQU0sQ0FBQ3NCLEtBQVAsQ0FBYSxvREFBYixDQUFtRUwsR0FBbkUsRUFEWSx5QkFFWixNQUFPLENBQUVBLEdBQUYsQ0FBT0UsTUFBTSxDQUFFLE9BQWYsQ0FBUCxDQUNELENBQ0YsQ0FyQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvL0dldCBUaGUgTGF0ZXN0IEN1c3RvbWVyIExpY2VuY2UgQnkgRXhwaXJhdGlvbiBEYXRlXG5cbmNvbnN0IExpY2VuY2UgPSByZXF1aXJlKFwiLi4vLi4vbW9kZWxzL0xpY2VuY2VcIik7XG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKFwiLi4vLi4vY29uZmlnL2xvZ2dlclwiKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoXCJtb21lbnRcIik7XG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChjdXN0b21lcl9JZCkgPT4ge1xuICB0cnkge1xuICAgIGxldCBub3cgPSBuZXcgRGF0ZShtb21lbnQoKSkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBsaWNlbmNlID0gYXdhaXQgTGljZW5jZS5maW5kT25lKHtcbiAgICAgICRhbmQ6IFtcbiAgICAgICAgeyBlbmREYXRlOiB7ICRndGU6IG5vdyB9IH0sXG4gICAgICAgIHsgc3RhcnREYXRlOiB7ICRsdGU6IG5vdyB9IH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjdXN0b21lcjogY3VzdG9tZXJfSWQsXG4gICAgICAgIH0sXG4gICAgICAgIHsgaXNBY3RpdmU6IHRydWUgfSxcbiAgICAgIF0sXG4gICAgfSxcbiAgICAnc3RhcnREYXRlIGVuZERhdGUnXG4gICAgKVxuXG4gICAgaWYgKCFsaWNlbmNlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnI6IHtcbiAgICAgICAgICBtZXNzYWdlOiBcIk5vIExpY2VuY2UgRXhpc3Qgd2l0aCB0aGlzIEN1c3RvbWVyIElkOlwiLFxuICAgICAgICAgIGN1c3RvbWVyX0lkLFxuICAgICAgICB9LFxuICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgICAgfTtcbiAgICB9XG5cblxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IGxpY2VuY2UsXG4gICAgICBzdGF0dXM6IFwic3VjY2Vzc1wiLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5lcnJvcihcIkVycm9yIG9jY3VyIHdoaWxlIEdldHRpbmcgTGljZW5jZSBCeSBDdXN0b21lciBJZCA6XCIsIGVycik7XG4gICAgcmV0dXJuIHsgZXJyLCBzdGF0dXM6IFwiZXJyb3JcIiB9O1xuICB9XG59O1xuIl19