function cov_yw7ynj4k1(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/system/getSystemsInfoForDashboard.js";var hash="42646cc85c3682c3d106df99dfda4cb6f1766080";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/system/getSystemsInfoForDashboard.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:45}},"1":{start:{line:2,column:17},end:{line:2,column:36}},"2":{start:{line:3,column:15},end:{line:3,column:32}},"3":{start:{line:4,column:0},end:{line:128,column:1}},"4":{start:{line:5,column:4},end:{line:127,column:5}},"5":{start:{line:6,column:24},end:{line:6,column:73}},"6":{start:{line:7,column:26},end:{line:115,column:8}},"7":{start:{line:117,column:8},end:{line:123,column:9}},"8":{start:{line:118,column:12},end:{line:122,column:16}},"9":{start:{line:124,column:8},end:{line:124,column:56}},"10":{start:{line:126,column:8},end:{line:126,column:42}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:17},end:{line:4,column:18}},loc:{start:{line:4,column:39},end:{line:128,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:117,column:8},end:{line:123,column:9}},type:"if",locations:[{start:{line:117,column:8},end:{line:123,column:9}},{start:{line:117,column:8},end:{line:123,column:9}}],line:117}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},f:{"0":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"42646cc85c3682c3d106df99dfda4cb6f1766080"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_yw7ynj4k1=function(){return actualCoverage;};}return actualCoverage;}cov_yw7ynj4k1();const System=(cov_yw7ynj4k1().s[0]++,require('../../models/System'));const mongoose=(cov_yw7ynj4k1().s[1]++,require('mongoose'));const moment=(cov_yw7ynj4k1().s[2]++,require('moment'));cov_yw7ynj4k1().s[3]++;module.exports=async customerId=>{cov_yw7ynj4k1().f[0]++;cov_yw7ynj4k1().s[4]++;try{const dateRange=(cov_yw7ynj4k1().s[5]++,moment().subtract(1,'days').format('YYYY-MM-DD'));const systemsInfo=(cov_yw7ynj4k1().s[6]++,await System.aggregate([{'$match':{'$and':[{'customer':mongoose.Types.ObjectId(customerId)},{'isActive':true}]}},{'$lookup':{'from':'tasks','localField':'_id','foreignField':'system','as':'tasks'}},{'$unwind':{'path':'$tasks','includeArrayIndex':'index','preserveNullAndEmptyArrays':true}},{'$match':{'tasks.state':'Done'}},{'$match':{'tasks.createdAt':{'$gte':new Date(dateRange)}}},{'$lookup':{'from':'results','localField':'tasks._id','foreignField':'task','as':'results'}},{'$sort':{'results.createdAt':-1}},{'$set':{'res':{'$arrayElemAt':['$results',0]}}},{'$group':{'_id':{'task_title':'$tasks.title','systemId':'$_id'},'taskGlobalStatus':{'$first':'$res.gStatus'},'name':{'$first':'$name'},'grouped tasks':{'$sum':{'$cond':[{'$eq':['$tasks.state','Done']},1,0]}}}},{'$group':{'_id':'$_id.systemId','systemName':{'$first':'$name'},'Warning':{'$sum':{'$cond':[{'$eq':['$taskGlobalStatus','Warning']},1,0]}},'Critical':{'$sum':{'$cond':[{'$eq':['$taskGlobalStatus','Critical']},1,0]}},'Good':{'$sum':{'$cond':[{'$eq':['$taskGlobalStatus','Good']},1,0]}}}}]));cov_yw7ynj4k1().s[7]++;if(systemsInfo.length===0){cov_yw7ynj4k1().b[0][0]++;cov_yw7ynj4k1().s[8]++;return{error:{message:'No systems info was found'},statusCode:204,status:'success'};}else{cov_yw7ynj4k1().b[0][1]++;}cov_yw7ynj4k1().s[9]++;return{data:systemsInfo,status:'success'};}catch(error){cov_yw7ynj4k1().s[10]++;return{error,status:'error'};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFN5c3RlbXNJbmZvRm9yRGFzaGJvYXJkLmpzIl0sIm5hbWVzIjpbIlN5c3RlbSIsInJlcXVpcmUiLCJtb25nb29zZSIsIm1vbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjdXN0b21lcklkIiwiZGF0ZVJhbmdlIiwic3VidHJhY3QiLCJmb3JtYXQiLCJzeXN0ZW1zSW5mbyIsImFnZ3JlZ2F0ZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJEYXRlIiwibGVuZ3RoIiwiZXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsInN0YXR1cyIsImRhdGEiXSwibWFwcGluZ3MiOiJxcURBZVk7eUZBZlosS0FBTUEsQ0FBQUEsTUFBTSx5QkFBR0MsT0FBTyxDQUFDLHFCQUFELENBQVYsQ0FBWixDQUNBLEtBQU1DLENBQUFBLFFBQVEseUJBQUdELE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBZCxDQUNBLEtBQU1FLENBQUFBLE1BQU0seUJBQUdGLE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBWixDLHVCQUNBRyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsS0FBT0MsQ0FBQUEsVUFBUCxFQUFzQiwrQ0FDbkMsR0FBSSxDQUNGLEtBQU1DLENBQUFBLFNBQVMseUJBQUdKLE1BQU0sR0FBR0ssUUFBVCxDQUFrQixDQUFsQixDQUFxQixNQUFyQixFQUE2QkMsTUFBN0IsQ0FBb0MsWUFBcEMsQ0FBSCxDQUFmLENBQ0EsS0FBTUMsQ0FBQUEsV0FBVyx5QkFBRyxLQUFNVixDQUFBQSxNQUFNLENBQUNXLFNBQVAsQ0FBaUIsQ0FDekMsQ0FDRSxTQUFVLENBQ1IsT0FBUSxDQUNOLENBQ0UsV0FBWVQsUUFBUSxDQUFDVSxLQUFULENBQWVDLFFBQWYsQ0FBd0JQLFVBQXhCLENBRGQsQ0FETSxDQUdILENBQ0QsV0FBWSxJQURYLENBSEcsQ0FEQSxDQURaLENBRHlDLENBV3RDLENBQ0QsVUFBVyxDQUNULE9BQVEsT0FEQyxDQUVULGFBQWMsS0FGTCxDQUdULGVBQWdCLFFBSFAsQ0FJVCxLQUFNLE9BSkcsQ0FEVixDQVhzQyxDQWtCdEMsQ0FDRCxVQUFXLENBQ1QsT0FBUSxRQURDLENBRVQsb0JBQXFCLE9BRlosQ0FHVCw2QkFBOEIsSUFIckIsQ0FEVixDQWxCc0MsQ0F3QnRDLENBQ0QsU0FBVSxDQUNSLGNBQWUsTUFEUCxDQURULENBeEJzQyxDQTRCdEMsQ0FDRCxTQUFVLENBQ1Isa0JBQW1CLENBQ2pCLE9BQVEsR0FBSVEsQ0FBQUEsSUFBSixDQUFTUCxTQUFULENBRFMsQ0FEWCxDQURULENBNUJzQyxDQWtDdEMsQ0FDRCxVQUFXLENBQ1QsT0FBUSxTQURDLENBRVQsYUFBYyxXQUZMLENBR1QsZUFBZ0IsTUFIUCxDQUlULEtBQU0sU0FKRyxDQURWLENBbENzQyxDQXlDdEMsQ0FDRCxRQUFTLENBQ1Asb0JBQXFCLENBQUMsQ0FEZixDQURSLENBekNzQyxDQTZDdEMsQ0FDRCxPQUFRLENBQ04sTUFBTyxDQUNMLGVBQWdCLENBQUMsVUFBRCxDQUFhLENBQWIsQ0FEWCxDQURELENBRFAsQ0E3Q3NDLENBbUR0QyxDQUNELFNBQVUsQ0FDUixNQUFPLENBQ0wsYUFBYyxjQURULENBRUwsV0FBWSxNQUZQLENBREMsQ0FLUixtQkFBb0IsQ0FDbEIsU0FBVSxjQURRLENBTFosQ0FRUixPQUFRLENBQ04sU0FBVSxPQURKLENBUkEsQ0FXUixnQkFBaUIsQ0FDZixPQUFRLENBQ04sUUFBUyxDQUNQLENBQ0UsTUFBTyxDQUFDLGNBQUQsQ0FBaUIsTUFBakIsQ0FEVCxDQURPLENBR0osQ0FISSxDQUdELENBSEMsQ0FESCxDQURPLENBWFQsQ0FEVCxDQW5Ec0MsQ0F5RXRDLENBQ0QsU0FBVSxDQUNSLE1BQU8sZUFEQyxDQUVSLGFBQWMsQ0FDWixTQUFVLE9BREUsQ0FGTixDQUtSLFVBQVcsQ0FDVCxPQUFRLENBQ04sUUFBUyxDQUNQLENBQ0UsTUFBTyxDQUFDLG1CQUFELENBQXNCLFNBQXRCLENBRFQsQ0FETyxDQUdKLENBSEksQ0FHRCxDQUhDLENBREgsQ0FEQyxDQUxILENBY1IsV0FBWSxDQUNWLE9BQVEsQ0FDTixRQUFTLENBQ1AsQ0FDRSxNQUFPLENBQUMsbUJBQUQsQ0FBc0IsVUFBdEIsQ0FEVCxDQURPLENBR0osQ0FISSxDQUdELENBSEMsQ0FESCxDQURFLENBZEosQ0F1QlIsT0FBUSxDQUNOLE9BQVEsQ0FDTixRQUFTLENBQ1AsQ0FDRSxNQUFPLENBQUMsbUJBQUQsQ0FBc0IsTUFBdEIsQ0FEVCxDQURPLENBR0osQ0FISSxDQUdELENBSEMsQ0FESCxDQURGLENBdkJBLENBRFQsQ0F6RXNDLENBQWpCLENBQVQsQ0FBakIsQ0FGRSx1QkFnSEEsR0FBSUcsV0FBVyxDQUFDSyxNQUFaLEdBQXVCLENBQTNCLENBQThCLGtEQUMxQixNQUFPLENBQ0hDLEtBQUssQ0FBRSxDQUFFQyxPQUFPLENBQUUsMkJBQVgsQ0FESixDQUVIQyxVQUFVLENBQUUsR0FGVCxDQUdIQyxNQUFNLENBQUUsU0FITCxDQUFQLENBS0gsQ0FORCxnQ0FoSEEsdUJBdUhBLE1BQU8sQ0FBRUMsSUFBSSxDQUFFVixXQUFSLENBQXFCUyxNQUFNLENBQUUsU0FBN0IsQ0FBUCxDQUNILENBQUMsTUFBT0gsS0FBUCxDQUFjLHlCQUNaLE1BQU8sQ0FBRUEsS0FBRixDQUFTRyxNQUFNLENBQUUsT0FBakIsQ0FBUCxDQUNILENBQ0osQ0E1SEQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTeXN0ZW0gPSByZXF1aXJlKCcuLi8uLi9tb2RlbHMvU3lzdGVtJyk7XG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XG5jb25zdCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKVxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoY3VzdG9tZXJJZCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRlUmFuZ2UgPSBtb21lbnQoKS5zdWJ0cmFjdCgxLCAnZGF5cycpLmZvcm1hdCgnWVlZWS1NTS1ERCcpXG4gICAgICBjb25zdCBzeXN0ZW1zSW5mbyA9IGF3YWl0IFN5c3RlbS5hZ2dyZWdhdGUoW1xuICAgICAgICB7XG4gICAgICAgICAgJyRtYXRjaCc6IHtcbiAgICAgICAgICAgICckYW5kJzogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ2N1c3RvbWVyJzogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQoY3VzdG9tZXJJZClcbiAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICdpc0FjdGl2ZSc6IHRydWVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICckbG9va3VwJzoge1xuICAgICAgICAgICAgJ2Zyb20nOiAndGFza3MnLFxuICAgICAgICAgICAgJ2xvY2FsRmllbGQnOiAnX2lkJyxcbiAgICAgICAgICAgICdmb3JlaWduRmllbGQnOiAnc3lzdGVtJyxcbiAgICAgICAgICAgICdhcyc6ICd0YXNrcydcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAnJHVud2luZCc6IHtcbiAgICAgICAgICAgICdwYXRoJzogJyR0YXNrcycsXG4gICAgICAgICAgICAnaW5jbHVkZUFycmF5SW5kZXgnOiAnaW5kZXgnLFxuICAgICAgICAgICAgJ3ByZXNlcnZlTnVsbEFuZEVtcHR5QXJyYXlzJzogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICckbWF0Y2gnOiB7XG4gICAgICAgICAgICAndGFza3Muc3RhdGUnOiAnRG9uZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAnJG1hdGNoJzoge1xuICAgICAgICAgICAgJ3Rhc2tzLmNyZWF0ZWRBdCc6IHtcbiAgICAgICAgICAgICAgJyRndGUnOiBuZXcgRGF0ZShkYXRlUmFuZ2UpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgJyRsb29rdXAnOiB7XG4gICAgICAgICAgICAnZnJvbSc6ICdyZXN1bHRzJyxcbiAgICAgICAgICAgICdsb2NhbEZpZWxkJzogJ3Rhc2tzLl9pZCcsXG4gICAgICAgICAgICAnZm9yZWlnbkZpZWxkJzogJ3Rhc2snLFxuICAgICAgICAgICAgJ2FzJzogJ3Jlc3VsdHMnXG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgJyRzb3J0Jzoge1xuICAgICAgICAgICAgJ3Jlc3VsdHMuY3JlYXRlZEF0JzogLTFcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAnJHNldCc6IHtcbiAgICAgICAgICAgICdyZXMnOiB7XG4gICAgICAgICAgICAgICckYXJyYXlFbGVtQXQnOiBbJyRyZXN1bHRzJywgMF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAnJGdyb3VwJzoge1xuICAgICAgICAgICAgJ19pZCc6IHtcbiAgICAgICAgICAgICAgJ3Rhc2tfdGl0bGUnOiAnJHRhc2tzLnRpdGxlJyxcbiAgICAgICAgICAgICAgJ3N5c3RlbUlkJzogJyRfaWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ3Rhc2tHbG9iYWxTdGF0dXMnOiB7XG4gICAgICAgICAgICAgICckZmlyc3QnOiAnJHJlcy5nU3RhdHVzJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICduYW1lJzoge1xuICAgICAgICAgICAgICAnJGZpcnN0JzogJyRuYW1lJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdncm91cGVkIHRhc2tzJzoge1xuICAgICAgICAgICAgICAnJHN1bSc6IHtcbiAgICAgICAgICAgICAgICAnJGNvbmQnOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICckZXEnOiBbJyR0YXNrcy5zdGF0ZScsICdEb25lJ11cbiAgICAgICAgICAgICAgICAgIH0sIDEsIDBcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAnJGdyb3VwJzoge1xuICAgICAgICAgICAgJ19pZCc6ICckX2lkLnN5c3RlbUlkJyxcbiAgICAgICAgICAgICdzeXN0ZW1OYW1lJzoge1xuICAgICAgICAgICAgICAnJGZpcnN0JzogJyRuYW1lJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdXYXJuaW5nJzoge1xuICAgICAgICAgICAgICAnJHN1bSc6IHtcbiAgICAgICAgICAgICAgICAnJGNvbmQnOiBbXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICckZXEnOiBbJyR0YXNrR2xvYmFsU3RhdHVzJywgJ1dhcm5pbmcnXVxuICAgICAgICAgICAgICAgICAgfSwgMSwgMFxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICdDcml0aWNhbCc6IHtcbiAgICAgICAgICAgICAgJyRzdW0nOiB7XG4gICAgICAgICAgICAgICAgJyRjb25kJzogW1xuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAnJGVxJzogWyckdGFza0dsb2JhbFN0YXR1cycsICdDcml0aWNhbCddXG4gICAgICAgICAgICAgICAgICB9LCAxLCAwXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ0dvb2QnOiB7XG4gICAgICAgICAgICAgICckc3VtJzoge1xuICAgICAgICAgICAgICAgICckY29uZCc6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJyRlcSc6IFsnJHRhc2tHbG9iYWxTdGF0dXMnLCAnR29vZCddXG4gICAgICAgICAgICAgICAgICB9LCAxLCAwXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdKVxuXG4gICAgICAgIGlmIChzeXN0ZW1zSW5mby5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZXJyb3I6IHsgbWVzc2FnZTogJ05vIHN5c3RlbXMgaW5mbyB3YXMgZm91bmQnIH0sXG4gICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMjA0LFxuICAgICAgICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnXG4gICAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgZGF0YTogc3lzdGVtc0luZm8sIHN0YXR1czogJ3N1Y2Nlc3MnIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHsgZXJyb3IsIHN0YXR1czogJ2Vycm9yJyB9O1xuICAgIH1cbn0iXX0=