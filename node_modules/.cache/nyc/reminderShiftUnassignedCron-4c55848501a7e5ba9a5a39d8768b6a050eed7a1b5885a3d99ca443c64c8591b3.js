function cov_2rf44efxqf(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/reminderShiftUnassignedCron.js";var hash="27777bf4e2020dd620148d9d20efaa1cb54bce9b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/reminderShiftUnassignedCron.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:39}},"1":{start:{line:2,column:15},end:{line:2,column:45}},"2":{start:{line:3,column:15},end:{line:3,column:32}},"3":{start:{line:4,column:21},end:{line:4,column:40}},"4":{start:{line:5,column:39},end:{line:5,column:86}},"5":{start:{line:6,column:20},end:{line:6,column:38}},"6":{start:{line:7,column:14},end:{line:7,column:43}},"7":{start:{line:8,column:17},end:{line:8,column:36}},"8":{start:{line:10,column:0},end:{line:56,column:2}},"9":{start:{line:11,column:2},end:{line:55,column:3}},"10":{start:{line:12,column:4},end:{line:52,column:5}},"11":{start:{line:13,column:30},end:{line:13,column:85}},"12":{start:{line:14,column:6},end:{line:51,column:7}},"13":{start:{line:15,column:8},end:{line:15,column:52}},"14":{start:{line:17,column:32},end:{line:18,column:39}},"15":{start:{line:19,column:26},end:{line:24,column:11}},"16":{start:{line:19,column:55},end:{line:24,column:9}},"17":{start:{line:25,column:30},end:{line:25,column:70}},"18":{start:{line:26,column:8},end:{line:50,column:9}},"19":{start:{line:27,column:10},end:{line:27,column:70}},"20":{start:{line:28,column:10},end:{line:28,column:106}},"21":{start:{line:30,column:22},end:{line:47,column:11}},"22":{start:{line:33,column:35},end:{line:33,column:214}},"23":{start:{line:34,column:14},end:{line:42,column:15}},"24":{start:{line:35,column:16},end:{line:41,column:18}},"25":{start:{line:36,column:18},end:{line:40,column:19}},"26":{start:{line:38,column:20},end:{line:38,column:54}},"27":{start:{line:39,column:20},end:{line:39,column:115}},"28":{start:{line:48,column:10},end:{line:48,column:22}},"29":{start:{line:49,column:10},end:{line:49,column:65}},"30":{start:{line:54,column:4},end:{line:54,column:99}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:17},end:{line:10,column:18}},loc:{start:{line:10,column:44},end:{line:56,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:46},end:{line:19,column:47}},loc:{start:{line:19,column:55},end:{line:24,column:9}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:32,column:12},end:{line:32,column:13}},loc:{start:{line:32,column:30},end:{line:43,column:13}},line:32},"3":{name:"(anonymous_3)",decl:{start:{line:35,column:38},end:{line:35,column:39}},loc:{start:{line:35,column:53},end:{line:41,column:17}},line:35}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:52,column:5}},type:"if",locations:[{start:{line:12,column:4},end:{line:52,column:5}},{start:{line:12,column:4},end:{line:52,column:5}}],line:12},"1":{loc:{start:{line:14,column:6},end:{line:51,column:7}},type:"if",locations:[{start:{line:14,column:6},end:{line:51,column:7}},{start:{line:14,column:6},end:{line:51,column:7}}],line:14},"2":{loc:{start:{line:26,column:8},end:{line:50,column:9}},type:"if",locations:[{start:{line:26,column:8},end:{line:50,column:9}},{start:{line:26,column:8},end:{line:50,column:9}}],line:26},"3":{loc:{start:{line:34,column:14},end:{line:42,column:15}},type:"if",locations:[{start:{line:34,column:14},end:{line:42,column:15}},{start:{line:34,column:14},end:{line:42,column:15}}],line:34},"4":{loc:{start:{line:36,column:18},end:{line:40,column:19}},type:"if",locations:[{start:{line:36,column:18},end:{line:40,column:19}},{start:{line:36,column:18},end:{line:40,column:19}}],line:36},"5":{loc:{start:{line:36,column:22},end:{line:37,column:46}},type:"binary-expr",locations:[{start:{line:36,column:22},end:{line:36,column:68}},{start:{line:36,column:72},end:{line:36,column:108}},{start:{line:37,column:23},end:{line:37,column:46}}],line:36}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"27777bf4e2020dd620148d9d20efaa1cb54bce9b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2rf44efxqf=function(){return actualCoverage;};}return actualCoverage;}cov_2rf44efxqf();const CronJob=(cov_2rf44efxqf().s[0]++,require('cron').CronJob);const logger=(cov_2rf44efxqf().s[1]++,require('../../config/logger'));const moment=(cov_2rf44efxqf().s[2]++,require('moment'));const shiftService=(cov_2rf44efxqf().s[3]++,require('../shift'));const{remindUnassignedShiftNotif}=(cov_2rf44efxqf().s[4]++,require("../../kafka/notificationServiceKafka"));const roleService=(cov_2rf44efxqf().s[5]++,require('../role'));const Shift=(cov_2rf44efxqf().s[6]++,require("../../models/Shift"));const mongoose=(cov_2rf44efxqf().s[7]++,require("mongoose"));cov_2rf44efxqf().s[8]++;module.exports=async(shift,tlRoleId)=>{cov_2rf44efxqf().f[0]++;cov_2rf44efxqf().s[9]++;try{cov_2rf44efxqf().s[10]++;if(shift){cov_2rf44efxqf().b[0][0]++;const customerAmsRole=(cov_2rf44efxqf().s[11]++,await roleService.getRoleByLabelService('Customer AMS'));cov_2rf44efxqf().s[12]++;if(customerAmsRole.status!=='success'){cov_2rf44efxqf().b[1][0]++;cov_2rf44efxqf().s[13]++;logger.error('Get customer AMS role error');}else{cov_2rf44efxqf().b[1][1]++;const customersShifts=(cov_2rf44efxqf().s[14]++,await Shift.find({role:mongoose.Types.ObjectId(customerAmsRole.data._id)}).populate("user").lean().exec());const customers=(cov_2rf44efxqf().s[15]++,customersShifts.map(item=>{cov_2rf44efxqf().f[1]++;cov_2rf44efxqf().s[16]++;return{_id:item.user._id,firstName:item.user.firstName,lastName:item.user.lastName,email:item.user.email};}));const startDateTime=(cov_2rf44efxqf().s[17]++,moment(shift.startDate).subtract(1,'d'));cov_2rf44efxqf().s[18]++;if(moment(startDateTime).isBefore(moment().utc())){cov_2rf44efxqf().b[2][0]++;cov_2rf44efxqf().s[19]++;logger.info('cron shift unassigned : startdate before now');cov_2rf44efxqf().s[20]++;remindUnassignedShiftNotif({key:'ShiftUnassigned',shift:{...shift,customers:customers}});}else{cov_2rf44efxqf().b[2][1]++;const job=(cov_2rf44efxqf().s[21]++,new CronJob(startDateTime,async function(){cov_2rf44efxqf().f[2]++;const currentShift=(cov_2rf44efxqf().s[22]++,await shiftService.getAllShiftsService(tlRoleId,moment(shift.startDate).add(1,'d').format('YYYY-MM-DD'),moment(shift.endDate).format('YYYY-MM-DD'),'UTC',undefined,undefined));cov_2rf44efxqf().s[23]++;if(currentShift.status==='success'){cov_2rf44efxqf().b[3][0]++;cov_2rf44efxqf().s[24]++;currentShift.data.map(shiftResult=>{cov_2rf44efxqf().f[3]++;cov_2rf44efxqf().s[25]++;if((cov_2rf44efxqf().b[5][0]++,shiftResult.shift.startDate==shift.startDate)&&(cov_2rf44efxqf().b[5][1]++,shiftResult.shift.name==shift.name)&&(cov_2rf44efxqf().b[5][2]++,!shiftResult.teamLeader)){cov_2rf44efxqf().b[4][0]++;cov_2rf44efxqf().s[26]++;logger.info('shift not assigned');cov_2rf44efxqf().s[27]++;remindUnassignedShiftNotif({key:'ShiftUnassigned',shift:{...shift,customers:customers}});}else{cov_2rf44efxqf().b[4][1]++;}});}else{cov_2rf44efxqf().b[3][1]++;}},null,true,'UTC'));cov_2rf44efxqf().s[28]++;job.start();cov_2rf44efxqf().s[29]++;logger.info('Shift Unassigned reminder cron launched');}}}else{cov_2rf44efxqf().b[0][1]++;}}catch(error){cov_2rf44efxqf().s[30]++;logger.error('An unexpected error occurred during auto Shift Unassigned reminder cron',error);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbWluZGVyU2hpZnRVbmFzc2lnbmVkQ3Jvbi5qcyJdLCJuYW1lcyI6WyJDcm9uSm9iIiwicmVxdWlyZSIsImxvZ2dlciIsIm1vbWVudCIsInNoaWZ0U2VydmljZSIsInJlbWluZFVuYXNzaWduZWRTaGlmdE5vdGlmIiwicm9sZVNlcnZpY2UiLCJTaGlmdCIsIm1vbmdvb3NlIiwibW9kdWxlIiwiZXhwb3J0cyIsInNoaWZ0IiwidGxSb2xlSWQiLCJjdXN0b21lckFtc1JvbGUiLCJnZXRSb2xlQnlMYWJlbFNlcnZpY2UiLCJzdGF0dXMiLCJlcnJvciIsImN1c3RvbWVyc1NoaWZ0cyIsImZpbmQiLCJyb2xlIiwiVHlwZXMiLCJPYmplY3RJZCIsImRhdGEiLCJfaWQiLCJwb3B1bGF0ZSIsImxlYW4iLCJleGVjIiwiY3VzdG9tZXJzIiwibWFwIiwiaXRlbSIsInVzZXIiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImVtYWlsIiwic3RhcnREYXRlVGltZSIsInN0YXJ0RGF0ZSIsInN1YnRyYWN0IiwiaXNCZWZvcmUiLCJ1dGMiLCJpbmZvIiwia2V5Iiwiam9iIiwiY3VycmVudFNoaWZ0IiwiZ2V0QWxsU2hpZnRzU2VydmljZSIsImFkZCIsImZvcm1hdCIsImVuZERhdGUiLCJ1bmRlZmluZWQiLCJzaGlmdFJlc3VsdCIsIm5hbWUiLCJ0ZWFtTGVhZGVyIiwic3RhcnQiXSwibWFwcGluZ3MiOiJ3NUlBZVk7MkZBZlosS0FBTUEsQ0FBQUEsT0FBTywwQkFBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBUCxDQUFnQkQsT0FBbkIsQ0FBYixDQUNBLEtBQU1FLENBQUFBLE1BQU0sMEJBQUdELE9BQU8sQ0FBQyxxQkFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxNQUFNLDBCQUFHRixPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRyxDQUFBQSxZQUFZLDBCQUFHSCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQWxCLENBQ0EsS0FBTSxDQUFFSSwwQkFBRiwyQkFB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bEIsQ0FBc0JvQixXQUFXLEVBQUksa0RBQ25DLEdBQUksNEJBQUFBLFdBQVcsQ0FBQ3JDLEtBQVosQ0FBa0J3QixTQUFsQixFQUErQnhCLEtBQUssQ0FBQ3dCLFNBQXJDLCtCQUFrRGEsV0FBVyxDQUFDckMsS0FBWixDQUFrQnNDLElBQWxCLEVBQTBCdEMsS0FBSyxDQUFDc0MsSUFBbEYsK0JBQ0MsQ0FBQ0QsV0FBVyxDQUFDRSxVQURkLENBQUosQ0FDOEIscURBQzVCaEQsTUFBTSxDQUFDcUMsSUFBUCxDQUFZLG9CQUFaLEVBRDRCLHlCQUU1QmxDLDBCQUEwQixDQUFDLENBQUVtQyxHQUFHLENBQUUsaUJBQVAsQ0FBMEI3QixLQUFLLENBQUUsQ0FBQyxHQUFHQSxLQUFKLENBQVVnQixTQUFTLENBQUVBLFNBQXJCLENBQWpDLENBQUQsQ0FBMUIsQ0FDRCxDQUpELGlDQUtELENBTkQsRUFPRCxDQVJELGlDQVNELENBYlMsQ0FjVixJQWRVLENBZVYsSUFmVSxDQWdCVixLQWhCVSxDQUFILENBQVQsQ0FESyx5QkFtQkxjLEdBQUcsQ0FBQ1UsS0FBSixHQW5CSyx5QkFvQkxqRCxNQUFNLENBQUNxQyxJQUFQLENBQVkseUNBQVosRUFDRCxDQUNGLENBQ0YsQ0F4Q0QsaUNBeUNELENBQUMsTUFBT3ZCLEtBQVAsQ0FBYywwQkFDZGQsTUFBTSxDQUFDYyxLQUFQLENBQWEseUVBQWIsQ0FBd0ZBLEtBQXhGLEVBQ0QsQ0FDRixDQTlDRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENyb25Kb2IgPSByZXF1aXJlKCdjcm9uJykuQ3JvbkpvYjtcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4uLy4uL2NvbmZpZy9sb2dnZXInKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuY29uc3Qgc2hpZnRTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2hpZnQnKTtcbmNvbnN0IHsgcmVtaW5kVW5hc3NpZ25lZFNoaWZ0Tm90aWYgfSA9IHJlcXVpcmUoXCIuLi8uLi9rYWZrYS9ub3RpZmljYXRpb25TZXJ2aWNlS2Fma2FcIik7XG5jb25zdCByb2xlU2VydmljZSA9IHJlcXVpcmUoJy4uL3JvbGUnKTtcbmNvbnN0IFNoaWZ0ID0gcmVxdWlyZShcIi4uLy4uL21vZGVscy9TaGlmdFwiKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZShcIm1vbmdvb3NlXCIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChzaGlmdCwgdGxSb2xlSWQpID0+IHtcbiAgdHJ5IHtcbiAgICBpZiAoc2hpZnQpIHtcbiAgICAgIGNvbnN0IGN1c3RvbWVyQW1zUm9sZSA9IGF3YWl0IHJvbGVTZXJ2aWNlLmdldFJvbGVCeUxhYmVsU2VydmljZSgnQ3VzdG9tZXIgQU1TJyk7XG4gICAgICBpZiAoY3VzdG9tZXJBbXNSb2xlLnN0YXR1cyAhPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignR2V0IGN1c3RvbWVyIEFNUyByb2xlIGVycm9yJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBjdXN0b21lcnNTaGlmdHMgPSBhd2FpdCBTaGlmdC5maW5kKHtyb2xlOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZChjdXN0b21lckFtc1JvbGUuZGF0YS5faWQpfSlcbiAgICAgICAgLnBvcHVsYXRlKFwidXNlclwiKS5sZWFuKCkuZXhlYygpXG4gICAgICAgIGNvbnN0IGN1c3RvbWVycyA9IGN1c3RvbWVyc1NoaWZ0cy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgIF9pZDogaXRlbS51c2VyLl9pZCxcbiAgICAgICAgICBmaXJzdE5hbWU6IGl0ZW0udXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgbGFzdE5hbWU6IGl0ZW0udXNlci5sYXN0TmFtZSxcbiAgICAgICAgICBlbWFpbDogaXRlbS51c2VyLmVtYWlsXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlVGltZSA9IG1vbWVudChzaGlmdC5zdGFydERhdGUpLnN1YnRyYWN0KDEsICdkJyk7XG4gICAgICAgIGlmIChtb21lbnQoc3RhcnREYXRlVGltZSkuaXNCZWZvcmUobW9tZW50KCkudXRjKCkpKSB7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oJ2Nyb24gc2hpZnQgdW5hc3NpZ25lZCA6IHN0YXJ0ZGF0ZSBiZWZvcmUgbm93Jyk7XG4gICAgICAgICAgcmVtaW5kVW5hc3NpZ25lZFNoaWZ0Tm90aWYoeyBrZXk6ICdTaGlmdFVuYXNzaWduZWQnLCBzaGlmdDogey4uLnNoaWZ0LCBjdXN0b21lcnM6IGN1c3RvbWVyc30gfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3Qgam9iID0gbmV3IENyb25Kb2IoXG4gICAgICAgICAgICBzdGFydERhdGVUaW1lLFxuICAgICAgICAgICAgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2hpZnQgPSBhd2FpdCBzaGlmdFNlcnZpY2UuZ2V0QWxsU2hpZnRzU2VydmljZSh0bFJvbGVJZCwgbW9tZW50KHNoaWZ0LnN0YXJ0RGF0ZSkuYWRkKDEsICdkJykuZm9ybWF0KCdZWVlZLU1NLUREJyksIG1vbWVudChzaGlmdC5lbmREYXRlKS5mb3JtYXQoJ1lZWVktTU0tREQnKSwgJ1VUQycsIHVuZGVmaW5lZCwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTaGlmdC5zdGF0dXMgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRTaGlmdC5kYXRhLm1hcChzaGlmdFJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoc2hpZnRSZXN1bHQuc2hpZnQuc3RhcnREYXRlID09IHNoaWZ0LnN0YXJ0RGF0ZSAmJiBzaGlmdFJlc3VsdC5zaGlmdC5uYW1lID09IHNoaWZ0Lm5hbWVcbiAgICAgICAgICAgICAgICAgICAgJiYgIXNoaWZ0UmVzdWx0LnRlYW1MZWFkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ3NoaWZ0IG5vdCBhc3NpZ25lZCcpO1xuICAgICAgICAgICAgICAgICAgICByZW1pbmRVbmFzc2lnbmVkU2hpZnROb3RpZih7IGtleTogJ1NoaWZ0VW5hc3NpZ25lZCcsIHNoaWZ0OiB7Li4uc2hpZnQsY3VzdG9tZXJzOiBjdXN0b21lcnN9IH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICdVVEMnXG4gICAgICAgICAgKTtcbiAgICAgICAgICBqb2Iuc3RhcnQoKTtcbiAgICAgICAgICBsb2dnZXIuaW5mbygnU2hpZnQgVW5hc3NpZ25lZCByZW1pbmRlciBjcm9uIGxhdW5jaGVkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBhdXRvIFNoaWZ0IFVuYXNzaWduZWQgcmVtaW5kZXIgY3JvbicsIGVycm9yKTtcbiAgfVxufTtcbiJdfQ==