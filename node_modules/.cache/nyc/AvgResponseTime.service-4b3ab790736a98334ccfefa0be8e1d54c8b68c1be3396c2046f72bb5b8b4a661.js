function cov_pzvkm4cx3(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/statistics/AvgResponseTime.service.js";var hash="1b03b40937c31cf946517173d34224ab2e60b3e6";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/statistics/AvgResponseTime.service.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:41}},"1":{start:{line:2,column:17},end:{line:2,column:44}},"2":{start:{line:3,column:15},end:{line:3,column:41}},"3":{start:{line:4,column:14},end:{line:4,column:42}},"4":{start:{line:6,column:0},end:{line:120,column:2}},"5":{start:{line:7,column:22},end:{line:7,column:62}},"6":{start:{line:8,column:2},end:{line:119,column:3}},"7":{start:{line:9,column:31},end:{line:9,column:97}},"8":{start:{line:10,column:29},end:{line:10,column:93}},"9":{start:{line:12,column:18},end:{line:108,column:5}},"10":{start:{line:109,column:4},end:{line:115,column:5}},"11":{start:{line:110,column:6},end:{line:114,column:8}},"12":{start:{line:116,column:4},end:{line:116,column:63}},"13":{start:{line:118,column:4},end:{line:118,column:53}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:79},end:{line:120,column:1}},line:6}},branchMap:{"0":{loc:{start:{line:7,column:22},end:{line:7,column:62}},type:"binary-expr",locations:[{start:{line:7,column:22},end:{line:7,column:41}},{start:{line:7,column:45},end:{line:7,column:62}}],line:7},"1":{loc:{start:{line:89,column:26},end:{line:89,column:79}},type:"cond-expr",locations:[{start:{line:89,column:41},end:{line:89,column:63}},{start:{line:89,column:66},end:{line:89,column:79}}],line:89},"2":{loc:{start:{line:92,column:28},end:{line:94,column:33}},type:"cond-expr",locations:[{start:{line:93,column:20},end:{line:93,column:44}},{start:{line:94,column:20},end:{line:94,column:33}}],line:92},"3":{loc:{start:{line:109,column:4},end:{line:115,column:5}},type:"if",locations:[{start:{line:109,column:4},end:{line:115,column:5}},{start:{line:109,column:4},end:{line:115,column:5}}],line:109}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"1b03b40937c31cf946517173d34224ab2e60b3e6"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_pzvkm4cx3=function(){return actualCoverage;};}return actualCoverage;}cov_pzvkm4cx3();const Task=(cov_pzvkm4cx3().s[0]++,require('../../models/Task'));const ObjectId=(cov_pzvkm4cx3().s[1]++,require('mongodb').ObjectId);const moment=(cov_pzvkm4cx3().s[2]++,require('moment-timezone'));const toUtc=(cov_pzvkm4cx3().s[3]++,require('../../utils/toUTC'));cov_pzvkm4cx3().s[4]++;module.exports=async(startDate,endDate,customerID,systemID,timeZone)=>{cov_pzvkm4cx3().f[0]++;const bothAreNull=(cov_pzvkm4cx3().s[5]++,(cov_pzvkm4cx3().b[0][0]++,customerID===null)&&(cov_pzvkm4cx3().b[0][1]++,systemID===null));cov_pzvkm4cx3().s[6]++;try{const convertedStartDate=(cov_pzvkm4cx3().s[7]++,new Date(toUtc(moment(startDate).tz(timeZone).format(),timeZone)));const convertedEndDate=(cov_pzvkm4cx3().s[8]++,new Date(toUtc(moment(endDate).tz(timeZone).format(),timeZone)));const stats=(cov_pzvkm4cx3().s[9]++,await Task.aggregate([{$match:{title:'Response Time'}},{$lookup:{from:'systems',localField:'system',foreignField:'_id',as:'system'}},{$unwind:{path:'$system',preserveNullAndEmptyArrays:false}},{$project:{_id:1,'system._id':1,'system.customer':1}},{$addFields:{systemID:'$system._id',customerID:'$system.customer'}},{$project:{system:0}},{$lookup:{from:'results',localField:'_id',foreignField:'task',as:'result'}},{$unwind:{path:'$result',preserveNullAndEmptyArrays:false}},{$match:{'result.createdAt':{$gte:convertedStartDate,$lte:convertedEndDate}}},{$unwind:{path:'$result.dataSet',preserveNullAndEmptyArrays:false}},{$addFields:{createdAt:'$result.createdAt',responseTime:'$result.dataSet.responseTime'}},{$match:{$or:[{systemID:!bothAreNull?(cov_pzvkm4cx3().b[1][0]++,new ObjectId(systemID)):(cov_pzvkm4cx3().b[1][1]++,{$ne:null})},{customerID:!bothAreNull?(cov_pzvkm4cx3().b[2][0]++,new ObjectId(customerID)):(cov_pzvkm4cx3().b[2][1]++,{$ne:null})}]}},{$project:{_id:0,result:0,systemID:0,customerID:0}}]));cov_pzvkm4cx3().s[10]++;if(stats.length===0){cov_pzvkm4cx3().b[3][0]++;cov_pzvkm4cx3().s[11]++;return{status:'success',statusCode:204,err:{message:'No data can be found'}};}else{cov_pzvkm4cx3().b[3][1]++;}cov_pzvkm4cx3().s[12]++;return{data:stats,status:'success',statusCode:200};}catch(err){cov_pzvkm4cx3().s[13]++;return{err,status:'error',statusCode:400};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkF2Z1Jlc3BvbnNlVGltZS5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlRhc2siLCJyZXF1aXJlIiwiT2JqZWN0SWQiLCJtb21lbnQiLCJ0b1V0YyIsIm1vZHVsZSIsImV4cG9ydHMiLCJzdGFydERhdGUiLCJlbmREYXRlIiwiY3VzdG9tZXJJRCIsInN5c3RlbUlEIiwidGltZVpvbmUiLCJib3RoQXJlTnVsbCIsImNvbnZlcnRlZFN0YXJ0RGF0ZSIsIkRhdGUiLCJ0eiIsImZvcm1hdCIsImNvbnZlcnRlZEVuZERhdGUiLCJzdGF0cyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsInRpdGxlIiwiJGxvb2t1cCIsImZyb20iLCJsb2NhbEZpZWxkIiwiZm9yZWlnbkZpZWxkIiwiYXMiLCIkdW53aW5kIiwicGF0aCIsInByZXNlcnZlTnVsbEFuZEVtcHR5QXJyYXlzIiwiJHByb2plY3QiLCJfaWQiLCIkYWRkRmllbGRzIiwic3lzdGVtIiwiJGd0ZSIsIiRsdGUiLCJjcmVhdGVkQXQiLCJyZXNwb25zZVRpbWUiLCIkb3IiLCIkbmUiLCJyZXN1bHQiLCJsZW5ndGgiLCJzdGF0dXMiLCJzdGF0dXNDb2RlIiwiZXJyIiwibWVzc2FnZSIsImRhdGEiXSwibWFwcGluZ3MiOiI0OUVBZVk7eUZBZlosS0FBTUEsQ0FBQUEsSUFBSSx5QkFBR0MsT0FBTyxDQUFDLG1CQUFELENBQVYsQ0FBVixDQUNBLEtBQU1DLENBQUFBLFFBQVEseUJBQUdELE9BQU8sQ0FBQyxTQUFELENBQVAsQ0FBbUJDLFFBQXRCLENBQWQsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLHlCQUFHRixPQUFPLENBQUMsaUJBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUcsQ0FBQUEsS0FBSyx5QkFBR0gsT0FBTyxDQUFDLG1CQUFELENBQVYsQ0FBWCxDLHVCQUVBSSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsTUFBT0MsU0FBUCxDQUFrQkMsT0FBbEIsQ0FBMkJDLFVBQTNCLENBQXVDQyxRQUF2QyxDQUFpREMsUUFBakQsR0FBOEQs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dEZGLENBRGtCLENBQVQsQ0FBWCxDQUpFLHdCQXFHRixHQUFJUyxLQUFLLENBQUN1QixNQUFOLEdBQWlCLENBQXJCLENBQXdCLG1EQUN0QixNQUFPLENBQ0xDLE1BQU0sQ0FBRSxTQURILENBRUxDLFVBQVUsQ0FBRSxHQUZQLENBR0xDLEdBQUcsQ0FBRSxDQUFFQyxPQUFPLENBQUUsc0JBQVgsQ0FIQSxDQUFQLENBS0QsQ0FORCxnQ0FyR0Usd0JBNEdGLE1BQU8sQ0FBRUMsSUFBSSxDQUFFNUIsS0FBUixDQUFld0IsTUFBTSxDQUFFLFNBQXZCLENBQWtDQyxVQUFVLENBQUUsR0FBOUMsQ0FBUCxDQUNELENBQUMsTUFBT0MsR0FBUCxDQUFZLHlCQUNaLE1BQU8sQ0FBRUEsR0FBRixDQUFPRixNQUFNLENBQUUsT0FBZixDQUF3QkMsVUFBVSxDQUFFLEdBQXBDLENBQVAsQ0FDRCxDQUNGLENBbEhEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVGFzayA9IHJlcXVpcmUoJy4uLy4uL21vZGVscy9UYXNrJyk7XG5jb25zdCBPYmplY3RJZCA9IHJlcXVpcmUoJ21vbmdvZGInKS5PYmplY3RJZDtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudC10aW1lem9uZScpO1xuY29uc3QgdG9VdGMgPSByZXF1aXJlKCcuLi8uLi91dGlscy90b1VUQycpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgY3VzdG9tZXJJRCwgc3lzdGVtSUQsIHRpbWVab25lKSA9PiB7XG4gIGNvbnN0IGJvdGhBcmVOdWxsID0gY3VzdG9tZXJJRCA9PT0gbnVsbCAmJiBzeXN0ZW1JRCA9PT0gbnVsbDtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb252ZXJ0ZWRTdGFydERhdGUgPSBuZXcgRGF0ZSh0b1V0Yyhtb21lbnQoc3RhcnREYXRlKS50eih0aW1lWm9uZSkuZm9ybWF0KCksIHRpbWVab25lKSk7XG4gICAgY29uc3QgY29udmVydGVkRW5kRGF0ZSA9IG5ldyBEYXRlKHRvVXRjKG1vbWVudChlbmREYXRlKS50eih0aW1lWm9uZSkuZm9ybWF0KCksIHRpbWVab25lKSk7XG5cbiAgICBjb25zdCBzdGF0cyA9IGF3YWl0IFRhc2suYWdncmVnYXRlKFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgICB0aXRsZTogJ1Jlc3BvbnNlIFRpbWUnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgZnJvbTogJ3N5c3RlbXMnLFxuICAgICAgICAgICAgbG9jYWxGaWVsZDogJ3N5c3RlbScsXG4gICAgICAgICAgICBmb3JlaWduRmllbGQ6ICdfaWQnLFxuICAgICAgICAgICAgYXM6ICdzeXN0ZW0nXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJHVud2luZDoge1xuICAgICAgICAgICAgcGF0aDogJyRzeXN0ZW0nLFxuICAgICAgICAgICAgcHJlc2VydmVOdWxsQW5kRW1wdHlBcnJheXM6IGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJHByb2plY3Q6IHtcbiAgICAgICAgICAgIF9pZDogMSxcbiAgICAgICAgICAgICdzeXN0ZW0uX2lkJzogMSxcbiAgICAgICAgICAgICdzeXN0ZW0uY3VzdG9tZXInOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJGFkZEZpZWxkczoge1xuICAgICAgICAgICAgc3lzdGVtSUQ6ICckc3lzdGVtLl9pZCcsXG4gICAgICAgICAgICBjdXN0b21lcklEOiAnJHN5c3RlbS5jdXN0b21lcidcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAkcHJvamVjdDoge1xuICAgICAgICAgICAgc3lzdGVtOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgZnJvbTogJ3Jlc3VsdHMnLFxuICAgICAgICAgICAgbG9jYWxGaWVsZDogJ19pZCcsXG4gICAgICAgICAgICBmb3JlaWduRmllbGQ6ICd0YXNrJyxcbiAgICAgICAgICAgIGFzOiAncmVzdWx0J1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICR1bndpbmQ6IHtcbiAgICAgICAgICAgIHBhdGg6ICckcmVzdWx0JyxcbiAgICAgICAgICAgIHByZXNlcnZlTnVsbEFuZEVtcHR5QXJyYXlzOiBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICRtYXRjaDoge1xuICAgICAgICAgICAgJ3Jlc3VsdC5jcmVhdGVkQXQnOiB7XG4gICAgICAgICAgICAgICRndGU6IGNvbnZlcnRlZFN0YXJ0RGF0ZSxcbiAgICAgICAgICAgICAgJGx0ZTogY29udmVydGVkRW5kRGF0ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICR1bndpbmQ6IHtcbiAgICAgICAgICAgIHBhdGg6ICckcmVzdWx0LmRhdGFTZXQnLFxuICAgICAgICAgICAgcHJlc2VydmVOdWxsQW5kRW1wdHlBcnJheXM6IGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgJGFkZEZpZWxkczoge1xuICAgICAgICAgICAgY3JlYXRlZEF0OiAnJHJlc3VsdC5jcmVhdGVkQXQnLFxuICAgICAgICAgICAgcmVzcG9uc2VUaW1lOiAnJHJlc3VsdC5kYXRhU2V0LnJlc3BvbnNlVGltZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICAgICRvcjogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3lzdGVtSUQ6ICFib3RoQXJlTnVsbCA/IG5ldyBPYmplY3RJZChzeXN0ZW1JRCkgOiB7ICRuZTogbnVsbCB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjdXN0b21lcklEOiAhYm90aEFyZU51bGxcbiAgICAgICAgICAgICAgICAgID8gbmV3IE9iamVjdElkKGN1c3RvbWVySUQpXG4gICAgICAgICAgICAgICAgICA6IHsgJG5lOiBudWxsIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICRwcm9qZWN0OiB7XG4gICAgICAgICAgICBfaWQ6IDAsXG4gICAgICAgICAgICByZXN1bHQ6IDAsXG4gICAgICAgICAgICBzeXN0ZW1JRDogMCxcbiAgICAgICAgICAgIGN1c3RvbWVySUQ6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF1cbiAgICApO1xuICAgIGlmIChzdGF0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBzdGF0dXNDb2RlOiAyMDQsXG4gICAgICAgIGVycjogeyBtZXNzYWdlOiAnTm8gZGF0YSBjYW4gYmUgZm91bmQnIH1cbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IGRhdGE6IHN0YXRzLCBzdGF0dXM6ICdzdWNjZXNzJywgc3RhdHVzQ29kZTogMjAwIH07XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiB7IGVyciwgc3RhdHVzOiAnZXJyb3InLCBzdGF0dXNDb2RlOiA0MDAgfTtcbiAgfVxufTtcbiJdfQ==