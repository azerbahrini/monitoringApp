function cov_ss1lsfzch(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/result/getPreviousResultByTaskIDService.js";var hash="e1be06834f301aece306b8288c63962197d87ad8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/result/getPreviousResultByTaskIDService.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:41}},"1":{start:{line:2,column:17},end:{line:2,column:44}},"2":{start:{line:3,column:20},end:{line:3,column:64}},"3":{start:{line:5,column:0},end:{line:76,column:2}},"4":{start:{line:6,column:2},end:{line:75,column:3}},"5":{start:{line:7,column:16},end:{line:19,column:6}},"6":{start:{line:20,column:4},end:{line:72,column:5}},"7":{start:{line:21,column:20},end:{line:21,column:30}},"8":{start:{line:22,column:23},end:{line:34,column:8}},"9":{start:{line:35,column:6},end:{line:65,column:7}},"10":{start:{line:36,column:27},end:{line:36,column:42}},"11":{start:{line:37,column:27},end:{line:37,column:56}},"12":{start:{line:38,column:8},end:{line:58,column:9}},"13":{start:{line:39,column:10},end:{line:51,column:11}},"14":{start:{line:40,column:12},end:{line:44,column:14}},"15":{start:{line:46,column:12},end:{line:50,column:14}},"16":{start:{line:53,column:10},end:{line:57,column:12}},"17":{start:{line:60,column:8},end:{line:64,column:10}},"18":{start:{line:67,column:6},end:{line:71,column:8}},"19":{start:{line:74,column:4},end:{line:74,column:53}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:35},end:{line:76,column:1}},line:5}},branchMap:{"0":{loc:{start:{line:20,column:4},end:{line:72,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:72,column:5}},{start:{line:20,column:4},end:{line:72,column:5}}],line:20},"1":{loc:{start:{line:35,column:6},end:{line:65,column:7}},type:"if",locations:[{start:{line:35,column:6},end:{line:65,column:7}},{start:{line:35,column:6},end:{line:65,column:7}}],line:35},"2":{loc:{start:{line:38,column:8},end:{line:58,column:9}},type:"if",locations:[{start:{line:38,column:8},end:{line:58,column:9}},{start:{line:38,column:8},end:{line:58,column:9}}],line:38},"3":{loc:{start:{line:39,column:10},end:{line:51,column:11}},type:"if",locations:[{start:{line:39,column:10},end:{line:51,column:11}},{start:{line:39,column:10},end:{line:51,column:11}}],line:39}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e1be06834f301aece306b8288c63962197d87ad8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_ss1lsfzch=function(){return actualCoverage;};}return actualCoverage;}cov_ss1lsfzch();const Task=(cov_ss1lsfzch().s[0]++,require("../../models/Task"));const ObjectId=(cov_ss1lsfzch().s[1]++,require("mongodb").ObjectId);const getByTaskId=(cov_ss1lsfzch().s[2]++,require("../../services/result/getByTaskId"));cov_ss1lsfzch().s[3]++;module.exports=async taskId=>{cov_ss1lsfzch().f[0]++;cov_ss1lsfzch().s[4]++;try{const map=(cov_ss1lsfzch().s[5]++,await Task.aggregate([{$match:{_id:new ObjectId(taskId)}},{$project:{map:1,_id:0}}]));cov_ss1lsfzch().s[6]++;if(map[0]){cov_ss1lsfzch().b[0][0]++;const mapID=(cov_ss1lsfzch().s[7]++,map[0].map);const taskList=(cov_ss1lsfzch().s[8]++,await Task.aggregate([{$match:{map:new ObjectId(mapID),state:"Done"}},{$sort:{createdAt:-1}}]));cov_ss1lsfzch().s[9]++;if(taskList?.length>0){cov_ss1lsfzch().b[1][0]++;const lastTaskID=(cov_ss1lsfzch().s[10]++,taskList[0]._id);const lastResult=(cov_ss1lsfzch().s[11]++,await getByTaskId(lastTaskID));cov_ss1lsfzch().s[12]++;if(lastResult.status=="success"){cov_ss1lsfzch().b[2][0]++;cov_ss1lsfzch().s[13]++;if(lastResult.data){cov_ss1lsfzch().b[3][0]++;cov_ss1lsfzch().s[14]++;return{data:lastResult.data,status:lastResult.status,statusCode:lastResult.statusCode};}else{cov_ss1lsfzch().b[3][1]++;cov_ss1lsfzch().s[15]++;return{data:[],status:lastResult.status,statusCode:204};}}else{cov_ss1lsfzch().b[2][1]++;cov_ss1lsfzch().s[16]++;return{statusCode:lastResult.statusCode,err:{message:lastResult.err.message},status:lastResult.status};}}else{cov_ss1lsfzch().b[1][1]++;cov_ss1lsfzch().s[17]++;return{err:{message:"Failed to get the map tasks"},status:"error",statusCode:400};}}else{cov_ss1lsfzch().b[0][1]++;cov_ss1lsfzch().s[18]++;return{err:{message:"No Task Can be found with this ID."},status:"error",statusCode:404};}}catch(err){cov_ss1lsfzch().s[19]++;return{err,status:"error",statusCode:400};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFByZXZpb3VzUmVzdWx0QnlUYXNrSURTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbIlRhc2siLCJyZXF1aXJlIiwiT2JqZWN0SWQiLCJnZXRCeVRhc2tJZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0YXNrSWQiLCJtYXAiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJfaWQiLCIkcHJvamVjdCIsIm1hcElEIiwidGFza0xpc3QiLCJzdGF0ZSIsIiRzb3J0IiwiY3JlYXRlZEF0IiwibGVuZ3RoIiwibGFzdFRhc2tJRCIsImxhc3RSZXN1bHQiLCJzdGF0dXMiLCJkYXRhIiwic3RhdHVzQ29kZSIsImVyciIsIm1lc3NhZ2UiXSwibWFwcGluZ3MiOiJ1ekZBZVk7eUZBZlosS0FBTUEsQ0FBQUEsSUFBSSx5QkFBR0MsT0FBTyxDQUFDLG1CQUFELENBQVYsQ0FBVixDQUNBLEtBQU1DLENBQUFBLFFBQVEseUJBQUdELE9BQU8sQ0FBQyxTQUFELENBQVAsQ0FBbUJDLFFBQXRCLENBQWQsQ0FDQSxLQUFNQyxDQUFBQSxXQUFXLHlCQUFHRixPQUFPLENBQUMsbUNBQUQsQ0FBVixDQUFqQixDLHVCQUVBRyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsS0FBT0MsQ0FBQUEsTUFBUCxFQUFrQiwrQ0FDakMsR0FBSSxDQUNGLEtBQU1DLENBQUFBLEdBQUcseUJBQUcsS0FBTVAsQ0FBQUEsSUFBSSxDQUFDUSxTQUFMLENBQWUsQ0FDL0IsQ0FDRUMsTUFBTSxDQUFFLENBQ05DLEdBQUcsQ0FBRSxHQUFJUixDQUFBQSxRQUFKLENBQWFJLE1BQWIsQ0FEQyxDQURWLENBRCtCLENBTS9CLENBQ0VLLFFBQVEsQ0FBRSxDQUNSSixHQUFHLENBQUUsQ0FERyxDQUVSRyxHQUFHLENBQUUsQ0FGRyxDQURaLENBTitCLENBQWYsQ0FBVCxDQUFULENBREUsdUJBY0YsR0FBSUgsR0FBRyxDQUFDLENBQUQsQ0FBUCxDQUFZLDJCQUNWLEtBQU1LLENBQUFBLEtBQUsseUJBQUdMLEdBQUcsQ0FBQyxDQUFELENBQUgsQ0FBT0EsR0FBVixDQUFYLENBQ0EsS0FBTU0sQ0FBQUEsUUFBUSx5QkFBRyxLQUFNYixDQUFBQSxJQUFJLENBQUNRLFNBQUwsQ0FBZSxDQUNwQyxDQUNFQyxNQUFNLENBQUUsQ0FDTkYsR0FBRyxDQUFFLEdBQUlMLENBQUFBLFFBQUosQ0FBYVUsS0FBYixDQURDLENBRU5FLEtBQUssQ0FBRSxNQUZELENBRFYsQ0FEb0MsQ0FPcEMsQ0FDRUMsS0FBSyxDQUFFLENBQ0xDLFNBQVMsQ0FBRSxDQUFDLENBRFAsQ0FEVCxDQVBvQyxDQUFmLENBQVQsQ0FBZCxDQUZVLHVCQWVWLEdBQUlILFFBQVEsRUFBRUksTUFBVixDQUFpQixDQUFyQixDQUF3QiwyQkFDdEIsS0FBTUMsQ0FBQUEsVUFBVSwwQkFBR0wsUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZSCxHQUFmLENBQWhCLENBQ0EsS0FBTVMsQ0FBQUEsVUFBVSwwQkFBRyxLQUFNaEIsQ0FBQUEsV0FBVyxDQUFDZSxVQUFELENBQXBCLENBQWhCLENBRnNCLHdCQUd0QixHQUFJQyxVQUFVLENBQUNDLE1BQVgsRUFBcUIsU0FBekIsQ0FBb0MsbURBQ2xDLEdBQUlELFVBQVUsQ0FBQ0UsSUFBZixDQUFxQixtREFDbkIsTUFBTyxDQUNMQSxJQUFJLENBQUVGLFVBQVUsQ0FBQ0UsSUFEWixDQUVMRCxNQUFNLENBQUVELFVBQVUsQ0FBQ0MsTUFGZCxDQUdMRSxVQUFVLENBQUVILFVBQVUsQ0FBQ0csVUFIbEIsQ0FBUCxDQUtELENBTkQsSUFNTyxtREFDTCxNQUFPLENBQ0xELElBQUksQ0FBRSxFQURELENBRUxELE1BQU0sQ0FBRUQsVUFBVSxDQUFDQyxNQUZkLENBR0xFLFVBQVUsQ0FBRSxHQUhQLENBQVAsQ0FLRCxDQUNGLENBZEQsSUFjTyxtREFDTCxNQUFPLENBQ0xBLFVBQVUsQ0FBRUgsVUFBVSxDQUFDRyxVQURsQixDQUVMQyxHQUFHLENBQUUsQ0FBRUMsT0FBTyxDQUFFTCxVQUFVLENBQUNJLEdBQVgsQ0FBZUMsT0FBMUIsQ0FGQSxDQUdMSixNQUFNLENBQUVELFVBQVUsQ0FBQ0MsTUFIZCxDQUFQLENBS0QsQ0FDRixDQXhCRCxJQXdCTyxtREFDTCxNQUFPLENBQ0xHLEdBQUcsQ0FBRSxDQUFFQyxPQUFPLENBQUUsNkJBQVgsQ0FEQSxDQUVMSixNQUFNLENBQUUsT0FGSCxDQUdMRSxVQUFVLENBQUUsR0FIUCxDQUFQLENBS0QsQ0FDRixDQTlDRCxJQThDTyxtREFDTCxNQUFPLENBQ0xDLEdBQUcsQ0FBRSxDQUFFQyxPQUFPLENBQUUsb0NBQVgsQ0FEQSxDQUVMSixNQUFNLENBQUUsT0FGSCxDQUdMRSxVQUFVLENBQUUsR0FIUCxDQUFQLENBS0QsQ0FDRixDQUFDLE1BQU9DLEdBQVAsQ0FBWSx5QkFDWixNQUFPLENBQUVBLEdBQUYsQ0FBT0gsTUFBTSxDQUFFLE9BQWYsQ0FBd0JFLFVBQVUsQ0FBRSxHQUFwQyxDQUFQLENBQ0QsQ0FDRixDQXZFRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRhc2sgPSByZXF1aXJlKFwiLi4vLi4vbW9kZWxzL1Rhc2tcIik7XG5jb25zdCBPYmplY3RJZCA9IHJlcXVpcmUoXCJtb25nb2RiXCIpLk9iamVjdElkO1xuY29uc3QgZ2V0QnlUYXNrSWQgPSByZXF1aXJlKFwiLi4vLi4vc2VydmljZXMvcmVzdWx0L2dldEJ5VGFza0lkXCIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jICh0YXNrSWQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBtYXAgPSBhd2FpdCBUYXNrLmFnZ3JlZ2F0ZShbXG4gICAgICB7XG4gICAgICAgICRtYXRjaDoge1xuICAgICAgICAgIF9pZDogbmV3IE9iamVjdElkKHRhc2tJZCksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICAkcHJvamVjdDoge1xuICAgICAgICAgIG1hcDogMSxcbiAgICAgICAgICBfaWQ6IDAsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF0pO1xuICAgIGlmIChtYXBbMF0pIHtcbiAgICAgIGNvbnN0IG1hcElEID0gbWFwWzBdLm1hcDtcbiAgICAgIGNvbnN0IHRhc2tMaXN0ID0gYXdhaXQgVGFzay5hZ2dyZWdhdGUoW1xuICAgICAgICB7XG4gICAgICAgICAgJG1hdGNoOiB7XG4gICAgICAgICAgICBtYXA6IG5ldyBPYmplY3RJZChtYXBJRCksXG4gICAgICAgICAgICBzdGF0ZTogXCJEb25lXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICRzb3J0OiB7XG4gICAgICAgICAgICBjcmVhdGVkQXQ6IC0xLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdKTtcbiAgICAgIGlmICh0YXNrTGlzdD8ubGVuZ3RoPjApIHtcbiAgICAgICAgY29uc3QgbGFzdFRhc2tJRCA9IHRhc2tMaXN0WzBdLl9pZDtcbiAgICAgICAgY29uc3QgbGFzdFJlc3VsdCA9IGF3YWl0IGdldEJ5VGFza0lkKGxhc3RUYXNrSUQpO1xuICAgICAgICBpZiAobGFzdFJlc3VsdC5zdGF0dXMgPT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICBpZiAobGFzdFJlc3VsdC5kYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBkYXRhOiBsYXN0UmVzdWx0LmRhdGEsXG4gICAgICAgICAgICAgIHN0YXR1czogbGFzdFJlc3VsdC5zdGF0dXMsXG4gICAgICAgICAgICAgIHN0YXR1c0NvZGU6IGxhc3RSZXN1bHQuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgICBzdGF0dXM6IGxhc3RSZXN1bHQuc3RhdHVzLFxuICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3RhdHVzQ29kZTogbGFzdFJlc3VsdC5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgZXJyOiB7IG1lc3NhZ2U6IGxhc3RSZXN1bHQuZXJyLm1lc3NhZ2UgfSxcbiAgICAgICAgICAgIHN0YXR1czogbGFzdFJlc3VsdC5zdGF0dXMsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBlcnI6IHsgbWVzc2FnZTogXCJGYWlsZWQgdG8gZ2V0IHRoZSBtYXAgdGFza3NcIiB9LFxuICAgICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyOiB7IG1lc3NhZ2U6IFwiTm8gVGFzayBDYW4gYmUgZm91bmQgd2l0aCB0aGlzIElELlwiIH0sXG4gICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHsgZXJyLCBzdGF0dXM6IFwiZXJyb3JcIiwgc3RhdHVzQ29kZTogNDAwIH07XG4gIH1cbn07XG4iXX0=