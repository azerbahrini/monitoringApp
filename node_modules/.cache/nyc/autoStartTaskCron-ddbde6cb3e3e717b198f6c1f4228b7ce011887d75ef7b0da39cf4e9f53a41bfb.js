function cov_3yjyeo3y7(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/task/autoStartTaskCron.js";var hash="805a86b85afc7bf6b62aa45f7ebae0c374a1f36a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/task/autoStartTaskCron.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:39}},"1":{start:{line:2,column:26},end:{line:2,column:50}},"2":{start:{line:3,column:23},end:{line:3,column:50}},"3":{start:{line:4,column:15},end:{line:4,column:45}},"4":{start:{line:5,column:15},end:{line:5,column:32}},"5":{start:{line:7,column:0},end:{line:42,column:2}},"6":{start:{line:8,column:2},end:{line:41,column:3}},"7":{start:{line:9,column:4},end:{line:38,column:5}},"8":{start:{line:10,column:28},end:{line:10,column:61}},"9":{start:{line:11,column:6},end:{line:37,column:7}},"10":{start:{line:12,column:8},end:{line:12,column:33}},"11":{start:{line:13,column:13},end:{line:37,column:7}},"12":{start:{line:14,column:18},end:{line:34,column:7}},"13":{start:{line:17,column:10},end:{line:29,column:11}},"14":{start:{line:18,column:25},end:{line:20,column:13}},"15":{start:{line:21,column:32},end:{line:21,column:71}},"16":{start:{line:22,column:12},end:{line:28,column:13}},"17":{start:{line:23,column:14},end:{line:23,column:53}},"18":{start:{line:24,column:14},end:{line:24,column:65}},"19":{start:{line:25,column:14},end:{line:25,column:39}},"20":{start:{line:27,column:14},end:{line:27,column:53}},"21":{start:{line:35,column:6},end:{line:35,column:18}},"22":{start:{line:36,column:6},end:{line:36,column:51}},"23":{start:{line:40,column:4},end:{line:40,column:79}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:27},end:{line:42,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:8},end:{line:16,column:9}},loc:{start:{line:16,column:26},end:{line:30,column:9}},line:16}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:38,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:38,column:5}},{start:{line:9,column:4},end:{line:38,column:5}}],line:9},"1":{loc:{start:{line:11,column:6},end:{line:37,column:7}},type:"if",locations:[{start:{line:11,column:6},end:{line:37,column:7}},{start:{line:11,column:6},end:{line:37,column:7}}],line:11},"2":{loc:{start:{line:11,column:10},end:{line:11,column:74}},type:"binary-expr",locations:[{start:{line:11,column:10},end:{line:11,column:38}},{start:{line:11,column:42},end:{line:11,column:74}}],line:11},"3":{loc:{start:{line:13,column:13},end:{line:37,column:7}},type:"if",locations:[{start:{line:13,column:13},end:{line:37,column:7}},{start:{line:13,column:13},end:{line:37,column:7}}],line:13},"4":{loc:{start:{line:17,column:10},end:{line:29,column:11}},type:"if",locations:[{start:{line:17,column:10},end:{line:29,column:11}},{start:{line:17,column:10},end:{line:29,column:11}}],line:17},"5":{loc:{start:{line:22,column:12},end:{line:28,column:13}},type:"if",locations:[{start:{line:22,column:12},end:{line:28,column:13}},{start:{line:22,column:12},end:{line:28,column:13}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"805a86b85afc7bf6b62aa45f7ebae0c374a1f36a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_3yjyeo3y7=function(){return actualCoverage;};}return actualCoverage;}cov_3yjyeo3y7();const CronJob=(cov_3yjyeo3y7().s[0]++,require('cron').CronJob);const updateTaskService=(cov_3yjyeo3y7().s[1]++,require('./updateTasks'));const autoCancelCron=(cov_3yjyeo3y7().s[2]++,require('./autoCancelCron'));const logger=(cov_3yjyeo3y7().s[3]++,require('../../config/logger'));const moment=(cov_3yjyeo3y7().s[4]++,require('moment'));cov_3yjyeo3y7().s[5]++;module.exports=task=>{cov_3yjyeo3y7().f[0]++;cov_3yjyeo3y7().s[6]++;try{cov_3yjyeo3y7().s[7]++;if(task){cov_3yjyeo3y7().b[0][0]++;const startDateTime=(cov_3yjyeo3y7().s[8]++,moment(task.estimatedStart).utc());cov_3yjyeo3y7().s[9]++;if((cov_3yjyeo3y7().b[2][0]++,task.state==='In progress')||(cov_3yjyeo3y7().b[2][1]++,task.state==='To be validated')){cov_3yjyeo3y7().b[1][0]++;cov_3yjyeo3y7().s[10]++;autoCancelCron(task._id);}else{cov_3yjyeo3y7().b[1][1]++;cov_3yjyeo3y7().s[11]++;if(task.state==='Pending'){cov_3yjyeo3y7().b[3][0]++;const job=(cov_3yjyeo3y7().s[12]++,new CronJob(startDateTime,async function(){cov_3yjyeo3y7().f[1]++;cov_3yjyeo3y7().s[13]++;if(task.state==='Pending'){cov_3yjyeo3y7().b[4][0]++;const body=(cov_3yjyeo3y7().s[14]++,{state:'In progress'});const startedTask=(cov_3yjyeo3y7().s[15]++,await updateTaskService(task._id,body));cov_3yjyeo3y7().s[16]++;if(startedTask.status==='success'){cov_3yjyeo3y7().b[5][0]++;cov_3yjyeo3y7().s[17]++;logger.info('Auto start Task success');cov_3yjyeo3y7().s[18]++;logger.info('Task state change sent with socket!');cov_3yjyeo3y7().s[19]++;autoCancelCron(task._id);}else{cov_3yjyeo3y7().b[5][1]++;cov_3yjyeo3y7().s[20]++;logger.error('Auto-Start Task Failed');}}else{cov_3yjyeo3y7().b[4][1]++;}},null,true,'UTC'));cov_3yjyeo3y7().s[21]++;job.start();cov_3yjyeo3y7().s[22]++;logger.info('Auto start Task cron launched');}else{cov_3yjyeo3y7().b[3][1]++;}}}else{cov_3yjyeo3y7().b[0][1]++;}}catch(error){cov_3yjyeo3y7().s[23]++;logger.error('An unexpected error occurred during auto start task',error);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG9TdGFydFRhc2tDcm9uLmpzIl0sIm5hbWVzIjpbIkNyb25Kb2IiLCJyZXF1aXJlIiwidXBkYXRlVGFza1NlcnZpY2UiLCJhdXRvQ2FuY2VsQ3JvbiIsImxvZ2dlciIsIm1vbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0YXNrIiwic3RhcnREYXRlVGltZSIsImVzdGltYXRlZFN0YXJ0IiwidXRjIiwic3RhdGUiLCJfaWQiLCJqb2IiLCJib2R5Iiwic3RhcnRlZFRhc2siLCJzdGF0dXMiLCJpbmZvIiwiZXJyb3IiLCJzdGFydCJdLCJtYXBwaW5ncyI6IjhrSEFlWTt5RkFmWixLQUFNQSxDQUFBQSxPQUFPLHlCQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFQLENBQWdCRCxPQUFuQixDQUFiLENBQ0EsS0FBTUUsQ0FBQUEsaUJBQWlCLHlCQUFHRCxPQUFPLENBQUMsZUFBRCxDQUFWLENBQXZCLENBQ0EsS0FBTUUsQ0FBQUEsY0FBYyx5QkFBR0YsT0FBTyxDQUFDLGtCQUFELENBQVYsQ0FBcEIsQ0FDQSxLQUFNRyxDQUFBQSxNQUFNLHlCQUFHSCxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUksQ0FBQUEsTUFBTSx5QkFBR0osT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLEMsdUJBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxDQUFrQkMsSUFBRCxFQUFVLCtDQUN6QixHQUFJLHdCQUNGLEdBQUlBLElBQUosQ0FBVSwyQkFDUixLQUFNQyxDQUFBQSxhQUFhLHlCQUFHSixNQUFNLENBQUNHLElBQUksQ0FBQ0UsY0FBTixDQUFOLENBQTRCQyxHQUE1QixFQUFILENBQW5CLENBRFEsdUJBRVIsR0FBSSwyQkFBQUgsSUFBSSxDQUFDSSxLQUFMLEdBQWUsYUFBZiw4QkFBZ0NKLElBQUksQ0FBQ0ksS0FBTCxHQUFlLGlCQUEvQyxDQUFKLENBQXNFLG1EQUNwRVQsY0FBYyxDQUFDSyxJQUFJLENBQUNLLEdBQU4sQ0FBZCxDQUNELENBRkQsSUFFTyxzREFBSUwsSUFBSSxDQUFDSSxLQUFMLEdBQWUsU0FBbkIsQ0FBNkIsMkJBQ3BDLEtBQU1FLENBQUFBLEdBQUcsMEJBQUcsR0FBSWQsQ0FBQUEsT0FBSixDQUNWUyxhQURVLENBRVYsZ0JBQWtCLGdEQUNoQixHQUFJRCxJQUFJLENBQUNJLEtBQUwsR0FBZSxTQUFuQixDQUE4QiwyQkFDNUIsS0FBTUcsQ0FBQUEsSUFBSSwwQkFBRyxDQUNYSCxLQUFLLENBQUUsYUFESSxDQUFILENBQVYsQ0FHQSxLQUFNSSxDQUFBQSxXQUFXLDBCQUFHLEtBQU1kLENBQUFBLGlCQUFpQixDQUFDTSxJQUFJLENBQUNLLEdBQU4sQ0FBV0UsSUFBWCxDQUExQixDQUFqQixDQUo0Qix3QkFLNUIsR0FBSUMsV0FBVyxDQUFDQyxNQUFaLEdBQXVCLFNBQTNCLENBQXNDLG1EQUNwQ2IsTUFBTSxDQUFDYyxJQUFQLENBQVkseUJBQVosRUFEb0Msd0JBRXBDZCxNQUFNLENBQUNjLElBQVAsQ0FBWSxxQ0FBWixFQUZvQyx3QkFHcENmLGNBQWMsQ0FBQ0ssSUFBSSxDQUFDSyxHQUFOLENBQWQsQ0FDRCxDQUpELElBSU8sbURBQ0xULE1BQU0sQ0FBQ2UsS0FBUCxDQUFhLHdCQUFiLEVBQ0QsQ0FDRixDQVpELGdDQWFELENBaEJTLENBaUJWLElBakJVLENBa0JWLElBbEJVLENBbUJWLEtBbkJVLENBQUgsQ0FBVCxDQURvQyx3QkFzQnBDTCxHQUFHLENBQUNNLEtBQUosR0F0Qm9DLHdCQXVCcENoQixNQUFNLENBQUNjLElBQVAsQ0FBWSwrQkFBWixFQUNDLENBeEJNLGdDQXdCTixDQUNGLENBN0JELGdDQThCRCxDQUFDLE1BQU9DLEtBQVAsQ0FBYyx5QkFDZGYsTUFBTSxDQUFDZSxLQUFQLENBQWEscURBQWIsQ0FBb0VBLEtBQXBFLEVBQ0QsQ0FDRixDQW5DRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENyb25Kb2IgPSByZXF1aXJlKCdjcm9uJykuQ3JvbkpvYjtcbmNvbnN0IHVwZGF0ZVRhc2tTZXJ2aWNlID0gcmVxdWlyZSgnLi91cGRhdGVUYXNrcycpO1xuY29uc3QgYXV0b0NhbmNlbENyb24gPSByZXF1aXJlKCcuL2F1dG9DYW5jZWxDcm9uJyk7XG5jb25zdCBsb2dnZXIgPSByZXF1aXJlKCcuLi8uLi9jb25maWcvbG9nZ2VyJyk7XG5jb25zdCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcblxubW9kdWxlLmV4cG9ydHMgPSAodGFzaykgPT4ge1xuICB0cnkge1xuICAgIGlmICh0YXNrKSB7XG4gICAgICBjb25zdCBzdGFydERhdGVUaW1lID0gbW9tZW50KHRhc2suZXN0aW1hdGVkU3RhcnQpLnV0YygpO1xuICAgICAgaWYgKHRhc2suc3RhdGUgPT09ICdJbiBwcm9ncmVzcycgfHwgdGFzay5zdGF0ZSA9PT0gJ1RvIGJlIHZhbGlkYXRlZCcpIHtcbiAgICAgICAgYXV0b0NhbmNlbENyb24odGFzay5faWQpO1xuICAgICAgfSBlbHNlIGlmICh0YXNrLnN0YXRlID09PSAnUGVuZGluZycpe1xuICAgICAgY29uc3Qgam9iID0gbmV3IENyb25Kb2IoXG4gICAgICAgIHN0YXJ0RGF0ZVRpbWUsXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAodGFzay5zdGF0ZSA9PT0gJ1BlbmRpbmcnKSB7XG4gICAgICAgICAgICBjb25zdCBib2R5ID0ge1xuICAgICAgICAgICAgICBzdGF0ZTogJ0luIHByb2dyZXNzJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ZWRUYXNrID0gYXdhaXQgdXBkYXRlVGFza1NlcnZpY2UodGFzay5faWQsIGJvZHkpO1xuICAgICAgICAgICAgaWYgKHN0YXJ0ZWRUYXNrLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdBdXRvIHN0YXJ0IFRhc2sgc3VjY2VzcycpO1xuICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnVGFzayBzdGF0ZSBjaGFuZ2Ugc2VudCB3aXRoIHNvY2tldCEnKTtcbiAgICAgICAgICAgICAgYXV0b0NhbmNlbENyb24odGFzay5faWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdBdXRvLVN0YXJ0IFRhc2sgRmFpbGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBudWxsLFxuICAgICAgICB0cnVlLFxuICAgICAgICAnVVRDJ1xuICAgICAgKTtcbiAgICAgIGpvYi5zdGFydCgpO1xuICAgICAgbG9nZ2VyLmluZm8oJ0F1dG8gc3RhcnQgVGFzayBjcm9uIGxhdW5jaGVkJyk7XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCBkdXJpbmcgYXV0byBzdGFydCB0YXNrJywgZXJyb3IpO1xuICB9XG59O1xuIl19