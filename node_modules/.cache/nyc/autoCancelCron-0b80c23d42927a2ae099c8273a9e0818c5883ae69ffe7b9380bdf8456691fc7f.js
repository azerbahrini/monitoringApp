function cov_1eam1kp2qr(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/task/autoCancelCron.js";var hash="21008c877772b4d034c8a4e4499f2062f9c64d84";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/task/autoCancelCron.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:36}},"1":{start:{line:2,column:13},end:{line:2,column:41}},"2":{start:{line:3,column:20},end:{line:3,column:44}},"3":{start:{line:4,column:15},end:{line:4,column:45}},"4":{start:{line:5,column:15},end:{line:5,column:32}},"5":{start:{line:7,column:0},end:{line:50,column:2}},"6":{start:{line:8,column:2},end:{line:49,column:3}},"7":{start:{line:9,column:24},end:{line:9,column:69}},"8":{start:{line:10,column:27},end:{line:10,column:79}},"9":{start:{line:11,column:16},end:{line:40,column:5}},"10":{start:{line:14,column:21},end:{line:14,column:66}},"11":{start:{line:15,column:8},end:{line:32,column:9}},"12":{start:{line:16,column:10},end:{line:16,column:34}},"13":{start:{line:17,column:31},end:{line:17,column:58}},"14":{start:{line:18,column:10},end:{line:23,column:11}},"15":{start:{line:19,column:12},end:{line:19,column:50}},"16":{start:{line:20,column:12},end:{line:20,column:63}},"17":{start:{line:22,column:12},end:{line:22,column:59}},"18":{start:{line:24,column:15},end:{line:32,column:9}},"19":{start:{line:25,column:10},end:{line:25,column:30}},"20":{start:{line:26,column:27},end:{line:26,column:54}},"21":{start:{line:27,column:10},end:{line:31,column:11}},"22":{start:{line:28,column:12},end:{line:28,column:46}},"23":{start:{line:30,column:12},end:{line:30,column:57}},"24":{start:{line:44,column:4},end:{line:44,column:16}},"25":{start:{line:45,column:4},end:{line:45,column:55}},"26":{start:{line:48,column:4},end:{line:48,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:31},end:{line:50,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:6},end:{line:13,column:7}},loc:{start:{line:13,column:24},end:{line:36,column:7}},line:13}},branchMap:{"0":{loc:{start:{line:15,column:8},end:{line:32,column:9}},type:"if",locations:[{start:{line:15,column:8},end:{line:32,column:9}},{start:{line:15,column:8},end:{line:32,column:9}}],line:15},"1":{loc:{start:{line:15,column:12},end:{line:15,column:78}},type:"binary-expr",locations:[{start:{line:15,column:12},end:{line:15,column:41}},{start:{line:15,column:45},end:{line:15,column:78}}],line:15},"2":{loc:{start:{line:18,column:10},end:{line:23,column:11}},type:"if",locations:[{start:{line:18,column:10},end:{line:23,column:11}},{start:{line:18,column:10},end:{line:23,column:11}}],line:18},"3":{loc:{start:{line:24,column:15},end:{line:32,column:9}},type:"if",locations:[{start:{line:24,column:15},end:{line:32,column:9}},{start:{line:24,column:15},end:{line:32,column:9}}],line:24},"4":{loc:{start:{line:27,column:10},end:{line:31,column:11}},type:"if",locations:[{start:{line:27,column:10},end:{line:31,column:11}},{start:{line:27,column:10},end:{line:31,column:11}}],line:27}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"21008c877772b4d034c8a4e4499f2062f9c64d84"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1eam1kp2qr=function(){return actualCoverage;};}return actualCoverage;}cov_1eam1kp2qr();const cron=(cov_1eam1kp2qr().s[0]++,require('cron').CronJob);const Task=(cov_1eam1kp2qr().s[1]++,require('../../models/Task'));const updateTasks=(cov_1eam1kp2qr().s[2]++,require('./updateTasks'));const logger=(cov_1eam1kp2qr().s[3]++,require('../../config/logger'));const moment=(cov_1eam1kp2qr().s[4]++,require('moment'));cov_1eam1kp2qr().s[5]++;module.exports=async id=>{cov_1eam1kp2qr().f[0]++;cov_1eam1kp2qr().s[6]++;try{const currentTask=(cov_1eam1kp2qr().s[7]++,await Task.findOne({_id:id}).lean().exec());const cancelDateTime=(cov_1eam1kp2qr().s[8]++,moment(currentTask.estimatedStart).utc().add(2,'h'));const job=(cov_1eam1kp2qr().s[9]++,new cron(cancelDateTime,async function(){cov_1eam1kp2qr().f[1]++;const task=(cov_1eam1kp2qr().s[10]++,await Task.findOne({_id:id}).lean().exec());cov_1eam1kp2qr().s[11]++;if((cov_1eam1kp2qr().b[1][0]++,task?.state==='In progress')||(cov_1eam1kp2qr().b[1][1]++,task?.state==='To be validated')){cov_1eam1kp2qr().b[0][0]++;cov_1eam1kp2qr().s[12]++;task.state='Canceled';const canceledTask=(cov_1eam1kp2qr().s[13]++,await updateTasks(id,task));cov_1eam1kp2qr().s[14]++;if(canceledTask.status==='success'){cov_1eam1kp2qr().b[2][0]++;cov_1eam1kp2qr().s[15]++;logger.info('Auto Canceled the Task');cov_1eam1kp2qr().s[16]++;logger.info(`Task state change sent with socket!`);}else{cov_1eam1kp2qr().b[2][1]++;cov_1eam1kp2qr().s[17]++;logger.error('Failed to Auto-Cancel the Task');}}else{cov_1eam1kp2qr().b[0][1]++;cov_1eam1kp2qr().s[18]++;if(task?.state==='Completed'){cov_1eam1kp2qr().b[3][0]++;cov_1eam1kp2qr().s[19]++;task.state='Done';const doneTask=(cov_1eam1kp2qr().s[20]++,await updateTasks(id,task));cov_1eam1kp2qr().s[21]++;if(doneTask.status==='success'){cov_1eam1kp2qr().b[4][0]++;cov_1eam1kp2qr().s[22]++;logger.info('Auto Done the Task');}else{cov_1eam1kp2qr().b[4][1]++;cov_1eam1kp2qr().s[23]++;logger.error('Failed to Auto-Done the Task');}}else{cov_1eam1kp2qr().b[3][1]++;}}// console.log('stopped the crone at');
// console.log(new Date().toLocaleString());
// console.log('stopped the crone at');
},null,true,'UTC'));// console.log('started the crone at');
// console.log(new Date().toLocaleString());
// console.log('started the crone at');
cov_1eam1kp2qr().s[24]++;job.start();cov_1eam1kp2qr().s[25]++;logger.info('Auto cancel/Done Task cron launched');}catch(error){cov_1eam1kp2qr().s[26]++;logger.error('An unexpected error occurred',error);}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG9DYW5jZWxDcm9uLmpzIl0sIm5hbWVzIjpbImNyb24iLCJyZXF1aXJlIiwiQ3JvbkpvYiIsIlRhc2siLCJ1cGRhdGVUYXNrcyIsImxvZ2dlciIsIm1vbWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJpZCIsImN1cnJlbnRUYXNrIiwiZmluZE9uZSIsIl9pZCIsImxlYW4iLCJleGVjIiwiY2FuY2VsRGF0ZVRpbWUiLCJlc3RpbWF0ZWRTdGFydCIsInV0YyIsImFkZCIsImpvYiIsInRhc2siLCJzdGF0ZSIsImNhbmNlbGVkVGFzayIsInN0YXR1cyIsImluZm8iLCJlcnJvciIsImRvbmVUYXNrIiwic3RhcnQiXSwibWFwcGluZ3MiOiJ1a0hBZVk7MkZBZlosS0FBTUEsQ0FBQUEsSUFBSSwwQkFBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBUCxDQUFnQkMsT0FBbkIsQ0FBVixDQUNBLEtBQU1DLENBQUFBLElBQUksMEJBQUdGLE9BQU8sQ0FBQyxtQkFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNRyxDQUFBQSxXQUFXLDBCQUFHSCxPQUFPLENBQUMsZUFBRCxDQUFWLENBQWpCLENBQ0EsS0FBTUksQ0FBQUEsTUFBTSwwQkFBR0osT0FBTyxDQUFDLHFCQUFELENBQVYsQ0FBWixDQUNBLEtBQU1LLENBQUFBLE1BQU0sMEJBQUdMLE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBWixDLHdCQUVBTSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsS0FBT0MsQ0FBQUEsRUFBUCxFQUFjLGlEQUM3QixHQUFJLENBQ0YsS0FBTUMsQ0FBQUEsV0FBVywwQkFBRyxLQUFNUCxDQUFBQSxJQUFJLENBQUNRLE9BQUwsQ0FBYSxDQUFFQyxHQUFHLENBQUVILEVBQVAsQ0FBYixFQUEwQkksSUFBMUIsR0FBaUNDLElBQWpDLEVBQVQsQ0FBakIsQ0FDQSxLQUFNQyxDQUFBQSxjQUFjLDBCQUFHVCxNQUFNLENBQUNJLFdBQVcsQ0FBQ00sY0FBYixDQUFOLENBQW1DQyxHQUFuQyxHQUF5Q0MsR0FBekMsQ0FBNkMsQ0FBN0MsQ0FBZ0QsR0FBaEQsQ0FBSCxDQUFwQixDQUNBLEtBQU1DLENBQUFBLEdBQUcsMEJBQUcsR0FBSW5CLENBQUFBLElBQUosQ0FDVmUsY0FEVSxDQUVWLGdCQUFrQix5QkFDaEIsS0FBTUssQ0FBQUEsSUFBSSwyQkFBRyxLQUFNakIsQ0FBQUEsSUFBSSxDQUFDUSxPQUFMLENBQWEsQ0FBRUMsR0FBRyxDQUFFSCxFQUFQLENBQWIsRUFBMEJJLElBQTFCLEdBQWlDQyxJQUFqQyxFQUFULENBQVYsQ0FEZ0IseUJBRWhCLEdBQUksNEJBQUFNLElBQUksRUFBRUMsS0FBTixHQUFnQixhQUFoQiwrQkFBaUNELElBQUksRUFBRUMsS0FBTixHQUFnQixpQkFBakQsQ0FBSixDQUF3RSxxREFDdEVELElBQUksQ0FBQ0MsS0FBTCxDQUFhLFVBQWIsQ0FDQSxLQUFNQyxDQUFBQSxZQUFZLDJCQUFHLEtBQU1sQixDQUFBQSxXQUFXLENBQUNLLEVBQUQsQ0FBS1csSUFBTCxDQUFwQixDQUFsQixDQUZzRSx5QkFHdEUsR0FBSUUsWUFBWSxDQUFDQyxNQUFiLEdBQXdCLFNBQTVCLENBQXVDLHFEQUNyQ2xCLE1BQU0sQ0FBQ21CLElBQVAsQ0FBWSx3QkFBWixFQURxQyx5QkFFckNuQixNQUFNLENBQUNtQixJQUFQLENBQWEscUNBQWIsRUFDRCxDQUhELElBR08scURBQ0xuQixNQUFNLENBQUNvQixLQUFQLENBQWEsZ0NBQWIsRUFDRCxDQUNGLENBVEQsSUFTTyx3REFBSUwsSUFBSSxFQUFFQyxLQUFOLEdBQWdCLFdBQXBCLENBQWdDLHFEQUNyQ0QsSUFBSSxDQUFDQyxLQUFMLENBQWEsTUFBYixDQUNBLEtBQU1LLENBQUFBLFFBQVEsMkJBQUcsS0FBTXRCLENBQUFBLFdBQVcsQ0FBQ0ssRUFBRCxDQUFLVyxJQUFMLENBQXBCLENBQWQsQ0FGcUMseUJBR3JDLEdBQUlNLFFBQVEsQ0FBQ0gsTUFBVCxHQUFvQixTQUF4QixDQUFtQyxxREFDakNsQixNQUFNLENBQUNtQixJQUFQLENBQVksb0JBQVosRUFDRCxDQUZELElBRU8scURBQ0xuQixNQUFNLENBQUNvQixLQUFQLENBQWEsOEJBQWIsRUFDRCxDQUNGLENBUk0saUNBUU4sQ0FDRDtBQUNBO0FBQ0E7QUFDRCxDQXpCUyxDQTBCVixJQTFCVSxDQTJCVixJQTNCVSxDQTRCVixLQTVCVSxDQUFILENBQVQsQ0E4QkE7QUFDQTtBQUNBO0FBbkNFLHlCQW9DRk4sR0FBRyxDQUFDUSxLQUFKLEdBcENFLHlCQXFDRnRCLE1BQU0sQ0FBQ21CLElBQVAsQ0FBWSxxQ0FBWixFQUVELENBQUMsTUFBT0MsS0FBUCxDQUFjLDBCQUNkcEIsTUFBTSxDQUFDb0IsS0FBUCxDQUFhLDhCQUFiLENBQTZDQSxLQUE3QyxFQUNELENBQ0YsQ0EzQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjcm9uID0gcmVxdWlyZSgnY3JvbicpLkNyb25Kb2I7XG5jb25zdCBUYXNrID0gcmVxdWlyZSgnLi4vLi4vbW9kZWxzL1Rhc2snKTtcbmNvbnN0IHVwZGF0ZVRhc2tzID0gcmVxdWlyZSgnLi91cGRhdGVUYXNrcycpO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vLi4vY29uZmlnL2xvZ2dlcicpO1xuY29uc3QgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGlkKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY3VycmVudFRhc2sgPSBhd2FpdCBUYXNrLmZpbmRPbmUoeyBfaWQ6IGlkIH0pLmxlYW4oKS5leGVjKCk7XG4gICAgY29uc3QgY2FuY2VsRGF0ZVRpbWUgPSBtb21lbnQoY3VycmVudFRhc2suZXN0aW1hdGVkU3RhcnQpLnV0YygpLmFkZCgyLCAnaCcpO1xuICAgIGNvbnN0IGpvYiA9IG5ldyBjcm9uKFxuICAgICAgY2FuY2VsRGF0ZVRpbWUsXG4gICAgICBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBhd2FpdCBUYXNrLmZpbmRPbmUoeyBfaWQ6IGlkIH0pLmxlYW4oKS5leGVjKCk7XG4gICAgICAgIGlmICh0YXNrPy5zdGF0ZSA9PT0gJ0luIHByb2dyZXNzJyB8fCB0YXNrPy5zdGF0ZSA9PT0gJ1RvIGJlIHZhbGlkYXRlZCcpIHtcbiAgICAgICAgICB0YXNrLnN0YXRlID0gJ0NhbmNlbGVkJztcbiAgICAgICAgICBjb25zdCBjYW5jZWxlZFRhc2sgPSBhd2FpdCB1cGRhdGVUYXNrcyhpZCwgdGFzayk7XG4gICAgICAgICAgaWYgKGNhbmNlbGVkVGFzay5zdGF0dXMgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0F1dG8gQ2FuY2VsZWQgdGhlIFRhc2snKTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGBUYXNrIHN0YXRlIGNoYW5nZSBzZW50IHdpdGggc29ja2V0IWApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBBdXRvLUNhbmNlbCB0aGUgVGFzaycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0YXNrPy5zdGF0ZSA9PT0gJ0NvbXBsZXRlZCcpe1xuICAgICAgICAgIHRhc2suc3RhdGUgPSAnRG9uZSc7XG4gICAgICAgICAgY29uc3QgZG9uZVRhc2sgPSBhd2FpdCB1cGRhdGVUYXNrcyhpZCwgdGFzayk7XG4gICAgICAgICAgaWYgKGRvbmVUYXNrLnN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnQXV0byBEb25lIHRoZSBUYXNrJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIEF1dG8tRG9uZSB0aGUgVGFzaycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBjb25zb2xlLmxvZygnc3RvcHBlZCB0aGUgY3JvbmUgYXQnKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2cobmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3N0b3BwZWQgdGhlIGNyb25lIGF0Jyk7XG4gICAgICB9LFxuICAgICAgbnVsbCxcbiAgICAgIHRydWUsXG4gICAgICAnVVRDJ1xuICAgICk7XG4gICAgLy8gY29uc29sZS5sb2coJ3N0YXJ0ZWQgdGhlIGNyb25lIGF0Jyk7XG4gICAgLy8gY29uc29sZS5sb2cobmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpKTtcbiAgICAvLyBjb25zb2xlLmxvZygnc3RhcnRlZCB0aGUgY3JvbmUgYXQnKTtcbiAgICBqb2Iuc3RhcnQoKTtcbiAgICBsb2dnZXIuaW5mbygnQXV0byBjYW5jZWwvRG9uZSBUYXNrIGNyb24gbGF1bmNoZWQnKTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCcsIGVycm9yKTtcbiAgfVxufTtcbiJdfQ==