function cov_2avtsmtx6s(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/user/changePassword.service.js";var hash="e64c5f4ec4a2de1a44af470860f418469e9b868b";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/user/changePassword.service.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:34}},"1":{start:{line:3,column:13},end:{line:3,column:41}},"2":{start:{line:4,column:0},end:{line:45,column:2}},"3":{start:{line:5,column:2},end:{line:44,column:3}},"4":{start:{line:7,column:17},end:{line:7,column:44}},"5":{start:{line:9,column:4},end:{line:15,column:5}},"6":{start:{line:10,column:6},end:{line:14,column:8}},"7":{start:{line:16,column:17},end:{line:16,column:41}},"8":{start:{line:17,column:25},end:{line:17,column:65}},"9":{start:{line:18,column:20},end:{line:18,column:76}},"10":{start:{line:20,column:4},end:{line:38,column:5}},"11":{start:{line:21,column:6},end:{line:25,column:8}},"12":{start:{line:27,column:26},end:{line:33,column:15}},"13":{start:{line:34,column:6},end:{line:37,column:8}},"14":{start:{line:40,column:4},end:{line:43,column:6}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:4,column:17},end:{line:4,column:18}},loc:{start:{line:4,column:40},end:{line:45,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:15,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:15,column:5}},{start:{line:9,column:4},end:{line:15,column:5}}],line:9},"1":{loc:{start:{line:20,column:4},end:{line:38,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:38,column:5}},{start:{line:20,column:4},end:{line:38,column:5}}],line:20}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},f:{"0":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"e64c5f4ec4a2de1a44af470860f418469e9b868b"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2avtsmtx6s=function(){return actualCoverage;};}return actualCoverage;}cov_2avtsmtx6s();const bcrypt=(cov_2avtsmtx6s().s[0]++,require("bcryptjs"));const User=(cov_2avtsmtx6s().s[1]++,require("../../models/User"));cov_2avtsmtx6s().s[2]++;module.exports=async(psw,userId)=>{cov_2avtsmtx6s().f[0]++;cov_2avtsmtx6s().s[3]++;try{const user=(cov_2avtsmtx6s().s[4]++,await User.findById(userId));cov_2avtsmtx6s().s[5]++;if(!user){cov_2avtsmtx6s().b[0][0]++;cov_2avtsmtx6s().s[6]++;return{err:{message:"user not found"},status:"error",statusCode:404};}else{cov_2avtsmtx6s().b[0][1]++;}const salt=(cov_2avtsmtx6s().s[7]++,await bcrypt.genSalt(10));const newPswHashed=(cov_2avtsmtx6s().s[8]++,await bcrypt.hash(psw.newPassword,salt));const isMatch=(cov_2avtsmtx6s().s[9]++,await bcrypt.compare(psw.currentPassword,user.password));cov_2avtsmtx6s().s[10]++;if(!isMatch){cov_2avtsmtx6s().b[1][0]++;cov_2avtsmtx6s().s[11]++;return{err:{message:"Incorrect password"},status:"error",statusCode:403};}else{cov_2avtsmtx6s().b[1][1]++;const updatedUser=(cov_2avtsmtx6s().s[12]++,await User.findOneAndUpdate({_id:userId},{password:newPswHashed},{new:true}).lean().exec());cov_2avtsmtx6s().s[13]++;return{data:updatedUser,status:"success"};}}catch(err){cov_2avtsmtx6s().s[14]++;return{err,status:"error"};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYW5nZVBhc3N3b3JkLnNlcnZpY2UuanMiXSwibmFtZXMiOlsiYmNyeXB0IiwicmVxdWlyZSIsIlVzZXIiLCJtb2R1bGUiLCJleHBvcnRzIiwicHN3IiwidXNlcklkIiwidXNlciIsImZpbmRCeUlkIiwiZXJyIiwibWVzc2FnZSIsInN0YXR1cyIsInN0YXR1c0NvZGUiLCJzYWx0IiwiZ2VuU2FsdCIsIm5ld1Bzd0hhc2hlZCIsImhhc2giLCJuZXdQYXNzd29yZCIsImlzTWF0Y2giLCJjb21wYXJlIiwiY3VycmVudFBhc3N3b3JkIiwicGFzc3dvcmQiLCJ1cGRhdGVkVXNlciIsImZpbmRPbmVBbmRVcGRhdGUiLCJfaWQiLCJuZXciLCJsZWFuIiwiZXhlYyIsImRhdGEiXSwibWFwcGluZ3MiOiJza0VBZVk7MkZBZlosS0FBTUEsQ0FBQUEsTUFBTSwwQkFBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLENBRUEsS0FBTUMsQ0FBQUEsSUFBSSwwQkFBR0QsT0FBTyxDQUFDLG1CQUFELENBQVYsQ0FBVixDLHdCQUNBRSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsTUFBT0MsR0FBUCxDQUFZQyxNQUFaLEdBQXVCLGlEQUN0QyxHQUFJLENBRUYsS0FBTUMsQ0FBQUEsSUFBSSwwQkFBRyxLQUFNTCxDQUFBQSxJQUFJLENBQUNNLFFBQUwsQ0FBY0YsTUFBZCxDQUFULENBQVYsQ0FGRSx3QkFJRixHQUFJLENBQUNDLElBQUwsQ0FBVyxvREFDVCxNQUFPLENBQ0xFLEdBQUcsQ0FBRSxDQUFFQyxPQUFPLENBQUUsZ0JBQVgsQ0FEQSxDQUVMQyxNQUFNLENBQUUsT0FGSCxDQUdMQyxVQUFVLENBQUUsR0FIUCxDQUFQLENBS0QsQ0FORCxpQ0FPQSxLQUFNQyxDQUFBQSxJQUFJLDBCQUFHLEtBQU1iLENBQUFBLE1BQU0sQ0FBQ2MsT0FBUCxDQUFlLEVBQWYsQ0FBVCxDQUFWLENBQ0EsS0FBTUMsQ0FBQUEsWUFBWSwwQkFBRyxLQUFNZixDQUFBQSxNQUFNLENBQUNnQixJQUFQLENBQVlYLEdBQUcsQ0FBQ1ksV0FBaEIsQ0FBNkJKLElBQTdCLENBQVQsQ0FBbEIsQ0FDQSxLQUFNSyxDQUFBQSxPQUFPLDBCQUFHLEtBQU1sQixDQUFBQSxNQUFNLENBQUNtQixPQUFQLENBQWVkLEdBQUcsQ0FBQ2UsZUFBbkIsQ0FBb0NiLElBQUksQ0FBQ2MsUUFBekMsQ0FBVCxDQUFiLENBYkUseUJBZUYsR0FBSSxDQUFDSCxPQUFMLENBQWMscURBQ1osTUFBTyxDQUNMVCxHQUFHLENBQUUsQ0FBRUMsT0FBTyxDQUFFLG9CQUFYLENBREEsQ0FFTEMsTUFBTSxDQUFFLE9BRkgsQ0FHTEMsVUFBVSxDQUFFLEdBSFAsQ0FBUCxDQUtELENBTkQsSUFNTyw0QkFDTCxLQUFNVSxDQUFBQSxXQUFXLDJCQUFHLEtBQU1wQixDQUFBQSxJQUFJLENBQUNxQixnQkFBTCxDQUN4QixDQUFFQyxHQUFHLENBQUVsQixNQUFQLENBRHdCLENBRXhCLENBQUVlLFFBQVEsQ0FBRU4sWUFBWixDQUZ3QixDQUd4QixDQUFFVSxHQUFHLENBQUUsSUFBUCxDQUh3QixFQUt2QkMsSUFMdUIsR0FNdkJDLElBTnVCLEVBQVQsQ0FBakIsQ0FESyx5QkFRTCxNQUFPLENBQ0xDLElBQUksQ0FBRU4sV0FERCxDQUVMWCxNQUFNLENBQUUsU0FGSCxDQUFQLENBSUQsQ0FDRixDQUFDLE1BQU9GLEdBQVAsQ0FBWSwwQkFDWixNQUFPLENBQ0xBLEdBREssQ0FFTEUsTUFBTSxDQUFFLE9BRkgsQ0FBUCxDQUlELENBQ0YsQ0F6Q0QiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0anNcIik7XG5cbmNvbnN0IFVzZXIgPSByZXF1aXJlKFwiLi4vLi4vbW9kZWxzL1VzZXJcIik7XG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChwc3csIHVzZXJJZCkgPT4ge1xuICB0cnkge1xuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XG4gICBcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGVycjogeyBtZXNzYWdlOiBcInVzZXIgbm90IGZvdW5kXCIgfSxcbiAgICAgICAgc3RhdHVzOiBcImVycm9yXCIsXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMCk7XG4gICAgY29uc3QgbmV3UHN3SGFzaGVkID0gYXdhaXQgYmNyeXB0Lmhhc2gocHN3Lm5ld1Bhc3N3b3JkLCBzYWx0KTtcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocHN3LmN1cnJlbnRQYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgXG4gICAgaWYgKCFpc01hdGNoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnI6IHsgbWVzc2FnZTogXCJJbmNvcnJlY3QgcGFzc3dvcmRcIiB9LFxuICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgc3RhdHVzQ29kZTogNDAzLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmVBbmRVcGRhdGUoXG4gICAgICAgIHsgX2lkOiB1c2VySWQgfSxcbiAgICAgICAgeyBwYXNzd29yZDogbmV3UHN3SGFzaGVkIH0sXG4gICAgICAgIHsgbmV3OiB0cnVlIH1cbiAgICAgIClcbiAgICAgICAgLmxlYW4oKVxuICAgICAgICAuZXhlYygpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YTogdXBkYXRlZFVzZXIsXG4gICAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycixcbiAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgIH07XG4gIH1cbn07XG4iXX0=