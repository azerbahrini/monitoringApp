function cov_uvg8i0w27(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/getAllMembers.js";var hash="0d9893cff4134859cfe3f138dea76f1d2e87bbdf";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/shift/getAllMembers.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:43}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:18},end:{line:3,column:57}},"3":{start:{line:5,column:0},end:{line:60,column:2}},"4":{start:{line:6,column:2},end:{line:59,column:3}},"5":{start:{line:7,column:24},end:{line:7,column:62}},"6":{start:{line:8,column:18},end:{line:8,column:64}},"7":{start:{line:9,column:16},end:{line:9,column:60}},"8":{start:{line:10,column:16},end:{line:10,column:18}},"9":{start:{line:12,column:26},end:{line:15,column:53}},"10":{start:{line:15,column:16},end:{line:15,column:51}},"11":{start:{line:17,column:25},end:{line:17,column:100}},"12":{start:{line:17,column:81},end:{line:17,column:98}},"13":{start:{line:19,column:19},end:{line:28,column:6}},"14":{start:{line:30,column:28},end:{line:30,column:157}},"15":{start:{line:32,column:13},end:{line:32,column:15}},"16":{start:{line:33,column:4},end:{line:55,column:6}},"17":{start:{line:34,column:6},end:{line:54,column:7}},"18":{start:{line:35,column:8},end:{line:35,column:43}},"19":{start:{line:36,column:18},end:{line:36,column:23}},"20":{start:{line:37,column:8},end:{line:46,column:10}},"21":{start:{line:38,column:10},end:{line:45,column:11}},"22":{start:{line:39,column:12},end:{line:39,column:23}},"23":{start:{line:40,column:26},end:{line:40,column:88}},"24":{start:{line:40,column:53},end:{line:40,column:87}},"25":{start:{line:41,column:12},end:{line:43,column:13}},"26":{start:{line:42,column:14},end:{line:42,column:57}},"27":{start:{line:44,column:12},end:{line:44,column:35}},"28":{start:{line:47,column:8},end:{line:53,column:9}},"29":{start:{line:48,column:24},end:{line:48,column:88}},"30":{start:{line:48,column:51},end:{line:48,column:87}},"31":{start:{line:49,column:12},end:{line:51,column:13}},"32":{start:{line:50,column:14},end:{line:50,column:61}},"33":{start:{line:52,column:10},end:{line:52,column:35}},"34":{start:{line:56,column:4},end:{line:56,column:48}},"35":{start:{line:58,column:4},end:{line:58,column:36}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:65},end:{line:60,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:9},end:{line:15,column:10}},loc:{start:{line:15,column:15},end:{line:15,column:52}},line:15},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:74},end:{line:17,column:75}},loc:{start:{line:17,column:80},end:{line:17,column:99}},line:17},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:26},end:{line:33,column:27}},loc:{start:{line:33,column:38},end:{line:55,column:5}},line:33},"4":{name:"(anonymous_4)",decl:{start:{line:37,column:32},end:{line:37,column:33}},loc:{start:{line:37,column:42},end:{line:46,column:9}},line:37},"5":{name:"(anonymous_5)",decl:{start:{line:40,column:43},end:{line:40,column:44}},loc:{start:{line:40,column:53},end:{line:40,column:87}},line:40},"6":{name:"(anonymous_6)",decl:{start:{line:48,column:41},end:{line:48,column:42}},loc:{start:{line:48,column:51},end:{line:48,column:87}},line:48}},branchMap:{"0":{loc:{start:{line:34,column:6},end:{line:54,column:7}},type:"if",locations:[{start:{line:34,column:6},end:{line:54,column:7}},{start:{line:34,column:6},end:{line:54,column:7}}],line:34},"1":{loc:{start:{line:34,column:9},end:{line:34,column:67}},type:"binary-expr",locations:[{start:{line:34,column:9},end:{line:34,column:24}},{start:{line:34,column:28},end:{line:34,column:67}}],line:34},"2":{loc:{start:{line:38,column:10},end:{line:45,column:11}},type:"if",locations:[{start:{line:38,column:10},end:{line:45,column:11}},{start:{line:38,column:10},end:{line:45,column:11}}],line:38},"3":{loc:{start:{line:38,column:13},end:{line:38,column:91}},type:"binary-expr",locations:[{start:{line:38,column:13},end:{line:38,column:26}},{start:{line:38,column:30},end:{line:38,column:91}}],line:38},"4":{loc:{start:{line:41,column:12},end:{line:43,column:13}},type:"if",locations:[{start:{line:41,column:12},end:{line:43,column:13}},{start:{line:41,column:12},end:{line:43,column:13}}],line:41},"5":{loc:{start:{line:47,column:8},end:{line:53,column:9}},type:"if",locations:[{start:{line:47,column:8},end:{line:53,column:9}},{start:{line:47,column:8},end:{line:53,column:9}}],line:47},"6":{loc:{start:{line:49,column:12},end:{line:51,column:13}},type:"if",locations:[{start:{line:49,column:12},end:{line:51,column:13}},{start:{line:49,column:12},end:{line:51,column:13}}],line:49}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0d9893cff4134859cfe3f138dea76f1d2e87bbdf"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_uvg8i0w27=function(){return actualCoverage;};}return actualCoverage;}cov_uvg8i0w27();const Shift=(cov_uvg8i0w27().s[0]++,require("../../models/Shift"));const moment=(cov_uvg8i0w27().s[1]++,require('moment'));const TlHistory=(cov_uvg8i0w27().s[2]++,require("../../models/TeamLeadHistory"));cov_uvg8i0w27().s[3]++;module.exports=async(teamLeaderId,shift,startDate,endDate)=>{cov_uvg8i0w27().f[0]++;cov_uvg8i0w27().s[4]++;try{const TlHistories=(cov_uvg8i0w27().s[5]++,await TlHistory.find({}).lean().exec());const start=(cov_uvg8i0w27().s[6]++,new Date(moment(startDate+"T00:00:00.000Z")));const end=(cov_uvg8i0w27().s[7]++,new Date(moment(endDate+"T23:59:59.000Z")));let members=(cov_uvg8i0w27().s[8]++,[]);const userAvailable=(cov_uvg8i0w27().s[9]++,(await Shift.find({startDate:{$gte:start,$lte:end},name:shift},{user:1}).populate({path:"user",model:"user",select:["firstName","lastName","email"],match:{status:true}}).lean().exec()).map(item=>{cov_uvg8i0w27().f[1]++;cov_uvg8i0w27().s[10]++;return{user:item.user,total:0};}));const shiftHistory=(cov_uvg8i0w27().s[11]++,(await Shift.find({},{_id:1}).lean().exec()).map(item=>{cov_uvg8i0w27().f[2]++;cov_uvg8i0w27().s[12]++;return item._id;}));const tlDocs=(cov_uvg8i0w27().s[13]++,await Shift.aggregate([{$match:{_id:{$in:shiftHistory},role:teamLeaderId}},{$group:{_id:{user:"$user"},total:{$sum:1}}},{$project:{user:'$_id.user',total:'$total',_id:0}}]));const tlDocsPopulated=(cov_uvg8i0w27().s[14]++,await Shift.populate(tlDocs,{path:"user",model:"user",select:["firstName","lastName","email"],match:{status:true}}));let usersIds=(cov_uvg8i0w27().s[15]++,[]);cov_uvg8i0w27().s[16]++;userAvailable.forEach(userObject=>{cov_uvg8i0w27().f[3]++;cov_uvg8i0w27().s[17]++;if((cov_uvg8i0w27().b[1][0]++,userObject.user)&&(cov_uvg8i0w27().b[1][1]++,!usersIds.includes(userObject.user._id))){cov_uvg8i0w27().b[0][0]++;cov_uvg8i0w27().s[18]++;usersIds.push(userObject.user._id);let exist=(cov_uvg8i0w27().s[19]++,false);cov_uvg8i0w27().s[20]++;tlDocsPopulated.forEach(tlObject=>{cov_uvg8i0w27().f[4]++;cov_uvg8i0w27().s[21]++;if((cov_uvg8i0w27().b[3][0]++,tlObject.user)&&(cov_uvg8i0w27().b[3][1]++,userObject.user._id.toString()===tlObject.user._id.toString())){cov_uvg8i0w27().b[2][0]++;cov_uvg8i0w27().s[22]++;exist=true;let history=(cov_uvg8i0w27().s[23]++,TlHistories.find(item=>{cov_uvg8i0w27().f[5]++;cov_uvg8i0w27().s[24]++;return item.email===tlObject.user.email;}));cov_uvg8i0w27().s[25]++;if(history){cov_uvg8i0w27().b[4][0]++;cov_uvg8i0w27().s[26]++;tlObject.total=tlObject.total+history.count;}else{cov_uvg8i0w27().b[4][1]++;}cov_uvg8i0w27().s[27]++;members.push(tlObject);}else{cov_uvg8i0w27().b[2][1]++;}});cov_uvg8i0w27().s[28]++;if(!exist){cov_uvg8i0w27().b[5][0]++;let history=(cov_uvg8i0w27().s[29]++,TlHistories.find(item=>{cov_uvg8i0w27().f[6]++;cov_uvg8i0w27().s[30]++;return item.email===userObject.user.email;}));cov_uvg8i0w27().s[31]++;if(history){cov_uvg8i0w27().b[6][0]++;cov_uvg8i0w27().s[32]++;userObject.total=userObject.total+history.count;}else{cov_uvg8i0w27().b[6][1]++;}cov_uvg8i0w27().s[33]++;members.push(userObject);}else{cov_uvg8i0w27().b[5][1]++;}}else{cov_uvg8i0w27().b[0][1]++;}});cov_uvg8i0w27().s[34]++;return{data:members,status:"success"};}catch(err){cov_uvg8i0w27().s[35]++;return{err,status:"error"};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldEFsbE1lbWJlcnMuanMiXSwibmFtZXMiOlsiU2hpZnQiLCJyZXF1aXJlIiwibW9tZW50IiwiVGxIaXN0b3J5IiwibW9kdWxlIiwiZXhwb3J0cyIsInRlYW1MZWFkZXJJZCIsInNoaWZ0Iiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsIlRsSGlzdG9yaWVzIiwiZmluZCIsImxlYW4iLCJleGVjIiwic3RhcnQiLCJEYXRlIiwiZW5kIiwibWVtYmVycyIsInVzZXJBdmFpbGFibGUiLCIkZ3RlIiwiJGx0ZSIsIm5hbWUiLCJ1c2VyIiwicG9wdWxhdGUiLCJwYXRoIiwibW9kZWwiLCJzZWxlY3QiLCJtYXRjaCIsInN0YXR1cyIsIm1hcCIsIml0ZW0iLCJ0b3RhbCIsInNoaWZ0SGlzdG9yeSIsIl9pZCIsInRsRG9jcyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIiRpbiIsInJvbGUiLCIkZ3JvdXAiLCIkc3VtIiwiJHByb2plY3QiLCJ0bERvY3NQb3B1bGF0ZWQiLCJ1c2Vyc0lkcyIsImZvckVhY2giLCJ1c2VyT2JqZWN0IiwiaW5jbHVkZXMiLCJwdXNoIiwiZXhpc3QiLCJ0bE9iamVjdCIsInRvU3RyaW5nIiwiaGlzdG9yeSIsImVtYWlsIiwiY291bnQiLCJkYXRhIiwiZXJyIl0sIm1hcHBpbmdzIjoic3lLQWVZO3lGQWZaLEtBQU1BLENBQUFBLEtBQUsseUJBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFWLENBQVgsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLHlCQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxTQUFTLHlCQUFHRixPQUFPLENBQUMsOEJBQUQsQ0FBVixDQUFmLEMsdUJBRUFHLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxZQUFQLENBQW9CQyxLQUFwQixDQUEwQkMsU0FBMUIsQ0FBb0NDLE9BQXBDLEdBQWdELCtDQUMvRCxHQUFJLENBQ0YsS0FBTUMsQ0FBQUEsV0FBVyx5QkFBRyxLQUFNUCxDQUFBQSxTQUFTLENB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SCxDQUFYLENBRFEsd0JBRU4sR0FBR0QsT0FBSCxDQUFXLG1EQUNUTixVQUFVLENBQUNkLEtBQVgsQ0FBaUJjLFVBQVUsQ0FBQ2QsS0FBWCxDQUFpQm9CLE9BQU8sQ0FBQ0UsS0FBMUMsQ0FDRCxDQUZELGdDQUZNLHdCQUtScEMsT0FBTyxDQUFDOEIsSUFBUixDQUFhRixVQUFiLEVBQ0QsQ0FORCxnQ0FPRCxDQXBCRCxnQ0FxQkQsQ0F0QkQsRUEzQkUsd0JBa0RGLE1BQU8sQ0FBRVMsSUFBSSxDQUFFckMsT0FBUixDQUFpQlcsTUFBTSxDQUFFLFNBQXpCLENBQVAsQ0FDRCxDQUFDLE1BQU8yQixHQUFQLENBQVkseUJBQ1osTUFBTyxDQUFFQSxHQUFGLENBQU8zQixNQUFNLENBQUUsT0FBZixDQUFQLENBQ0QsQ0FDRixDQXZERCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaWZ0ID0gcmVxdWlyZShcIi4uLy4uL21vZGVscy9TaGlmdFwiKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuY29uc3QgVGxIaXN0b3J5ID0gcmVxdWlyZShcIi4uLy4uL21vZGVscy9UZWFtTGVhZEhpc3RvcnlcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHRlYW1MZWFkZXJJZCxzaGlmdCxzdGFydERhdGUsZW5kRGF0ZSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IFRsSGlzdG9yaWVzID0gYXdhaXQgVGxIaXN0b3J5LmZpbmQoe30pLmxlYW4oKS5leGVjKCk7XG4gICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShtb21lbnQoc3RhcnREYXRlICsgXCJUMDA6MDA6MDAuMDAwWlwiKSk7XG4gICAgY29uc3QgZW5kID0gbmV3IERhdGUobW9tZW50KGVuZERhdGUgKyBcIlQyMzo1OTo1OS4wMDBaXCIpKTtcbiAgICBsZXQgbWVtYmVycz1bXTtcblxuICAgIGNvbnN0IHVzZXJBdmFpbGFibGUgPSAoYXdhaXQgU2hpZnQuZmluZCh7c3RhcnREYXRlOiB7JGd0ZTpzdGFydCwkbHRlOmVuZH0sbmFtZTpzaGlmdH0se3VzZXI6MX0pXG4gICAgLnBvcHVsYXRlKHsgcGF0aDogXCJ1c2VyXCIsIG1vZGVsOiBcInVzZXJcIiwgc2VsZWN0OiBbXCJmaXJzdE5hbWVcIiwgXCJsYXN0TmFtZVwiLFwiZW1haWxcIl0sIG1hdGNoOiB7IHN0YXR1czogdHJ1ZSB9ICB9KVxuICAgIC5sZWFuKCkuZXhlYygpKVxuICAgIC5tYXAoaXRlbT0+e3JldHVybiB7IHVzZXI6IGl0ZW0udXNlciwgdG90YWw6MCB9fSk7XG5cbiAgICBjb25zdCBzaGlmdEhpc3RvcnkgPSAoYXdhaXQgU2hpZnQuZmluZCh7fSx7X2lkOjF9KS5sZWFuKCkuZXhlYygpKS5tYXAoaXRlbT0+e3JldHVybiAoaXRlbS5faWQpfSk7XG5cbiAgICBjb25zdCB0bERvY3MgPSBhd2FpdCBTaGlmdC5hZ2dyZWdhdGUoW1xuICAgICAge1xuICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICAgX2lkOiB7JGluOiBzaGlmdEhpc3Rvcnl9LFxuICAgICAgICAgICByb2xlOiB0ZWFtTGVhZGVySWRcbiAgICAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHsgJGdyb3VwOiB7IF9pZDogeyB1c2VyOiBcIiR1c2VyXCJ9LCB0b3RhbDogeyAkc3VtOiAxIH0gfSB9LFxuICAgICAgeyRwcm9qZWN0IDoge3VzZXIgOiAnJF9pZC51c2VyJywgdG90YWwgOiAnJHRvdGFsJywgX2lkIDogMH19XG4gICAgXSk7XG5cbiAgICBjb25zdCB0bERvY3NQb3B1bGF0ZWQgPSBhd2FpdCBTaGlmdC5wb3B1bGF0ZSh0bERvY3MsIHsgcGF0aDogXCJ1c2VyXCIsIG1vZGVsOiBcInVzZXJcIiwgc2VsZWN0OiBbXCJmaXJzdE5hbWVcIiwgXCJsYXN0TmFtZVwiLFwiZW1haWxcIl0sIG1hdGNoOiB7IHN0YXR1czogdHJ1ZSB9IH0pO1xuIFxubGV0IHVzZXJzSWRzPVtdO1xuICAgIHVzZXJBdmFpbGFibGUuZm9yRWFjaCh1c2VyT2JqZWN0PT57XG4gICAgICBpZih1c2VyT2JqZWN0LnVzZXIgJiYgIXVzZXJzSWRzLmluY2x1ZGVzKHVzZXJPYmplY3QudXNlci5faWQpKXtcbiAgICAgICAgdXNlcnNJZHMucHVzaCh1c2VyT2JqZWN0LnVzZXIuX2lkKTtcbiAgICAgICAgbGV0IGV4aXN0PWZhbHNlO1xuICAgICAgICB0bERvY3NQb3B1bGF0ZWQuZm9yRWFjaCh0bE9iamVjdD0+e1xuICAgICAgICAgIGlmKHRsT2JqZWN0LnVzZXIgJiYgdXNlck9iamVjdC51c2VyLl9pZC50b1N0cmluZygpPT09dGxPYmplY3QudXNlci5faWQudG9TdHJpbmcoKSl7XG4gICAgICAgICAgICBleGlzdD10cnVlO1xuICAgICAgICAgICAgbGV0IGhpc3RvcnkgPSBUbEhpc3Rvcmllcy5maW5kKChpdGVtKSA9PiBpdGVtLmVtYWlsID09PSB0bE9iamVjdC51c2VyLmVtYWlsKTtcbiAgICAgICAgICAgIGlmKGhpc3Rvcnkpe1xuICAgICAgICAgICAgICB0bE9iamVjdC50b3RhbD10bE9iamVjdC50b3RhbCtoaXN0b3J5LmNvdW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZW1iZXJzLnB1c2godGxPYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgaWYoIWV4aXN0KXtcbiAgICAgICAgICBsZXQgaGlzdG9yeSA9IFRsSGlzdG9yaWVzLmZpbmQoKGl0ZW0pID0+IGl0ZW0uZW1haWwgPT09IHVzZXJPYmplY3QudXNlci5lbWFpbCk7XG4gICAgICAgICAgICBpZihoaXN0b3J5KXtcbiAgICAgICAgICAgICAgdXNlck9iamVjdC50b3RhbD11c2VyT2JqZWN0LnRvdGFsK2hpc3RvcnkuY291bnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBtZW1iZXJzLnB1c2godXNlck9iamVjdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSAgICBcbiAgICByZXR1cm4geyBkYXRhOiBtZW1iZXJzLCBzdGF0dXM6IFwic3VjY2Vzc1wiIH07XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiB7IGVyciwgc3RhdHVzOiBcImVycm9yXCIgfTtcbiAgfVxufTtcbiJdfQ==