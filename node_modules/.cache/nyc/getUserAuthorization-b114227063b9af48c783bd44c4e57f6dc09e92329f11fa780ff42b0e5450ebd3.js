function cov_m807tu8v8(){var path="/home/azer/Desktop/jenkins/app/monitoringApp/services/authorization/getUserAuthorization.js";var hash="f45f40e3d0fc47fec822ca950e5477c6f5d9d67a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/azer/Desktop/jenkins/app/monitoringApp/services/authorization/getUserAuthorization.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:43}},"1":{start:{line:2,column:17},end:{line:2,column:44}},"2":{start:{line:3,column:15},end:{line:3,column:32}},"3":{start:{line:5,column:0},end:{line:89,column:1}},"4":{start:{line:6,column:2},end:{line:88,column:3}},"5":{start:{line:7,column:17},end:{line:7,column:39}},"6":{start:{line:8,column:22},end:{line:82,column:3}},"7":{start:{line:83,column:24},end:{line:83,column:56}},"8":{start:{line:84,column:4},end:{line:84,column:52}},"9":{start:{line:86,column:4},end:{line:86,column:21}},"10":{start:{line:87,column:4},end:{line:87,column:36}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:29},end:{line:5,column:30}},loc:{start:{line:5,column:49},end:{line:89,column:1}},line:5}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},f:{"0":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f45f40e3d0fc47fec822ca950e5477c6f5d9d67a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_m807tu8v8=function(){return actualCoverage;};}return actualCoverage;}cov_m807tu8v8();const Shift=(cov_m807tu8v8().s[0]++,require('../../models/Shift'));const ObjectID=(cov_m807tu8v8().s[1]++,require('mongodb').ObjectId);const moment=(cov_m807tu8v8().s[2]++,require('moment'));cov_m807tu8v8().s[3]++;exports.getRolesPermission=async userId=>{cov_m807tu8v8().f[0]++;cov_m807tu8v8().s[4]++;try{const date=(cov_m807tu8v8().s[5]++,new Date(moment.now()));const aggregate=(cov_m807tu8v8().s[6]++,[{$match:{user:ObjectID(userId),$and:[{startDate:{$lte:date},endDate:{$gte:date}}]}},{$lookup:{from:'users',localField:'user',foreignField:'_id',as:'populatedUser'}},{$set:{'UserStatus':{'$arrayElemAt':['$populatedUser.status',0]}}},{$lookup:{from:'roles',localField:'role',foreignField:'_id',as:'populatedRole'}},{$lookup:{from:'modules',localField:'populatedRole.listModule',foreignField:'_id',as:'populatedModules'}},{$lookup:{from:'permissions',localField:'populatedModules.listPermission',foreignField:'_id',as:'populatedPermissions'}},{$lookup:{from:'permissions',localField:'populatedPermissions.relatedPermissions',foreignField:'_id',as:'relatedPermissions'}},{$match:{UserStatus:true,$or:[{type:'app'},{'populatedRole.label':'Team Leader'}]}},{$project:{populatedModules:1,populatedPermissions:1,relatedPermissions:1}}]);const permissions=(cov_m807tu8v8().s[7]++,await Shift.aggregate(aggregate));cov_m807tu8v8().s[8]++;return{data:permissions,status:'success'};}catch(err){cov_m807tu8v8().s[9]++;console.log(err);cov_m807tu8v8().s[10]++;return{err,status:'error'};}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFVzZXJBdXRob3JpemF0aW9uLmpzIl0sIm5hbWVzIjpbIlNoaWZ0IiwicmVxdWlyZSIsIk9iamVjdElEIiwiT2JqZWN0SWQiLCJtb21lbnQiLCJleHBvcnRzIiwiZ2V0Um9sZXNQZXJtaXNzaW9uIiwidXNlcklkIiwiZGF0ZSIsIkRhdGUiLCJub3ciLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCJ1c2VyIiwiJGFuZCIsInN0YXJ0RGF0ZSIsIiRsdGUiLCJlbmREYXRlIiwiJGd0ZSIsIiRsb29rdXAiLCJmcm9tIiwibG9jYWxGaWVsZCIsImZvcmVpZ25GaWVsZCIsImFzIiwiJHNldCIsIlVzZXJTdGF0dXMiLCIkb3IiLCJ0eXBlIiwiJHByb2plY3QiLCJwb3B1bGF0ZWRNb2R1bGVzIiwicG9wdWxhdGVkUGVybWlzc2lvbnMiLCJyZWxhdGVkUGVybWlzc2lvbnMiLCJwZXJtaXNzaW9ucyIsImRhdGEiLCJzdGF0dXMiLCJlcnIiLCJjb25zb2xlIiwibG9nIl0sIm1hcHBpbmdzIjoiKzhDQWVZO3lGQWZaLEtBQU1BLENBQUFBLEtBQUsseUJBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFWLENBQVgsQ0FDQSxLQUFNQyxDQUFBQSxRQUFRLHlCQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFQLENBQW1CRSxRQUF0QixDQUFkLENBQ0EsS0FBTUMsQ0FBQUEsTUFBTSx5QkFBR0gsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFaLEMsdUJBRUFJLE9BQU8sQ0FBQ0Msa0JBQVIsQ0FBNkIsS0FBUUMsQ0FBQUEsTUFBUixFQUFvQiwrQ0FDL0MsR0FBSSxDQUNGLEtBQU1DLENBQUFBLElBQUkseUJBQUcsR0FBSUMsQ0FBQUEsSUFBSixDQUFTTCxNQUFNLENBQUNNLEdBQVAsRUFBVCxDQUFILENBQVYsQ0FDQSxLQUFNQyxDQUFBQSxTQUFTLHlCQUFHLENBQ2hCLENBQ0VDLE1BQU0sQ0FBRSxDQUNOQyxJQUFJLENBQUVYLFFBQVEsQ0FBQ0ssTUFBRCxDQURSLENBRU5PLElBQUksQ0FBRSxDQUFDLENBQUVDLFNBQVMsQ0FBRSxDQUFFQyxJQUFJLENBQUVSLElBQVIsQ0FBYixDQUE2QlMsT0FBTyxDQUFFLENBQUVDLElBQUksQ0FBRVYsSUFBUixDQUF0QyxDQUFELENBRkEsQ0FEVixDQURnQixDQU9oQixDQUNBVyxPQUFPLENBQUUsQ0FDUEMsSUFBSSxDQUFFLE9BREMsQ0FFUEMsVUFBVSxDQUFFLE1BRkwsQ0FHUEMsWUFBWSxDQUFFLEtBSFAsQ0FJUEMsRUFBRSxDQUFFLGVBSkcsQ0FEVCxDQVBnQixDQWNmLENBQ0RDLElBQUksQ0FDSixDQUNFLGFBQWMsQ0FDWixlQUFnQixDQUFDLHVCQUFELENBQTBCLENBQTFCLENBREosQ0FEaEIsQ0FGQyxDQWRlLENBc0JsQixDQUNFTCxPQUFPLENBQUUsQ0FDUEMsSUFBSSxDQUFFLE9BREMsQ0FFUEMsVUFBVSxDQUFFLE1BRkwsQ0FHUEMsWUFBWSxDQUFFLEtBSFAsQ0FJUEMsRUFBRSxDQUFFLGVBSkcsQ0FEWCxDQXRCa0IsQ0E4QmxCLENBQ0VKLE9BQU8sQ0FBRSxDQUNQQyxJQUFJLENBQUUsU0FEQyxDQUVQQyxVQUFVLENBQUUsMEJBRkwsQ0FHUEMsWUFBWSxDQUFFLEtBSFAsQ0FJUEMsRUFBRSxDQUFFLGtCQUpHLENBRFgsQ0E5QmtCLENBc0NsQixDQUNFSixPQUFPLENBQUUsQ0FDUEMsSUFBSSxDQUFFLGFBREMsQ0FFUEMsVUFBVSxDQUFFLGlDQUZMLENBR1BDLFlBQVksQ0FBRSxLQUhQLENBSVBDLEVBQUUsQ0FBRSxzQkFKRyxDQURYLENBdENrQixDQThDbEIsQ0FDRUosT0FBTyxDQUFFLENBQ1BDLElBQUksQ0FBRSxhQURDLENBRVBDLFVBQVUsQ0FBRSx5Q0FGTCxDQUdQQyxZQUFZLENBQUUsS0FIUCxDQUlQQyxFQUFFLENBQUUsb0JBSkcsQ0FEWCxDQTlDa0IsQ0FzRGpCLENBQ0NYLE1BQU0sQ0FBRSxDQUNOYSxVQUFVLENBQUUsSUFETixDQUVOQyxHQUFHLENBQUUsQ0FDSCxDQUNFQyxJQUFJLENBQUUsS0FEUixDQURHLENBSUgsQ0FDRSxzQkFBdUIsYUFEekIsQ0FKRyxDQUZDLENBRFQsQ0F0RGlCLENBbUVsQixDQUNFQyxRQUFRLENBQUUsQ0FDUkMsZ0JBQWdCLENBQUUsQ0FEVixDQUVSQyxvQkFBb0IsQ0FBRSxDQUZkLENBR1JDLGtCQUFrQixDQUFFLENBSFosQ0FEWixDQW5Fa0IsQ0FBSCxDQUFmLENBMkVBLEtBQU1DLENBQUFBLFdBQVcseUJBQUcsS0FBTWhDLENBQUFBLEtBQUssQ0FBQ1csU0FBTixDQUFnQkEsU0FBaEIsQ0FBVCxDQUFqQixDQTdFRSx1QkE4RUYsTUFBTyxDQUFFc0IsSUFBSSxDQUFFRCxXQUFSLENBQXFCRSxNQUFNLENBQUUsU0FBN0IsQ0FBUCxDQUNELENBQUMsTUFBT0MsR0FBUCxDQUFZLHdCQUNaQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsR0FBWixFQURZLHdCQUVaLE1BQU8sQ0FBRUEsR0FBRixDQUFPRCxNQUFNLENBQUUsT0FBZixDQUFQLENBQ0QsQ0FDRixDQXBGRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaWZ0ID0gcmVxdWlyZSgnLi4vLi4vbW9kZWxzL1NoaWZ0Jyk7XG5jb25zdCBPYmplY3RJRCA9IHJlcXVpcmUoJ21vbmdvZGInKS5PYmplY3RJZDtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuXG5leHBvcnRzLmdldFJvbGVzUGVybWlzc2lvbiA9IGFzeW5jICggdXNlcklkICkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShtb21lbnQubm93KCkpXG4gICAgY29uc3QgYWdncmVnYXRlID0gW1xuICAgICAge1xuICAgICAgICAkbWF0Y2g6IHtcbiAgICAgICAgICB1c2VyOiBPYmplY3RJRCh1c2VySWQpLFxuICAgICAgICAgICRhbmQ6IFt7IHN0YXJ0RGF0ZTogeyAkbHRlOiBkYXRlIH0sIGVuZERhdGU6IHsgJGd0ZTogZGF0ZSB9IH1dXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAkbG9va3VwOiB7XG4gICAgICAgIGZyb206ICd1c2VycycsXG4gICAgICAgIGxvY2FsRmllbGQ6ICd1c2VyJyxcbiAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgYXM6ICdwb3B1bGF0ZWRVc2VyJ1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgICRzZXQ6XG4gICAgICB7XG4gICAgICAgICdVc2VyU3RhdHVzJzoge1xuICAgICAgICAgICckYXJyYXlFbGVtQXQnOiBbJyRwb3B1bGF0ZWRVc2VyLnN0YXR1cycsIDBdXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICRsb29rdXA6IHtcbiAgICAgICAgZnJvbTogJ3JvbGVzJyxcbiAgICAgICAgbG9jYWxGaWVsZDogJ3JvbGUnLFxuICAgICAgICBmb3JlaWduRmllbGQ6ICdfaWQnLFxuICAgICAgICBhczogJ3BvcHVsYXRlZFJvbGUnXG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAkbG9va3VwOiB7XG4gICAgICAgIGZyb206ICdtb2R1bGVzJyxcbiAgICAgICAgbG9jYWxGaWVsZDogJ3BvcHVsYXRlZFJvbGUubGlzdE1vZHVsZScsXG4gICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgIGFzOiAncG9wdWxhdGVkTW9kdWxlcydcbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICRsb29rdXA6IHtcbiAgICAgICAgZnJvbTogJ3Blcm1pc3Npb25zJyxcbiAgICAgICAgbG9jYWxGaWVsZDogJ3BvcHVsYXRlZE1vZHVsZXMubGlzdFBlcm1pc3Npb24nLFxuICAgICAgICBmb3JlaWduRmllbGQ6ICdfaWQnLFxuICAgICAgICBhczogJ3BvcHVsYXRlZFBlcm1pc3Npb25zJ1xuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgJGxvb2t1cDoge1xuICAgICAgICBmcm9tOiAncGVybWlzc2lvbnMnLFxuICAgICAgICBsb2NhbEZpZWxkOiAncG9wdWxhdGVkUGVybWlzc2lvbnMucmVsYXRlZFBlcm1pc3Npb25zJyxcbiAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgYXM6ICdyZWxhdGVkUGVybWlzc2lvbnMnXG4gICAgICB9XG4gICAgfSxcbiAgICAge1xuICAgICAgJG1hdGNoOiB7XG4gICAgICAgIFVzZXJTdGF0dXM6IHRydWUsXG4gICAgICAgICRvcjogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHR5cGU6ICdhcHAnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICAncG9wdWxhdGVkUm9sZS5sYWJlbCc6ICdUZWFtIExlYWRlcidcbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICRwcm9qZWN0OiB7XG4gICAgICAgIHBvcHVsYXRlZE1vZHVsZXM6IDEsXG4gICAgICAgIHBvcHVsYXRlZFBlcm1pc3Npb25zOiAxLFxuICAgICAgICByZWxhdGVkUGVybWlzc2lvbnM6IDFcbiAgICAgIH1cbiAgICB9XG4gIF07XG4gICAgY29uc3QgcGVybWlzc2lvbnMgPSBhd2FpdCBTaGlmdC5hZ2dyZWdhdGUoYWdncmVnYXRlKTtcbiAgICByZXR1cm4geyBkYXRhOiBwZXJtaXNzaW9ucywgc3RhdHVzOiAnc3VjY2VzcycgfTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgICByZXR1cm4geyBlcnIsIHN0YXR1czogJ2Vycm9yJyB9O1xuICB9XG59Il19